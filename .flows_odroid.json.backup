[{"id":"fe9bd502.da1c48","type":"tab","label":"CLUTCH","disabled":false,"info":"# Frage: Wie lange steht der Fahrer auf der Kupplung?\n\n","env":[]},{"id":"e1a94fdd.a1f8a","type":"tab","label":"BRAKE","disabled":false,"info":"# Wie lange steht der Fahrer auf der Bremse?","env":[]},{"id":"60b4d38a.a1148c","type":"tab","label":"Flow 7","disabled":false,"info":"","env":[]},{"id":"6f2009d6.0acd88","type":"tab","label":"q-gate und Junk","disabled":false,"info":"","env":[]},{"id":"1889e7f2.72f9e8","type":"tab","label":"SWITCH OUTPUT","disabled":false,"info":"","env":[]},{"id":"cfd7352b.de1028","type":"tab","label":"Tachosignal","disabled":false,"info":"","env":[]},{"id":"fdee7a45.860e48","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"93d7b78b.d2d2d8","type":"tab","label":"UDP_from_MySQL","disabled":false,"info":"","env":[]},{"id":"3b3462fd.256a6e","type":"tab","label":"HTTP_from_MySQL","disabled":false,"info":"","env":[]},{"id":"c1d663c3.e4762","type":"tab","label":"BLE_from_MySQL","disabled":false,"info":"","env":[]},{"id":"bffdc47c.00e2b8","type":"tab","label":"WakeUp GoPro","disabled":false,"info":"","env":[]},{"id":"89b9f172.e63fe","type":"tab","label":"UDP Heartbeat","disabled":false,"info":"","env":[]},{"id":"fb013fe93cb41d30","type":"tab","label":"BLE_Heartbeat","disabled":false,"info":"","env":[]},{"id":"a71d92ae.7639a","type":"tab","label":"BlackBox_to_MySQL","disabled":false,"info":"","env":[]},{"id":"d3786684.caf558","type":"tab","label":"DB_Connectivity","disabled":false,"info":"","env":[]},{"id":"c31f75c1.823298","type":"tab","label":"DB_Parameter","disabled":false,"info":"","env":[]},{"id":"9004c20f.8cb68","type":"tab","label":"DB_TagSettings","disabled":false,"info":"","env":[]},{"id":"b99a57ec.925fb8","type":"tab","label":"Global_Variable_Backup","disabled":false,"info":"","env":[]},{"id":"90509ca450600ee8","type":"tab","label":"Global_Variabel --> Environmental_Variable_Backup","disabled":false,"info":"","env":[]},{"id":"247347a2.a3c6b8","type":"tab","label":"Restart Nodered","disabled":false,"info":"","env":[]},{"id":"55f61d10.869814","type":"tab","label":"Reboot","disabled":false,"info":"","env":[]},{"id":"2eac6958.c8b676","type":"tab","label":"Flow 4","disabled":false,"info":"","env":[]},{"id":"cbd4e407.b4f008","type":"tab","label":"IGNITION","disabled":false,"info":"","env":[]},{"id":"d995685759e9a253","type":"tab","label":"GPS","disabled":false,"info":"","env":[]},{"id":"dec8dfb9.8b01d8","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"5aa5a8f03826d123","type":"tab","label":"AHRS","disabled":false,"info":"","env":[]},{"id":"dbfdd28e.d60f","type":"tab","label":"BLE_Connection","disabled":false,"info":"","env":[]},{"id":"c82c4a67f528c1f6","type":"tab","label":"BLE Example Flow","disabled":false,"info":""},{"id":"7739ee7cc0afc1e3","type":"tab","label":"BLE Example Flow","disabled":false,"info":""},{"id":"8b3378e67f4ebeb9","type":"tab","label":"BLE_WIFI_Stability","disabled":false,"info":"","env":[]},{"id":"990bb909f6d677c8","type":"tab","label":"WakeUp_GoPro BACKUP","disabled":true,"info":"","env":[]},{"id":"1516d403.d6df1c","type":"subflow","name":"VELOCITY","info":"","category":"","in":[{"x":120,"y":120,"wires":[{"id":"1e4b2556.645e7b"}]}],"out":[{"x":700,"y":120,"wires":[{"id":"31369dfb.4bd482","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"4c0714ce.c8c0ac","type":"subflow","name":"PassLimit","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"9580cd86.d9557"}]}],"out":[{"x":540,"y":40,"wires":[{"id":"ef28d4ab.10e658","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"bcd7ab10.7fcb08","type":"subflow","name":"BLE ShutterStart","info":"","category":"","in":[{"x":140,"y":80,"wires":[{"id":"64c033f6.224f1c"}]}],"out":[{"x":880,"y":80,"wires":[{"id":"189437f3.c162c8","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"5df884bd.7da3ac","type":"subflow","name":"BLE ShutterStop","info":"","category":"","in":[{"x":80,"y":120,"wires":[{"id":"4b90a18c.a24db"}]}],"out":[{"x":840,"y":120,"wires":[{"id":"8bc5a774.2371e8","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"ec2aab9f.334378","type":"subflow","name":"Kill NodeRed","info":"","category":"","in":[{"x":80,"y":180,"wires":[{"id":"510c3670.bf66e8"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"ff56ed00.f5dfb","type":"subflow","name":"Reboot","info":"","category":"","in":[{"x":180,"y":80,"wires":[{"id":"a4b1237e.72987"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"6e9ad42b.1d818c","type":"subflow","name":"Shutdown","info":"","category":"","in":[{"x":160,"y":80,"wires":[{"id":"63d1baa9.111444"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"699c80d1.c0993","type":"subflow","name":"BLE Wifi ON","info":"","category":"","in":[{"x":160,"y":180,"wires":[{"id":"fe48ee53.2165a"}]}],"out":[{"x":980,"y":180,"wires":[{"id":"a30ea43b.ebbff8","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"a6748f13.b6d87","type":"subflow","name":"HTTP WifiStreaming ON","info":"","category":"","in":[{"x":100,"y":200,"wires":[{"id":"3156c3f9.a4885c"}]}],"out":[{"x":1060,"y":200,"wires":[{"id":"6b48c5fe.0b4d5c","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"e29abac8.fc1078","type":"subflow","name":"BLE Wifi OFF","info":"","category":"","in":[{"x":280,"y":200,"wires":[{"id":"d5529a6f.b9e328"}]}],"out":[{"x":1060,"y":200,"wires":[{"id":"62f35c4d.f9f794","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"7a5d0b6b.156a24","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"8be2921c.a6a47","type":"ui_tab","name":"DashCam Settings","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"a3598685.c656f8","type":"ui_group","name":"Tag Limits","tab":"8be2921c.a6a47","order":1,"disp":true,"width":"6","collapse":false},{"id":"ff3d23ed.851e","type":"ui_group","name":"Default","tab":"b0d4ebc5.f66f98","order":1,"disp":true,"width":"6","collapse":false},{"id":"b0d4ebc5.f66f98","type":"ui_tab","name":"TESTS","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"4b0eb527.16d5ec","type":"MySQLdatabase","host":"127.0.0.1","port":"3306","db":"blackbox","tz":""},{"id":"395f2a47.6cfaf6","type":"MySQLdatabase","host":"127.0.0.1","port":"3306","db":"UDP_CMD","tz":""},{"id":"760a3e67.03abe","type":"MySQLdatabase","host":"127.0.0.1","port":"3306","db":"HTTP_CMD","tz":""},{"id":"7270f351.076f3c","type":"ui_tab","name":"Connectivity","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"fb75f346.d7f78","type":"ui_group","name":"UDP (Smart Remote)","tab":"7270f351.076f3c","order":1,"disp":true,"width":"6","collapse":false},{"id":"f5a966d8.d5c368","type":"ui_group","name":"HTTP (GoPro App)","tab":"7270f351.076f3c","order":3,"disp":true,"width":"6","collapse":false},{"id":"7193ba64.490654","type":"ui_group","name":"BLE (GoPro App)","tab":"7270f351.076f3c","order":5,"disp":true,"width":"7","collapse":false,"className":""},{"id":"ad805b2f.308398","type":"ui_group","name":"","tab":"7270f351.076f3c","order":2,"disp":true,"width":"1","collapse":false},{"id":"22f841fd.fe797e","type":"ui_group","name":"","tab":"7270f351.076f3c","order":4,"disp":true,"width":"1","collapse":false},{"id":"92dc2f25.cdcf4","type":"ui_spacer","name":"spacer","group":"f5a966d8.d5c368","order":1,"width":1,"height":1},{"id":"7247376.1528ec8","type":"ui_spacer","name":"spacer","group":"22f841fd.fe797e","order":1,"width":1,"height":1},{"id":"3e4e30cc.ab175","type":"ui_group","name":"","tab":"7270f351.076f3c","order":6,"disp":true,"width":"1","collapse":false},{"id":"92b5dd47.8a1a1","type":"ui_spacer","name":"spacer","group":"7193ba64.490654","order":1,"width":1,"height":1},{"id":"dcb7070f.a6f788","type":"ui_spacer","name":"spacer","group":"3e4e30cc.ab175","order":1,"width":1,"height":1},{"id":"230fd081.affe6","type":"MySQLdatabase","host":"127.0.0.1","port":"3306","db":"BLE_CMD","tz":""},{"id":"62967dc9.bffff4","type":"ui_tab","name":"Parameter","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"c63c3171.75836","type":"ui_group","name":"Odroid - Connectivity","tab":"62967dc9.bffff4","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"2f80fea05ac68d06","type":"ui_group","name":"GPS","tab":"62967dc9.bffff4","order":2,"disp":true,"width":"7","collapse":false},{"id":"d90014e6c4e457d4","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":7,"width":1,"height":1},{"id":"5fa8e9fc254e606e","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":16,"width":1,"height":1},{"id":"acc71318fd378b24","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":11,"width":1,"height":1},{"id":"475804303a831fbc","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":18,"width":1,"height":1},{"id":"415b8cc9d0ca3d51","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":2,"width":"1","height":"1"},{"id":"df1d14f05b6c0a1a","type":"ui_spacer","name":"spacer","group":"2f80fea05ac68d06","order":4,"width":1,"height":1},{"id":"e9a45c1a.a0da","type":"ui_group","name":"G_2","tab":"4c0b230b.9a171c","order":4,"disp":false,"width":"25","collapse":false,"className":""},{"id":"4c0b230b.9a171c","type":"ui_tab","name":"Drivecamlrgscreen","icon":"dashboard","order":5},{"id":"5c06971a.d78e58","type":"ui_group","name":"DemoTab","tab":"77192d8a.e0785c","order":1,"disp":true,"width":"6","collapse":false},{"id":"77192d8a.e0785c","type":"ui_tab","name":"Demo","icon":"dashboard","disabled":false,"hidden":false},{"id":"84d404e3d8ee45d6","type":"ui_group","name":"GoPro - Connectivity","tab":"62967dc9.bffff4","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"120779d6eed12ce2","type":"mqtt-broker","name":"","broker":"localhost:1883","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"43eeb9362523944e","type":"ui_group","name":"GoPro - Connectivity","tab":"62967dc9.bffff4","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"1e4b2556.645e7b","type":"function","z":"1516d403.d6df1c","name":"VELOCITY_GATE","func":"var NewMsg = { payload : 0, Speed : 0};\nvar Counter = context.get('Counter') || 0;\nvar OpenSwitchNode = 1;\nvar CloseSwitchNode = 0;\n\nif( msg.topic == \"Signal\" )\n{\n    Counter++;\n}\n\nNewMsg.payload = CloseSwitchNode;\n\nif( msg.topic == \"ResetCounter\" )\n{ \n    \n    NewMsg.payload = OpenSwitchNode;\n    NewMsg.Speed = (20 / 17) * Counter * 5  + (60 / 17);\n  \n    Counter = 0;\n}\n\ncontext.set('Counter', Counter);\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":290,"y":120,"wires":[["31369dfb.4bd482"]]},{"id":"31369dfb.4bd482","type":"switch","z":"1516d403.d6df1c","name":"Moving","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":120,"wires":[[]]},{"id":"9580cd86.d9557","type":"function","z":"4c0714ce.c8c0ac","name":"PassLimit","func":"var NewMsg = {payload : 0};\nvar OnClutchLimit = context.get('OnClutchLimit') || 0;\n\ncontext.set('OnClutchLimit') = msg.payload.OnClutchLimit;\n\ncontext.set('OnClutchLimit', OnClutchLimit);\n\nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\nif( msg.Timespan >= 0)\n{\n    if( msg.Timespan >= OnClutchLimit)\n    {\n        NewMsg.payload = PassActualValue;\n    }\n    else\n    {\n        NewMsg.payload = BlockActualValue;\n    }\n}\n//if( msg.payload.OnClutchLimit == 'OnClutchLimit')\n//{\n//    context.set('OnClutchLimit', OnClutchLimit);\n//}\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":160,"y":40,"wires":[["ef28d4ab.10e658"]]},{"id":"ef28d4ab.10e658","type":"switch","z":"4c0714ce.c8c0ac","name":"GreaterThanZero","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":40,"wires":[[]]},{"id":"64c033f6.224f1c","type":"function","z":"bcd7ab10.7fcb08","name":"SELECT ShutterStart","func":"msg.topic = \"SELECT BLE FROM BLE WHERE UniqueID = 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":80,"wires":[["85388f60.6a279"]]},{"id":"85388f60.6a279","type":"mysql","z":"bcd7ab10.7fcb08","mydb":"230fd081.affe6","name":"","x":530,"y":80,"wires":[["189437f3.c162c8"]]},{"id":"189437f3.c162c8","type":"change","z":"bcd7ab10.7fcb08","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"b5f90072aa8d11e390460002a5d5c51b\":$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":80,"wires":[[]]},{"id":"4b90a18c.a24db","type":"function","z":"5df884bd.7da3ac","name":"SELECT ShutterStop","func":"msg.topic = \"SELECT BLE FROM BLE WHERE UniqueID = 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":120,"wires":[["79828421.29144c"]]},{"id":"79828421.29144c","type":"mysql","z":"5df884bd.7da3ac","mydb":"230fd081.affe6","name":"","x":490,"y":120,"wires":[["8bc5a774.2371e8"]]},{"id":"8bc5a774.2371e8","type":"change","z":"5df884bd.7da3ac","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"b5f90072aa8d11e390460002a5d5c51b\":$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":120,"wires":[[]]},{"id":"510c3670.bf66e8","type":"exec","z":"ec2aab9f.334378","command":"ps aux | grep node-red | grep -v grep","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"node red grep node","x":410,"y":180,"wires":[["1895bac5.4f2bc5","f1b06b85.2d8378"],[],[]]},{"id":"2baa512d.ed7a2e","type":"inject","z":"ec2aab9f.334378","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":100,"wires":[["510c3670.bf66e8"]]},{"id":"1895bac5.4f2bc5","type":"debug","z":"ec2aab9f.334378","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":140,"wires":[]},{"id":"f1b06b85.2d8378","type":"function","z":"ec2aab9f.334378","name":"find PID","func":"\nvar pid = msg.payload.match(/\\s{3,}\\d{2,}\\s{1,}/);\nmsg.payload = pid.toString().trim();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":220,"wires":[["c4deea5c.31c078","e29c677.8090898"]]},{"id":"c4deea5c.31c078","type":"debug","z":"ec2aab9f.334378","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":790,"y":140,"wires":[]},{"id":"e29c677.8090898","type":"exec","z":"ec2aab9f.334378","command":"kill","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"kill PID","x":780,"y":220,"wires":[[],[],[]]},{"id":"a4b1237e.72987","type":"exec","z":"ff56ed00.f5dfb","command":"sudo reboot","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":410,"y":80,"wires":[[],[],[]]},{"id":"63d1baa9.111444","type":"exec","z":"6e9ad42b.1d818c","command":"sudo shutdown -h now","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":440,"y":80,"wires":[[],[],[]]},{"id":"e8a8629.d78fba","type":"mysql","z":"699c80d1.c0993","mydb":"230fd081.affe6","name":"","x":610,"y":180,"wires":[["a30ea43b.ebbff8"]]},{"id":"fe48ee53.2165a","type":"function","z":"699c80d1.c0993","name":"SELECT WifiOn","func":"msg.topic = \"SELECT BLE, HW1, HW2, HW3 FROM BLE WHERE UniqueID = 21\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":180,"wires":[["e8a8629.d78fba"]]},{"id":"a30ea43b.ebbff8","type":"change","z":"699c80d1.c0993","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{$join([payload[0].HW1,payload[0].HW2,payload[0].HW3]):$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":180,"wires":[[]]},{"id":"6b48c5fe.0b4d5c","type":"http request","z":"a6748f13.b6d87","name":"Wifi Streaming ON","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":200,"wires":[[]]},{"id":"3156c3f9.a4885c","type":"function","z":"a6748f13.b6d87","name":"SELECT Wifi Streamin ON","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 3\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":200,"wires":[["7be21644.7c9868"]]},{"id":"7be21644.7c9868","type":"mysql","z":"a6748f13.b6d87","mydb":"760a3e67.03abe","name":"","x":510,"y":200,"wires":[["cf669f0b.d5794"]]},{"id":"cf669f0b.d5794","type":"change","z":"a6748f13.b6d87","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":200,"wires":[["6b48c5fe.0b4d5c"]]},{"id":"75bcb968.6a1c48","type":"mysql","z":"e29abac8.fc1078","mydb":"230fd081.affe6","name":"","x":650,"y":200,"wires":[["e10c2208.0c5c8","62f35c4d.f9f794"]]},{"id":"fe02bb85.993868","type":"debug","z":"e29abac8.fc1078","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":140,"wires":[]},{"id":"e10c2208.0c5c8","type":"debug","z":"e29abac8.fc1078","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":140,"wires":[]},{"id":"d5529a6f.b9e328","type":"function","z":"e29abac8.fc1078","name":"SELECT WifiOff","func":"msg.topic = \"SELECT BLE, HW1, HW2, HW3 FROM BLE WHERE UniqueID = 22\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":200,"wires":[["75bcb968.6a1c48"]]},{"id":"62f35c4d.f9f794","type":"change","z":"e29abac8.fc1078","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{$join([payload[0].HW1,payload[0].HW2,payload[0].HW3]):$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":200,"wires":[["fe02bb85.993868"]]},{"id":"dc5e458d.fe91c8","type":"function","z":"fe9bd502.da1c48","name":"setTimeStamp_State","func":"\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nmsg.payload = (new Date(Date.now() - offset)).toISOString()+ \"_\" + msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":300,"wires":[["ab0dd927.46d468"]]},{"id":"d57da8a8.413958","type":"buffer-array","z":"fe9bd502.da1c48","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":630,"y":300,"wires":[["8948f159.430fc"]]},{"id":"8948f159.430fc","type":"function","z":"fe9bd502.da1c48","name":"Timespan_Calculation","func":"//var NewMsg = {Timestamp1:0, Timestamp2:0, Timestamp3:0, Timestamp4:0, Signal1:\"0\", Signal2:\"0\", Signal3:\"0\", Signal4:\"0\", Timespan1:0, Timespan2:0, Timespan3:0}\nvar NewMsg = {Topic: \"ACTUALVALUE\", Timestamp1:0, Timestamp2:0, Signal1:\"0\", Signal2:\"0\", Timespan:0}\n\nvar d1 = Date.parse(msg.payload[0][0]);\nvar d2 = Date.parse(msg.payload[1][0]);\n//var d3 = Date.parse(msg.payload[2][0]);\n//var d4 = Date.parse(msg.payload[3][0]);\n  \nNewMsg.Timestamp1= d1;\nNewMsg.Timestamp2= d2;\n//NewMsg.Timestamp3= d3;\n//NewMsg.Timestamp4= d4;\n\nNewMsg.Signal1 = msg.payload[0][1];\nNewMsg.Signal2 = msg.payload[1][1];\n//NewMsg.Signal3 = msg.payload[2][1];\n//NewMsg.Signal4 = msg.payload[3][1];\n\nNewMsg.Timespan = (d2 - d1) / 1000;\n//NewMsg.Timespan2 = (d3 - d2) / 1000;\n//NewMsg.Timespan3 = (d4 - d3) / 1000;\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":300,"wires":[["94b93c15.931bf","b83ce749.fea368","844284c6.d8c958"]]},{"id":"ab0dd927.46d468","type":"function","z":"fe9bd502.da1c48","name":"SPLIT","func":"msg.payload = msg.payload.split(\"_\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":300,"wires":[["d57da8a8.413958"]]},{"id":"3b391d03.ea14f2","type":"http request","z":"fe9bd502.da1c48","name":"","method":"PUT","ret":"txt","paytoqs":"ignore","url":"http://10.5.5.9/gp/gpControl/command/storage/tag_moment","tls":"","persist":false,"proxy":"","authType":"","x":890,"y":360,"wires":[[]]},{"id":"94b93c15.931bf","type":"switch","z":"fe9bd502.da1c48","name":"Hit_Clutch","property":"Signal1","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":360,"wires":[["ab1d2b64.86aa28","9368d57c.83cd58"]]},{"id":"ab1d2b64.86aa28","type":"function","z":"fe9bd502.da1c48","name":"PassOnClutchLimit","func":"var NewMsg = {payload: 0, OnClutchTimespan: 0, OnClutchLimit: 0};\nvar Settings = global.get('OnClutchLimit');\n\n//NewMsg.OnClutchLimit = Settings.OnClutchLimit;\nNewMsg.OnClutchLimit = Settings;\nNewMsg.OnClutchTimespan = msg.Timespan;\n    \nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\n    if( msg.Timespan >= Settings)\n     {\n       NewMsg.payload = PassActualValue;\n     }\n    else\n     {\n       NewMsg.payload = BlockActualValue;\n     }\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":360,"wires":[["afc5b76c.9c5638","fba622ee.880f7"]]},{"id":"afc5b76c.9c5638","type":"switch","z":"fe9bd502.da1c48","name":"initiate Tag","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":690,"y":360,"wires":[["3b391d03.ea14f2"]]},{"id":"fba622ee.880f7","type":"debug","z":"fe9bd502.da1c48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":420,"wires":[]},{"id":"b83ce749.fea368","type":"debug","z":"fe9bd502.da1c48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":940,"y":440,"wires":[]},{"id":"844284c6.d8c958","type":"link out","z":"fe9bd502.da1c48","name":"CLUTCH","mode":"link","links":["b92fed1a.7c89"],"x":675,"y":460,"wires":[]},{"id":"9368d57c.83cd58","type":"debug","z":"fe9bd502.da1c48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":360,"y":440,"wires":[]},{"id":"99db86e7.aa7328","type":"inject","z":"fe9bd502.da1c48","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":800,"y":500,"wires":[["3b391d03.ea14f2"]]},{"id":"c5b1a344dbd44655","type":"gpio-in","z":"fe9bd502.da1c48","name":"Input 2","state":"INPUT","device":"gpiochip0","pin":"68","x":290,"y":160,"wires":[["e521dd2c3796c9da"]]},{"id":"0a87bd426a4add6f","type":"inject","z":"fe9bd502.da1c48","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"0.05","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"date","x":110,"y":160,"wires":[["c5b1a344dbd44655"]]},{"id":"27b398677fa284b0","type":"gpio-out","z":"fe9bd502.da1c48","name":"Output 2","state":"OUTPUT","device":"gpiochip0","pin":"73","x":320,"y":740,"wires":[["e0ca3570bff1ccf8"]]},{"id":"4b27d5b4d5c6e95f","type":"inject","z":"fe9bd502.da1c48","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":120,"y":720,"wires":[["27b398677fa284b0"]]},{"id":"bb96ce3ca79f86e1","type":"inject","z":"fe9bd502.da1c48","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":120,"y":780,"wires":[["27b398677fa284b0"]]},{"id":"e0ca3570bff1ccf8","type":"debug","z":"fe9bd502.da1c48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":740,"wires":[]},{"id":"e521dd2c3796c9da","type":"rbe","z":"fe9bd502.da1c48","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","topi":"topic","x":470,"y":160,"wires":[["dc5e458d.fe91c8"]]},{"id":"c12f3d6b.45515","type":"rpi-gpio in","z":"e1a94fdd.a1f8a","name":"","pin":"17","intype":"tri","debounce":"25","read":false,"bcm":true,"x":70,"y":180,"wires":[["f35cdcdb.43dee"]]},{"id":"f35cdcdb.43dee","type":"function","z":"e1a94fdd.a1f8a","name":"setTimeStamp_State","func":"var ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nmsg.payload = (new Date(Date.now() - offset)).toISOString()+ \"_\" + msg.payload;\n\nreturn msg;\n\n\n//orig\n\n//var ts = new Date();\n//msg.payload = ts.toISOString() + \"_\" + msg.payload;\n////msg.payload = ts.toUTCString() + \"_\" + msg.payload;\n//return msg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":40,"wires":[["8f797501.967878"]]},{"id":"d256d3c0.78001","type":"buffer-array","z":"e1a94fdd.a1f8a","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":630,"y":40,"wires":[["ddbd59f9.90cf48"]]},{"id":"ddbd59f9.90cf48","type":"function","z":"e1a94fdd.a1f8a","name":"Timespan_Calculation","func":"//var NewMsg = {Timestamp1:0, Timestamp2:0, Timestamp3:0, Timestamp4:0, Signal1:\"0\", Signal2:\"0\", Signal3:\"0\", Signal4:\"0\", Timespan1:0, Timespan2:0, Timespan3:0}\nvar NewMsg = {Topic: \"ACTUALVALUE\", Timestamp1:0, Timestamp2:0, Signal1:\"0\", Signal2:\"0\", Timespan:0}\n\nvar d1 = Date.parse(msg.payload[0][0]);\nvar d2 = Date.parse(msg.payload[1][0]);\n//var d3 = Date.parse(msg.payload[2][0]);\n//var d4 = Date.parse(msg.payload[3][0]);\n  \nNewMsg.Timestamp1= d1;\nNewMsg.Timestamp2= d2;\n//NewMsg.Timestamp3= d3;\n//NewMsg.Timestamp4= d4;\n\nNewMsg.Signal1 = msg.payload[0][1];\nNewMsg.Signal2 = msg.payload[1][1];\n//NewMsg.Signal3 = msg.payload[2][1];\n//NewMsg.Signal4 = msg.payload[3][1];\n\nNewMsg.Timespan = (d2 - d1) / 1000;\n//NewMsg.Timespan2 = (d3 - d2) / 1000;\n//NewMsg.Timespan3 = (d4 - d3) / 1000;\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":840,"y":40,"wires":[["8978db7d.5ca328","a1934b83.ac2d28","d27c894f.850d18"]]},{"id":"8f797501.967878","type":"function","z":"e1a94fdd.a1f8a","name":"SPLIT","func":"msg.payload = msg.payload.split(\"_\");\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":40,"wires":[["d256d3c0.78001"]]},{"id":"b872bbd5.b50a18","type":"http request","z":"e1a94fdd.a1f8a","name":"","method":"PUT","ret":"txt","paytoqs":false,"url":"http://10.5.5.9/gp/gpControl/command/storage/tag_moment","tls":"","persist":false,"proxy":"","authType":"","x":830,"y":100,"wires":[[]]},{"id":"8978db7d.5ca328","type":"switch","z":"e1a94fdd.a1f8a","name":"Hit_Brake","property":"Signal1","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":100,"wires":[["5e06e8c.c0a2b18"]]},{"id":"5e06e8c.c0a2b18","type":"function","z":"e1a94fdd.a1f8a","name":"PassLimit","func":"var NewMsg = {payload: 0, OnBrakeTimespan: 0, OnBrakeLimit: 0};\nvar Settings = global.get('OnBrakeLimit');\n\n//NewMsg.OnClutchLimit = Settings.OnClutchLimit;\nNewMsg.OnBrakeLimit = Settings;\nNewMsg.OnBrakeTimespan = msg.Timespan;\n    \nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\n    if( msg.Timespan >= Settings)\n     {\n       NewMsg.payload = PassActualValue;\n     }\n    else\n     {\n       NewMsg.payload = BlockActualValue;\n     }\n\nreturn NewMsg;\n\n//var NewMsg = {payload: 0, OnBrakeTimespan: 0, OnBrakeLimit: 0};\n//var Settings = global.get(\"SpaceStarSettings\");\n\n//NewMsg.OnBrakeLimit = Settings.OnBrakeLimit;\n//NewMsg.OnBrakeTimespan = msg.Timespan;\n    \n//var PassActualValue  = 1;\n//var BlockActualValue = 0;\n\n  //  if( msg.Timespan >= Settings.OnBrakeLimit)\n  //   {\n   //    NewMsg.payload = PassActualValue;\n   //  }\n  //  else\n  //   {\n  //     NewMsg.payload = BlockActualValue;\n  //   }\n\n//return NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":100,"wires":[["e2fb0203.4029f","153563e5.47c44c"]]},{"id":"e2fb0203.4029f","type":"switch","z":"e1a94fdd.a1f8a","name":"GreaterThanZero","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":100,"wires":[["b872bbd5.b50a18"]]},{"id":"153563e5.47c44c","type":"debug","z":"e1a94fdd.a1f8a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":490,"y":160,"wires":[]},{"id":"6002d407.5d153c","type":"inject","z":"e1a94fdd.a1f8a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":90,"y":20,"wires":[["f35cdcdb.43dee"]]},{"id":"9e3e66f2.cbebc8","type":"inject","z":"e1a94fdd.a1f8a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":100,"y":80,"wires":[["f35cdcdb.43dee"]]},{"id":"a1934b83.ac2d28","type":"link out","z":"e1a94fdd.a1f8a","name":"BRAKE","links":["89ffb456.200978"],"x":865,"y":180,"wires":[]},{"id":"d27c894f.850d18","type":"debug","z":"e1a94fdd.a1f8a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":140,"wires":[]},{"id":"85ba0350.2569b","type":"rpi-gpio in","z":"60b4d38a.a1148c","d":true,"name":"","pin":"22","intype":"tri","debounce":"25","read":false,"bcm":true,"x":110,"y":60,"wires":[["21cf92bf.ac86de","defae924.c14e78"]]},{"id":"21cf92bf.ac86de","type":"function","z":"60b4d38a.a1148c","name":"setTimeStamp_State","func":"\nvar ts = new Date();\nmsg.payload = ts.toISOString() + \"_\" + msg.payload;\n//msg.payload = ts.toUTCString() + \"_\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":60,"wires":[["84dd22c2.af9ee"]]},{"id":"63d03b8f.e82054","type":"buffer-array","z":"60b4d38a.a1148c","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":670,"y":60,"wires":[["86175588.8ba3f8"]]},{"id":"86175588.8ba3f8","type":"function","z":"60b4d38a.a1148c","name":"Timespan_Calculation","func":"//var NewMsg = {Timestamp1:0, Timestamp2:0, Timestamp3:0, Timestamp4:0, Signal1:\"0\", Signal2:\"0\", Signal3:\"0\", Signal4:\"0\", Timespan1:0, Timespan2:0, Timespan3:0}\nvar NewMsg = {Topic: \"ACTUALVALUE\", Timestamp1:0, Timestamp2:0, Signal1:\"0\", Signal2:\"0\", Timespan:0}\n\nvar d1 = Date.parse(msg.payload[0][0]);\nvar d2 = Date.parse(msg.payload[1][0]);\n//var d3 = Date.parse(msg.payload[2][0]);\n//var d4 = Date.parse(msg.payload[3][0]);\n  \nNewMsg.Timestamp1= d1;\nNewMsg.Timestamp2= d2;\n//NewMsg.Timestamp3= d3;\n//NewMsg.Timestamp4= d4;\n\nNewMsg.Signal1 = msg.payload[0][1];\nNewMsg.Signal2 = msg.payload[1][1];\n//NewMsg.Signal3 = msg.payload[2][1];\n//NewMsg.Signal4 = msg.payload[3][1];\n\nNewMsg.Timespan = (d2 - d1) / 1000;\n//NewMsg.Timespan2 = (d3 - d2) / 1000;\n//NewMsg.Timespan3 = (d4 - d3) / 1000;\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":180,"y":140,"wires":[["efd482a6.5bc44"]]},{"id":"84dd22c2.af9ee","type":"function","z":"60b4d38a.a1148c","name":"SPLIT","func":"msg.payload = msg.payload.split(\"_\");\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":60,"wires":[["63d03b8f.e82054"]]},{"id":"382c3276.945cbe","type":"http request","z":"60b4d38a.a1148c","name":"","method":"PUT","ret":"txt","paytoqs":false,"url":"http://10.5.5.9/gp/gpControl/command/storage/tag_moment","tls":"","persist":false,"proxy":"","authType":"","x":730,"y":140,"wires":[["fa19c65b.c820c8"]]},{"id":"efd482a6.5bc44","type":"switch","z":"60b4d38a.a1148c","name":"Hit_Clutch","property":"Signal1","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":140,"wires":[["43dc6eac.de64a","6d0c6136.236fa","7dbb5b61.bbee34"]]},{"id":"fa19c65b.c820c8","type":"debug","z":"60b4d38a.a1148c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":890,"y":140,"wires":[]},{"id":"43dc6eac.de64a","type":"switch","z":"60b4d38a.a1148c","d":true,"name":"OnClutchTime","property":"Timespan","propertyType":"msg","rules":[{"t":"gte","v":"topic","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":140,"wires":[["382c3276.945cbe"]]},{"id":"defae924.c14e78","type":"file in","z":"60b4d38a.a1148c","name":"LoadOnClutchLimit","filename":"SpaceStarSettings","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":370,"y":320,"wires":[["fd58a259.abf52"]]},{"id":"fd58a259.abf52","type":"json","z":"60b4d38a.a1148c","name":"","property":"payload","action":"","pretty":false,"x":530,"y":320,"wires":[["df754145.49b7c"]]},{"id":"ae0a19ef.1a4898","type":"file","z":"60b4d38a.a1148c","name":"SaveOnClutchLimit","filename":"SpaceStarSettings","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":810,"y":380,"wires":[[]]},{"id":"55508c9e.f73e84","type":"inject","z":"60b4d38a.a1148c","d":true,"name":"Inject true after boot","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":140,"y":320,"wires":[["defae924.c14e78"]]},{"id":"28b165a8.ae696a","type":"join","z":"60b4d38a.a1148c","name":"CombineLimits","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"1","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":600,"y":380,"wires":[["ae0a19ef.1a4898","6d0c6136.236fa","18a0b49d.92060b"]]},{"id":"df754145.49b7c","type":"change","z":"60b4d38a.a1148c","name":"GetOnClutchLimit","rules":[{"t":"move","p":"payload","pt":"msg","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":210,"y":380,"wires":[[]]},{"id":"6d0c6136.236fa","type":"function","z":"60b4d38a.a1148c","name":"PassLimit","func":"var NewMsg = {payload: 0, Timespan: 0, OnClutchLimit: 0};\n//var Clutch = current.get('Clutch') || 0;\n//global.set(\"SpaceStarSettings\", msg.payload);\nvar Settings = global.get(\"SpaceStarSettings\");\n//var OnClutchLimit = SpaceStarSettings.OnClutchLimit;\n\nif ( msg.topic == \"OnClutchLimit\")\n\n{\n   NewMsg.OnClutchLimit = Settings.OnClutchLimit;\n    \n}\n\n\n//NewMsg.MinuteOn = Timesettings.MinuteOn;\n\n//parseFloat(parseFloat(OnClutchLimit).toFixed(3));\n\n//var Clutch = msg.payload;\n\n//context.set('mydata', msg.payload);\n//NewMsg.limit = msg.payload;\n\nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\nif( msg.Topic == \"ACTUALVALUE\")\n\n{  NewMsg.Timespan = msg.Timespan;\n\n    if( msg.Timespan >= Settings.OnClutchLimit)\n    {\n       NewMsg.payload = PassActualValue;\n    }\n    else\n    {\n       NewMsg.payload = BlockActualValue;\n   }\n}\n//if( msg.payload.OnClutchLimit == 'OnClutchLimit')\n//{\n    //context.set('OnClutchLimit', OnClutchLimit);\n//}\nreturn NewMsg;","outputs":1,"noerr":0,"x":540,"y":240,"wires":[["a02b8825.05b758","2b4e97ee.910658"]]},{"id":"a02b8825.05b758","type":"switch","z":"60b4d38a.a1148c","name":"GreaterThanZero","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":240,"wires":[["382c3276.945cbe"]]},{"id":"7dbb5b61.bbee34","type":"debug","z":"60b4d38a.a1148c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":360,"y":220,"wires":[]},{"id":"2b4e97ee.910658","type":"debug","z":"60b4d38a.a1148c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":320,"wires":[]},{"id":"18a0b49d.92060b","type":"function","z":"60b4d38a.a1148c","name":"GlobalSet","func":"global.set(\"SpaceStarSettings\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":480,"wires":[["b1c93504.9c55c8"]]},{"id":"b1c93504.9c55c8","type":"debug","z":"60b4d38a.a1148c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":480,"wires":[]},{"id":"4acef5c.85c7c0c","type":"debug","z":"60b4d38a.a1148c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":540,"y":560,"wires":[]},{"id":"5ce393d3.af42dc","type":"function","z":"60b4d38a.a1148c","name":"","func":"var NewMsg = {payload: 0, timespan: 0, OnClutchLimit: 0};\nvar Settings = global.get(\"SpaceStarSettings\");\nNewMsg.OnClutchLimit = Settings.OnClutchLimit;\nNewMsg.payload = 1;\nNewMsg.timespan = 999; \nreturn NewMsg;","outputs":1,"noerr":0,"x":350,"y":540,"wires":[["4acef5c.85c7c0c"]]},{"id":"89c325a3.8f2708","type":"inject","z":"60b4d38a.a1148c","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":170,"y":540,"wires":[["5ce393d3.af42dc"]]},{"id":"448fefa5.dfa64","type":"q-gate","z":"6f2009d6.0acd88","name":"q-gate demo","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","maxQueueLength":"5","keepNewest":false,"qToggle":false,"persist":false,"x":430,"y":240,"wires":[["f43e6dd4.4a09b"]]},{"id":"325e9fce.e72a4","type":"inject","z":"6f2009d6.0acd88","name":"input","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":240,"wires":[["448fefa5.dfa64"]]},{"id":"5aebc459.1a32dc","type":"inject","z":"6f2009d6.0acd88","name":"open","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"open","payloadType":"str","x":190,"y":60,"wires":[["448fefa5.dfa64"]]},{"id":"1e67eaee.86a275","type":"inject","z":"6f2009d6.0acd88","name":"toggle","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"toggle","payloadType":"str","x":190,"y":140,"wires":[["448fefa5.dfa64"]]},{"id":"29dc06db.76384a","type":"inject","z":"6f2009d6.0acd88","name":"close","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"close","payloadType":"str","x":190,"y":100,"wires":[["448fefa5.dfa64"]]},{"id":"37fd4001.55728","type":"inject","z":"6f2009d6.0acd88","name":"default","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"default","payloadType":"str","x":190,"y":180,"wires":[["448fefa5.dfa64"]]},{"id":"f43e6dd4.4a09b","type":"debug","z":"6f2009d6.0acd88","name":"output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":590,"y":240,"wires":[]},{"id":"e07cd047.9ebbc","type":"inject","z":"6f2009d6.0acd88","name":"queue","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"queue","payloadType":"str","x":190,"y":300,"wires":[["448fefa5.dfa64"]]},{"id":"bb91375f.eb7068","type":"inject","z":"6f2009d6.0acd88","name":"flush","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"flush","payloadType":"str","x":190,"y":380,"wires":[["448fefa5.dfa64"]]},{"id":"183a0088.975a7f","type":"inject","z":"6f2009d6.0acd88","name":"trigger","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"trigger","payloadType":"str","x":190,"y":340,"wires":[["448fefa5.dfa64"]]},{"id":"91c32e65.3ecda","type":"inject","z":"6f2009d6.0acd88","name":"reset","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"control","payload":"reset","payloadType":"str","x":190,"y":420,"wires":[["448fefa5.dfa64"]]},{"id":"1cea54e.528f3ab","type":"file","z":"6f2009d6.0acd88","name":"","filename":"/home/odroid/PIN22/PIN22","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":180,"y":540,"wires":[[]]},{"id":"f315d132.96f28","type":"function","z":"6f2009d6.0acd88","d":true,"name":"reinjecttobuffer","func":"var NewArray = [];\nvar TimestampNewest = 0;\nvar SignalNewest = '0';\n\n\n//var d = msg.payload[3][0];\n  \nTimestampNewest = msg.payload[3][0];\nSignalNewest = msg.payload[3][1];\n\nNewArray.push(TimestampNewest);\nNewArray.push(SignalNewest);\n\nmsg.payload = NewArray;\nreturn msg;\n\n\n\n","outputs":1,"noerr":0,"x":140,"y":600,"wires":[[]]},{"id":"cd863607.6f7d18","type":"rpi-gpio in","z":"cfd7352b.de1028","d":true,"name":"","pin":"4","intype":"tri","debounce":"25","read":false,"bcm":true,"x":130,"y":540,"wires":[["80a68061.c823e"]]},{"id":"78bd41e5.4eea6","type":"function","z":"cfd7352b.de1028","name":"SavedCounter","func":"var NewMsg = {savedcounter:0}\nvar count=context.get('mystorage') || 0;\nvar savedcounter = 0;\n\nif( msg.topic === 'signal' )\n{\n  count ++;\n}\n\nif( msg.topic === 'ResetCounter' )\n{\n  savedcounter = count;\n  count = 0;\n}\n\ncontext.set('mystorage',count);\nNewMsg.savedcounter = savedcounter; \n\nreturn NewMsg;\n\n","outputs":1,"noerr":0,"x":260,"y":300,"wires":[["547d022c.ca8d0c","7d7e341c.b0a86c"]]},{"id":"547d022c.ca8d0c","type":"debug","z":"cfd7352b.de1028","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":420,"y":320,"wires":[]},{"id":"1d7e9310.6bf2fd","type":"inject","z":"cfd7352b.de1028","name":"","props":[{"p":"payload","v":"true","vt":"bool"},{"p":"topic","v":"Signal","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Signal","payload":"true","payloadType":"bool","x":180,"y":420,"wires":[["80a68061.c823e"]]},{"id":"7d7e341c.b0a86c","type":"function","z":"cfd7352b.de1028","name":"VelocitiyCalculation","func":"var NewMsg = {velocity:0};\nvar savedcounter = msg.payload;\nNewMsg.velocity = (20 / 17) * savedcounter + (60 / 17);\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":160,"wires":[["93e322bc.6ae9c"]]},{"id":"93e322bc.6ae9c","type":"debug","z":"cfd7352b.de1028","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":240,"wires":[]},{"id":"caf8c4a3.b53d38","type":"inject","z":"cfd7352b.de1028","name":"","props":[{"p":"payload","v":"reset","vt":"str"},{"p":"topic","v":"ResetCounter","vt":"string"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"ResetCounter","payload":"reset","payloadType":"str","x":140,"y":600,"wires":[["80a68061.c823e"]]},{"id":"c9cad5df.c4aa38","type":"debug","z":"cfd7352b.de1028","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":810,"y":540,"wires":[]},{"id":"80a68061.c823e","type":"function","z":"cfd7352b.de1028","name":"VELOCITY_GATE","func":"var NewMsg = { payload : 0, Speed : 0};\nvar Counter = context.get('Counter') || 0;\nvar OpenSwitchNode = 1;\nvar CloseSwitchNode = 0;\n\nif( msg.topic == \"Signal\" )\n{\n    Counter++;\n}\n\nNewMsg.payload = CloseSwitchNode;\n\nif( msg.topic == \"ResetCounter\" )\n{ \n    \n    NewMsg.payload = OpenSwitchNode;\n    NewMsg.Speed = (20 / 17) * Counter * 5  + (60 / 17);\n  \n    Counter = 0;\n}\n\ncontext.set('Counter', Counter);\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":540,"wires":[["fac4e743.ab3158"]]},{"id":"fac4e743.ab3158","type":"switch","z":"cfd7352b.de1028","name":"Moving","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":540,"wires":[["c9cad5df.c4aa38"]]},{"id":"fe7e0163.315f2","type":"ui_numeric","z":"fdee7a45.860e48","name":"","label":"numeric","tooltip":"","group":"ff3d23ed.851e","order":3,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","topicType":"str","format":"{{value}}","min":0,"max":10,"step":1,"x":140,"y":200,"wires":[["577d15e3.d8ee7c"]]},{"id":"589b722d.0ae44c","type":"debug","z":"fdee7a45.860e48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":80,"wires":[]},{"id":"577d15e3.d8ee7c","type":"function","z":"fdee7a45.860e48","name":"LEVEL_CHECK","func":"var NewMsg = { payload : 0, Information : ''};\nvar Level = context.get('Level') || 0;\n\nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\nif( msg.topic == 'ACTUAL_VALUE')\n{\n    if( Level >= msg.payload   )\n    {\n        NewMsg.payload = PassActualValue;\n        NewMsg.Information = 'AnyInformation';\n    }\n    else\n    {\n        NewMsg.payload = BlockActualValue;\n    }\n}\nelse\n{\n   Level = msg.payload;\n}\n\ncontext.set('Level', Level);\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":420,"y":140,"wires":[["4e1950ff.c9a4e","116c0629.0ebd6a"]]},{"id":"66ef82d2.acd66c","type":"inject","z":"fdee7a45.860e48","name":"","repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"ACTUAL_VALUE","payload":"3","payloadType":"num","x":120,"y":120,"wires":[["2d4682ef.728b7e"]]},{"id":"4e1950ff.c9a4e","type":"switch","z":"fdee7a45.860e48","name":"GreaterThanZero","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":140,"wires":[["4b6540c7.dba7c"]]},{"id":"4b6540c7.dba7c","type":"debug","z":"fdee7a45.860e48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":810,"y":140,"wires":[]},{"id":"116c0629.0ebd6a","type":"debug","z":"fdee7a45.860e48","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":570,"y":200,"wires":[]},{"id":"2d4682ef.728b7e","type":"switch","z":"fdee7a45.860e48","name":"ANY","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":80,"wires":[["589b722d.0ae44c","577d15e3.d8ee7c"]]},{"id":"5e907e84.91bb8","type":"file","z":"fdee7a45.860e48","name":"","filename":"/home/odroid/.node-red/SpaceStarSettings.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":220,"y":380,"wires":[[]]},{"id":"f2cc5b5c.e245d8","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":790,"y":360,"wires":[]},{"id":"5da3cecc.2575f","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":320,"wires":[]},{"id":"a70e5ded.c0b1a","type":"function","z":"93d7b78b.d2d2d8","name":"SH1_UDP","func":"\nvar highCounter_SH1 = flow.get(\"highCounter_SH1\")||0;\nvar lowCounter_SH1 = flow.get(\"lowCounter_SH1\")||0;\n//highCounter = 0;\n//lowCounter = 0;\n\n//count up\nif (lowCounter_SH1 >= 255)\n{highCounter_SH1++; lowCounter_SH1 = 0;}\nif (highCounter_SH1 >= 255) {highCounter_SH1 = 0; lowCounter_SH1++;}\n\nlowCounter_SH1++;\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Param1, msg.payload[0].Param2, msg.payload[0].DC]);\nmsg.payload[9] = highCounter_SH1;\nmsg.payload[10] = lowCounter_SH1;\n\n\nflow.set(\"highCounter_SH1\",highCounter_SH1);\nflow.set(\"lowCounter_SH1\",lowCounter_SH1);\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":360,"wires":[["5da3cecc.2575f","f2cc5b5c.e245d8"]]},{"id":"ce536a46.7d6eb8","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"multi","x":790,"y":80,"wires":[]},{"id":"5902dd22.936594","type":"function","z":"93d7b78b.d2d2d8","name":"PW0_UDP","func":"\nvar highCounter_PW0 = flow.get(\"highCounter_PW0\")||0;\nvar lowCounter_PW0 = flow.get(\"lowCounter_PW0\")||0;\n//highCounter = 0;\n//lowCounter = 0;\n\n//count up\nif (lowCounter_PW0 >= 255)\n{highCounter_PW0++; lowCounter_PW0 = 0;}\nif (highCounter_PW0 >= 255) {highCounter_PW0 = 0; lowCounter_PW0++;}\n\nlowCounter_PW0++;\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Param1, msg.payload[0].Param2, msg.payload[0].DC]);\nmsg.payload[9] = highCounter_PW0;\nmsg.payload[10] = lowCounter_PW0;\n\n\nflow.set(\"highCounter_PW0\",highCounter_PW0);\nflow.set(\"lowCounter_PW0\",lowCounter_PW0);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":80,"wires":[["ce536a46.7d6eb8","1375a5de.59c95a"]]},{"id":"617ee4ca.5518ac","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":80,"wires":[["5902dd22.936594"]]},{"id":"5bc23bd4.72bb44","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT PW0","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2, DC FROM sepp89117 WHERE UniqueID = 16\";\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":80,"wires":[["617ee4ca.5518ac"]]},{"id":"75afe49e.b09dac","type":"inject","z":"93d7b78b.d2d2d8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":80,"wires":[["5bc23bd4.72bb44"]]},{"id":"1375a5de.59c95a","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":40,"wires":[]},{"id":"218ac4fc.7f49dc","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":360,"wires":[["a70e5ded.c0b1a","105e2bd2.1e8f44"]]},{"id":"78df025d.595e2c","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT SH1","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2, DC FROM sepp89117 WHERE UniqueID = 19\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":360,"wires":[["218ac4fc.7f49dc"]]},{"id":"67e6fa7d.fe39d4","type":"inject","z":"93d7b78b.d2d2d8","name":"","props":[{"p":"payload","v":"true","vt":"bool"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":360,"wires":[["78df025d.595e2c"]]},{"id":"7b9050f2.cbb5d","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":790,"y":520,"wires":[]},{"id":"20f6d8d0.575768","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":480,"wires":[]},{"id":"d42b2663.3383b8","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":520,"wires":[["b1837ec5.0461a"]]},{"id":"60680ce2.da8a54","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT TAG","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, P, A, DC, `14` FROM PA WHERE UniqueID = 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":520,"wires":[["d42b2663.3383b8"]]},{"id":"1621f145.aee1ff","type":"inject","z":"93d7b78b.d2d2d8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":520,"wires":[["60680ce2.da8a54"]]},{"id":"b1837ec5.0461a","type":"function","z":"93d7b78b.d2d2d8","name":"TAG_UDP","func":"\nvar highCounter_TAG = flow.get(\"highCounter_TAG\")||0;\nvar lowCounter_TAG = flow.get(\"lowCounter_TAG\")||0;\n//lowCounter_TAG=0;\n\n//count up\nif (lowCounter_TAG >= 255)\n{highCounter_TAG++; lowCounter_TAG = 0;}\nif (highCounter_TAG >= 255) {highCounter_TAG = 0; lowCounter_TAG++;}\n\nlowCounter_TAG++;\n\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].P, msg.payload[0].A, msg.payload[0].DC, msg.payload[0][\"14\"]]);\nmsg.payload[9] = highCounter_TAG;\nmsg.payload[10] = lowCounter_TAG;\n\nflow.set(\"highCounter_TAG\",highCounter_TAG);\nflow.set(\"lowCounter_TAG\",lowCounter_TAG);\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":520,"wires":[["7b9050f2.cbb5d","20f6d8d0.575768"]]},{"id":"75b5fea0.4a916","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":790,"y":680,"wires":[]},{"id":"65733c9d.b82024","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":640,"wires":[]},{"id":"37d6e955.24aec6","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":680,"wires":[["704903a7.d15fac"]]},{"id":"832c9299.605ee","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT SH0","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2, DC FROM sepp89117 WHERE UniqueID = 20\";\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":680,"wires":[["37d6e955.24aec6"]]},{"id":"cb3190ff.cc314","type":"inject","z":"93d7b78b.d2d2d8","name":"","props":[{"p":"payload","v":"true","vt":"bool"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":680,"wires":[["832c9299.605ee"]]},{"id":"704903a7.d15fac","type":"function","z":"93d7b78b.d2d2d8","name":"SH0_UDP","func":"\nvar highCounter_SH0 = flow.get(\"highCounter_SH0\")||0;\nvar lowCounter_SH0 = flow.get(\"lowCounter_SH0\")||0;\n\n\n//count up\nif (lowCounter_SH0 >= 255)\n{highCounter_SH0++; lowCounter_SH0 = 0;}\nif (highCounter_SH0 >= 255) {highCounter_SH0 = 0; lowCounter_SH0++;}\n \nlowCounter_SH0++;\n\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Param1, msg.payload[0].Param2, msg.payload[0].DC]);\nmsg.payload[9] = highCounter_SH0;\nmsg.payload[10] = lowCounter_SH0;\n\n\nflow.set(\"highCounter_SH0\",highCounter_SH0);\nflow.set(\"lowCounter_SH0\",lowCounter_SH0);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":680,"wires":[["75b5fea0.4a916","65733c9d.b82024"]]},{"id":"38b09824.3716a8","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":790,"y":840,"wires":[]},{"id":"c9a1ad3.ddd645","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":800,"wires":[]},{"id":"de8879d5.6739e8","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":840,"wires":[["524bf47d.e5aebc"]]},{"id":"f0dfd245.aad12","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT YY_SV","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Y1, Y2, DC, `14`, `15`, `16`, `17`, `18`, `19`, `20` FROM YY WHERE UniqueID = 185\";\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":840,"wires":[["de8879d5.6739e8"]]},{"id":"8719e4d.43d3f18","type":"inject","z":"93d7b78b.d2d2d8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":840,"wires":[["f0dfd245.aad12"]]},{"id":"524bf47d.e5aebc","type":"function","z":"93d7b78b.d2d2d8","name":"YY_SuperView","func":"\nvar highCounter_YY = flow.get(\"highCounter_YY\")||0;\nvar lowCounter_YY = flow.get(\"lowCounter_YY\")||0;\n//highCounter_YY = 0;\n//lowCounter_YY = 0;\n\n//count up\nif (lowCounter_YY >= 255)\n{highCounter_YY++; lowCounter_YY = 0;}\nif (highCounter_YY >= 255) {highCounter_YY = 0; lowCounter_YY++;}\n\nlowCounter_YY++;\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Y1, msg.payload[0].Y2, msg.payload[0].DC, msg.payload[0][\"14\"], msg.payload[0][\"15\"], msg.payload[0][\"16\"], msg.payload[0][\"17\"], msg.payload[0][\"18\"], msg.payload[0][\"19\"], msg.payload[0][\"20\"]]);\nmsg.payload[9] = highCounter_YY;\nmsg.payload[10] = lowCounter_YY;\n\n\nflow.set(\"highCounter_YY\",highCounter_YY);\nflow.set(\"lowCounter_YY\",lowCounter_YY);\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":840,"wires":[["38b09824.3716a8","c9a1ad3.ddd645"]]},{"id":"105e2bd2.1e8f44","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":600,"y":440,"wires":[]},{"id":"ce30db16.3b3548","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"multi","x":790,"y":220,"wires":[]},{"id":"8de5bdc3.ef90f","type":"function","z":"93d7b78b.d2d2d8","name":"WT_UDP","func":"\nvar highCounter_PW0 = flow.get(\"highCounter_PW0\")||0;\nvar lowCounter_PW0 = flow.get(\"lowCounter_PW0\")||0;\n//highCounter = 0;\n//lowCounter = 0;\n\n//count up\nif (lowCounter_PW0 >= 255)\n{highCounter_PW0++; lowCounter_PW0 = 0;}\nif (highCounter_PW0 >= 255) {highCounter_PW0 = 0; lowCounter_PW0++;}\n\nlowCounter_PW0++;\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Param1, msg.payload[0].Param2]);\nmsg.payload[9] = highCounter_PW0;\nmsg.payload[10] = lowCounter_PW0;\n\n\nflow.set(\"highCounter_PW0\",highCounter_PW0);\nflow.set(\"lowCounter_PW0\",lowCounter_PW0);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":220,"wires":[["ce30db16.3b3548","b05aa66d.91f878"]]},{"id":"a04effc7.9722b","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":220,"wires":[["8de5bdc3.ef90f"]]},{"id":"50a436fa.ce1fc8","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT WT","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2 FROM sepp89117 WHERE UniqueID = 26\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":220,"wires":[["a04effc7.9722b"]]},{"id":"d65ffa4d.943628","type":"inject","z":"93d7b78b.d2d2d8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":220,"wires":[["50a436fa.ce1fc8"]]},{"id":"b05aa66d.91f878","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":180,"wires":[]},{"id":"8db0200a69fe56eb","type":"udp out","z":"93d7b78b.d2d2d8","name":"GoProHero5black send","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":790,"y":960,"wires":[]},{"id":"1fab55f7931c58aa","type":"debug","z":"93d7b78b.d2d2d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":920,"wires":[]},{"id":"5baa29c5922eab05","type":"mysql","z":"93d7b78b.d2d2d8","mydb":"395f2a47.6cfaf6","name":"","x":410,"y":960,"wires":[["14998246c2db41a0"]]},{"id":"f4e950ed697610b6","type":"function","z":"93d7b78b.d2d2d8","name":"SELECT sepp89117 Wifi?","func":"\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2, DC, `14`, `15`, `16`, `17`, `18`, `19`, `20` FROM sepp89117 WHERE UniqueID = 26\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":1020,"wires":[["5baa29c5922eab05"]]},{"id":"e451db0a6971d5ee","type":"inject","z":"93d7b78b.d2d2d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":960,"wires":[["f4e950ed697610b6"]]},{"id":"14998246c2db41a0","type":"function","z":"93d7b78b.d2d2d8","name":"sepp89117_Wifi","func":"\nvar highCounter_sepp89117 = flow.get(\"highCounter_sepp89117\")||0;\nvar lowCounter_sepp89117 = flow.get(\"lowCounter_sepp89117\")||0;\n//highCounter_YY = 0;\n//lowCounter_YY = 0;\n\n//count up\nif (lowCounter_sepp89117 >= 255)\n{highCounter_sepp89117++; lowCounter_sepp89117 = 0;}\nif (highCounter_sepp89117 >= 255) {highCounter_sepp89117 = 0; lowCounter_sepp89117++;}\n\nlowCounter_sepp89117++;\n\nmsg.payload = new Buffer([msg.payload[0][\"0\"], msg.payload[0][\"1\"], msg.payload[0][\"2\"], msg.payload[0][\"3\"], msg.payload[0][\"4\"], msg.payload[0][\"5\"], msg.payload[0][\"6\"], msg.payload[0][\"7\"], msg.payload[0].Flag, msg.payload[0].HC, msg.payload[0].LC, msg.payload[0].Y1, msg.payload[0].Y2, msg.payload[0].DC, msg.payload[0][\"14\"], msg.payload[0][\"15\"], msg.payload[0][\"16\"], msg.payload[0][\"17\"], msg.payload[0][\"18\"], msg.payload[0][\"19\"], msg.payload[0][\"20\"]]);\nmsg.payload[9] = highCounter_sepp89117;\nmsg.payload[10] = lowCounter_sepp89117;\n\n\nflow.set(\"highCounter_sepp89117\",highCounter_sepp89117);\nflow.set(\"lowCounter_sepp89117\",lowCounter_sepp89117);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":960,"wires":[["8db0200a69fe56eb","1fab55f7931c58aa"]]},{"id":"e47d6455.773be8","type":"http request","z":"3b3462fd.256a6e","name":"Shutter Start","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":120,"wires":[["70822b34.c32404"]]},{"id":"70822b34.c32404","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":120,"wires":[]},{"id":"274f8f68.39c53","type":"function","z":"3b3462fd.256a6e","name":"SELECT SH1","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":120,"wires":[["90abbff8.af722"]]},{"id":"4bc40838.c74af8","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":120,"wires":[["274f8f68.39c53"]]},{"id":"90abbff8.af722","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":120,"wires":[["c59c303e.2238a"]]},{"id":"c59c303e.2238a","type":"change","z":"3b3462fd.256a6e","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":120,"wires":[["e47d6455.773be8"]]},{"id":"4c1adc33.0ed7d4","type":"http request","z":"3b3462fd.256a6e","name":"Shutter Stop","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1130,"y":180,"wires":[["4136d792.1fc7b8"]]},{"id":"4136d792.1fc7b8","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":180,"wires":[]},{"id":"41441899.8ee758","type":"function","z":"3b3462fd.256a6e","name":"SELECT SH0","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":180,"wires":[["7912c291.f1c57c"]]},{"id":"70e3aee1.b1dfd","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":180,"wires":[["41441899.8ee758"]]},{"id":"7912c291.f1c57c","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":180,"wires":[["4fce188d.2f1218"]]},{"id":"4fce188d.2f1218","type":"change","z":"3b3462fd.256a6e","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":180,"wires":[["4c1adc33.0ed7d4"]]},{"id":"53c0c2df.efa81c","type":"http request","z":"3b3462fd.256a6e","name":"Wifi Streaming ON","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":240,"wires":[["f853b92d.c19b68"]]},{"id":"f853b92d.c19b68","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":240,"wires":[]},{"id":"66139b9b.9b5794","type":"function","z":"3b3462fd.256a6e","name":"SELECT Wifi Streamin ON","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 3\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":240,"wires":[["78e60035.2ac58"]]},{"id":"4a47f36.c380f0c","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":240,"wires":[["66139b9b.9b5794"]]},{"id":"78e60035.2ac58","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":240,"wires":[["9356c9de.95baf8"]]},{"id":"9356c9de.95baf8","type":"change","z":"3b3462fd.256a6e","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":240,"wires":[["53c0c2df.efa81c"]]},{"id":"416dc56c.d88b9c","type":"http request","z":"3b3462fd.256a6e","name":"Wifi Streaming OFF","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1150,"y":300,"wires":[["1224d8c.7d01227"]]},{"id":"1224d8c.7d01227","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":300,"wires":[]},{"id":"62c03c45.bc68c4","type":"function","z":"3b3462fd.256a6e","name":"SELECT Wifi Streamin OFF","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 4\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":300,"wires":[["61ce09ab.747bb8"]]},{"id":"d6654b6b.37b148","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":300,"wires":[["62c03c45.bc68c4"]]},{"id":"61ce09ab.747bb8","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":300,"wires":[["f865749f.a475a8"]]},{"id":"f865749f.a475a8","type":"change","z":"3b3462fd.256a6e","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":300,"wires":[["416dc56c.d88b9c"]]},{"id":"4b0674c.6ada48c","type":"function","z":"3b3462fd.256a6e","name":"SELECT Finalize Pairing","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 25\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":440,"wires":[["12a62722.852499"]]},{"id":"86dde41c.b83b88","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":440,"wires":[["4b0674c.6ada48c"]]},{"id":"12a62722.852499","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":440,"wires":[["38cb0704.3dde38"]]},{"id":"48ea15a2.67430c","type":"http request","z":"3b3462fd.256a6e","name":"Connect to GoProAP","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1160,"y":440,"wires":[["f19a1a82.a53758"]]},{"id":"f19a1a82.a53758","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":440,"wires":[]},{"id":"38cb0704.3dde38","type":"function","z":"3b3462fd.256a6e","name":"get global DeviceName","func":"var DeviceName_called = global.get('DeviceName');\nmsg.url = msg.payload[0].http + DeviceName_called;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":440,"wires":[["48ea15a2.67430c"]]},{"id":"854683526ecec08b","type":"http request","z":"3b3462fd.256a6e","name":"Switch to APP/Smartphone Mode","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1200,"y":360,"wires":[["c61c7472287f1cea"]]},{"id":"c61c7472287f1cea","type":"debug","z":"3b3462fd.256a6e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1430,"y":360,"wires":[]},{"id":"467c234a05a8a252","type":"function","z":"3b3462fd.256a6e","name":"SELECT Switch to APP/Smartphone Mode","func":"msg.topic = \"SELECT info, http FROM HTTP WHERE UniqueID = 336\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":360,"wires":[["c61bb13e274ec39c"]]},{"id":"bac0d85ee5aa853e","type":"inject","z":"3b3462fd.256a6e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":150,"y":360,"wires":[["467c234a05a8a252"]]},{"id":"c61bb13e274ec39c","type":"mysql","z":"3b3462fd.256a6e","mydb":"760a3e67.03abe","name":"","x":690,"y":360,"wires":[["b1491fdfd0fe4ca9"]]},{"id":"b1491fdfd0fe4ca9","type":"change","z":"3b3462fd.256a6e","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload[0].http","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":360,"wires":[["854683526ecec08b"]]},{"id":"4396ec6d35e914eb","type":"link in","z":"3b3462fd.256a6e","name":"HTTP_from_MySQL_FinalizePairing --> BLE_Connection","links":["8ce9c8e7bb67d23a"],"x":105,"y":520,"wires":[["4b0674c.6ada48c"]]},{"id":"94ef5a6a.575dd8","type":"function","z":"c1d663c3.e4762","name":"SELECT ShutterStart","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":140,"wires":[["8129afe1.4dc6"]]},{"id":"8129afe1.4dc6","type":"mysql","z":"c1d663c3.e4762","mydb":"230fd081.affe6","name":"","x":510,"y":460,"wires":[["81c8be60.6f898","6eebaf45565b1d75"]]},{"id":"94ccc4b.2a2ce38","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":140,"wires":[["94ef5a6a.575dd8"]]},{"id":"81c8be60.6f898","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":520,"wires":[]},{"id":"3111cc30.1ac844","type":"function","z":"c1d663c3.e4762","name":"SELECT ShutterStop","func":"msg.topic = \"SELECT BLE, HW1, HW2, HW3, HW4, HW5, HW6 FROM BLE WHERE UniqueID = 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":1700,"wires":[["600153a2.50f20c"]]},{"id":"600153a2.50f20c","type":"mysql","z":"c1d663c3.e4762","mydb":"230fd081.affe6","name":"","x":650,"y":1700,"wires":[["f1b83326.d71af","b9d09920.031298"]]},{"id":"fc46e3e5.a2abe","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":1700,"wires":[["3111cc30.1ac844"]]},{"id":"9e9a8819.0b3f28","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":1640,"wires":[]},{"id":"f1b83326.d71af","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1640,"wires":[]},{"id":"b9d09920.031298","type":"change","z":"c1d663c3.e4762","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{$join([payload[0].HW1,payload[0].HW2,payload[0].HW3]):$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1700,"wires":[["9e9a8819.0b3f28"]]},{"id":"ecb5bf13.b0193","type":"function","z":"c1d663c3.e4762","name":"SELECT WifiOff","func":"msg.topic = \"SELECT BLE, HW1, HW2, HW3, HW4, HW5, HW6 FROM BLE WHERE UniqueID = 22\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":1820,"wires":[["31158edf.7b4e22"]]},{"id":"31158edf.7b4e22","type":"mysql","z":"c1d663c3.e4762","mydb":"230fd081.affe6","name":"","x":650,"y":1820,"wires":[["435f41ab.0b84a","754dcec4.b8396"]]},{"id":"c27c3c3f.f64a1","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":1820,"wires":[["ecb5bf13.b0193"]]},{"id":"5404474f.871408","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":1760,"wires":[]},{"id":"435f41ab.0b84a","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1760,"wires":[]},{"id":"754dcec4.b8396","type":"change","z":"c1d663c3.e4762","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{$join([payload[0].HW1,payload[0].HW2,payload[0].HW3]):$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1820,"wires":[["5404474f.871408"]]},{"id":"79626f33.ba475","type":"function","z":"c1d663c3.e4762","name":"SELECT WifiOn","func":"msg.topic = \"SELECT BLE, HW1, HW2, HW3, HW4, HW5, HW6 FROM BLE WHERE UniqueID = 21\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":1920,"wires":[["26f38a9f.a02ee6"]]},{"id":"26f38a9f.a02ee6","type":"mysql","z":"c1d663c3.e4762","mydb":"230fd081.affe6","name":"","x":650,"y":1920,"wires":[["d61b1ad7.cb3678","54fe550f.1fe01c"]]},{"id":"b814a5cf.52ca98","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":180,"y":1920,"wires":[["79626f33.ba475"]]},{"id":"5df4937.6a7326c","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":1860,"wires":[]},{"id":"d61b1ad7.cb3678","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1860,"wires":[]},{"id":"54fe550f.1fe01c","type":"change","z":"c1d663c3.e4762","name":"BLE Command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{$join([payload[0].HW1,payload[0].HW2,payload[0].HW3]):$.payload[0].BLE}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1920,"wires":[["5df4937.6a7326c"]]},{"id":"6eebaf45565b1d75","type":"function","z":"c1d663c3.e4762","name":"","func":"\nvar HW1 = msg.payload[0].HW1;\nvar HW2 = msg.payload[0].HW2;\nvar HW3 = msg.payload[0].HW3;\nvar HW4 = msg.payload[0].HW4;\nvar HW5 = msg.payload[0].HW5;\nvar HW6 = msg.payload[0].HW6;\nvar Separator = \"-\";\nvar BLE = msg.payload[0].BLE_HEX;\nvar Info = msg.payload[0].Info;\n\nmsg.handle = HW1 + HW2 + Separator + HW3 + Separator + HW4 + Separator + HW5 + Separator + HW6;\nmsg.command = BLE;\nmsg.payload = \" \" + \"'\" + msg.handle + \"'\" + \" \" + '\"' + \"'\" + msg.command + \"'\" + '\"';\nmsg.topic = Info;\n\n//msg.handle = msg.payload[0].HW1.concat(msg.payload[0].HW2)'-'msg.payload[0].HW3'-'msg.payload[0].HW4'-'msg.payload[0].HW5'-'msg.payload[0].HW6;\nreturn msg;\n\n//payload[0].HW1","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":460,"wires":[["474e313c5facf6a2","69d8b0540fffd91d"]]},{"id":"474e313c5facf6a2","type":"debug","z":"c1d663c3.e4762","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":520,"wires":[]},{"id":"69d8b0540fffd91d","type":"exec","z":"c1d663c3.e4762","command":"/home/odroid/BLE_command.sh","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"BLE Command bluetoothctl","x":880,"y":460,"wires":[["7d6f14187c2a3d90"],["20ec74095d90203a"],["bc31011a9c1c4fda"]]},{"id":"7d6f14187c2a3d90","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1110,"y":420,"wires":[]},{"id":"20ec74095d90203a","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1110,"y":460,"wires":[]},{"id":"bc31011a9c1c4fda","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1110,"y":500,"wires":[]},{"id":"3c56acc368eaf4e5","type":"exec","z":"c1d663c3.e4762","command":"sudo gatttool -t random -b ${BLE_DeviceMAC} --char-write-req -a 0x2f -n 03010100","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"BLE Command gatttool ShutterStart","x":440,"y":1540,"wires":[["0e05fd869da97cfd"],["e0a0117c41b14070"],["8c471add432eecce"]]},{"id":"4ff88a6390253b2d","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"gatt.write \"0x03 0x01 0x01 0x01\"","payloadType":"str","x":190,"y":1540,"wires":[["3c56acc368eaf4e5"]]},{"id":"0e05fd869da97cfd","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":1500,"wires":[]},{"id":"e0a0117c41b14070","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":1540,"wires":[]},{"id":"8c471add432eecce","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":1580,"wires":[]},{"id":"fd83f27e9520e35b","type":"function","z":"c1d663c3.e4762","name":"SELECT ShutterStop","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":220,"wires":[["8129afe1.4dc6"]]},{"id":"c1239b3008c5d678","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":220,"wires":[["fd83f27e9520e35b"]]},{"id":"e5a95128e716958e","type":"function","z":"c1d663c3.e4762","name":"SELECT WifiOn","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 21\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":320,"wires":[["8129afe1.4dc6"]]},{"id":"4e50935cb0080d73","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":320,"wires":[["e5a95128e716958e"]]},{"id":"12c3c09346a48c23","type":"function","z":"c1d663c3.e4762","name":"SELECT WifiOff","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 22\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":380,"wires":[["8129afe1.4dc6"]]},{"id":"3e85613b30c6bb8c","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":380,"wires":[["12c3c09346a48c23"]]},{"id":"df5474b0f153be3b","type":"comment","z":"c1d663c3.e4762","name":"Gatttool","info":"","x":70,"y":1480,"wires":[]},{"id":"6fd57836c2e115ae","type":"comment","z":"c1d663c3.e4762","name":"Bluetoothctl","info":"","x":90,"y":40,"wires":[]},{"id":"a3c0395231a9d7eb","type":"comment","z":"c1d663c3.e4762","name":"old","info":"","x":70,"y":1640,"wires":[]},{"id":"7c9275150c9dc48e","type":"function","z":"c1d663c3.e4762","name":"SELECT 2.7k","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 59\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":540,"wires":[["8129afe1.4dc6"]]},{"id":"1861268a59492191","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":70,"y":540,"wires":[["7c9275150c9dc48e"]]},{"id":"c237aa55c02d09e8","type":"function","z":"c1d663c3.e4762","name":"SELECT Keep Alive","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 29\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":480,"wires":[["8129afe1.4dc6"]]},{"id":"475f3ec860291e22","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":70,"y":480,"wires":[["c237aa55c02d09e8"]]},{"id":"4caf7d9baf7e5c89","type":"function","z":"c1d663c3.e4762","name":"SELECT PowerOff Sleep","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 16\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":700,"wires":[["8129afe1.4dc6"]]},{"id":"5a0aee830540b1e8","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":70,"y":700,"wires":[["4caf7d9baf7e5c89"]]},{"id":"cf9f46f99f189868","type":"function","z":"c1d663c3.e4762","name":"SELECT PowerOff Force","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 17\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":780,"wires":[["8129afe1.4dc6"]]},{"id":"d33cdd9e32428789","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":70,"y":780,"wires":[["cf9f46f99f189868"]]},{"id":"d4ba938b9fb35d98","type":"function","z":"c1d663c3.e4762","name":"SELECT 4k","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 58\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":620,"wires":[["8129afe1.4dc6"]]},{"id":"522b6ecdd01751bf","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":70,"y":620,"wires":[["d4ba938b9fb35d98"]]},{"id":"4fc071f8f4099767","type":"link in","z":"c1d663c3.e4762","name":"BLE_from_MySQL_WifiON --> DB_Connectivity","links":["b49b16636bd5a31d","e9d643b0afa6ce8e"],"x":55,"y":280,"wires":[["e5a95128e716958e"]]},{"id":"f36ab2a57d4342e7","type":"function","z":"c1d663c3.e4762","name":"SELECT AP Control","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 32\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":860,"wires":[["8129afe1.4dc6"]]},{"id":"fa87d5be45b1ac27","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":860,"wires":[["f36ab2a57d4342e7"]]},{"id":"8768cbfecee1f14a","type":"mysql","z":"c1d663c3.e4762","mydb":"230fd081.affe6","name":"","x":530,"y":1200,"wires":[["ad5c85b59e0c6cd5"]]},{"id":"ad5c85b59e0c6cd5","type":"function","z":"c1d663c3.e4762","name":"","func":"\nvar HR1 = msg.payload[0].HR1;\nvar HR2 = msg.payload[0].HR2;\nvar HR3 = msg.payload[0].HR3;\nvar HR4 = msg.payload[0].HR4;\nvar HR5 = msg.payload[0].HR5;\nvar HR6 = msg.payload[0].HR6;\nvar Separator = \"-\";\nvar BLE = msg.payload[0].BLE;\nvar Info = msg.payload[0].Info;\n\nmsg.handle = HR1 + HR2 + Separator + HR3 + Separator + HR4 + Separator + HR5 + Separator + HR6;\nmsg.command = BLE;\nmsg.payload = \" \" + \"'\" + msg.handle + \"'\" + \" \" + '\"' + \"'\" + msg.command + \"'\" + '\"';\nmsg.topic = Info;\n\n//msg.handle = msg.payload[0].HW1.concat(msg.payload[0].HW2)'-'msg.payload[0].HW3'-'msg.payload[0].HW4'-'msg.payload[0].HW5'-'msg.payload[0].HW6;\nreturn msg;\n\n//payload[0].HW1","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":1200,"wires":[["3522af4361ad2755"]]},{"id":"3522af4361ad2755","type":"exec","z":"c1d663c3.e4762","command":"/home/odroid/BLE_command.sh","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"BLE Command bluetoothctl","x":900,"y":1200,"wires":[["441e95e94062f6be"],["f87bf3aa5813d451"],["bfe49d48555494e5"]]},{"id":"e6e610505256f0be","type":"function","z":"c1d663c3.e4762","name":"SELECT Keep Alive","func":"msg.topic = \"SELECT BLE, HR1, HR2, HR3, HR4, HR5, HR6, Info FROM BLE WHERE UniqueID = 29\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":1200,"wires":[["8768cbfecee1f14a"]]},{"id":"7118d3d7f1d5d65e","type":"inject","z":"c1d663c3.e4762","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":1200,"wires":[["e6e610505256f0be"]]},{"id":"441e95e94062f6be","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1160,"wires":[]},{"id":"f87bf3aa5813d451","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1200,"wires":[]},{"id":"bfe49d48555494e5","type":"debug","z":"c1d663c3.e4762","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1150,"y":1240,"wires":[]},{"id":"9b6669d723fe0c31","type":"comment","z":"c1d663c3.e4762","name":"Write","info":"","x":90,"y":80,"wires":[]},{"id":"fa98be9d9ab839b3","type":"comment","z":"c1d663c3.e4762","name":"Acquire-notify","info":"","x":90,"y":1020,"wires":[]},{"id":"774008af.b12d28","type":"exec","z":"bffdc47c.00e2b8","command":"sudo service hostapd stop && sudo service hostapd start","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"AP stop/start","x":1030,"y":180,"wires":[[],[],[]]},{"id":"74c54fcc.7892c","type":"udp in","z":"bffdc47c.00e2b8","name":"GoProHero5black receive","iface":"","port":"8383","ipv":"udp4","multicast":"false","group":"10.71.79.101","datatype":"buffer","x":170,"y":220,"wires":[["267c4f26.18714","919dc491.0fd218"]]},{"id":"267c4f26.18714","type":"debug","z":"bffdc47c.00e2b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":210,"y":160,"wires":[]},{"id":"1ea5f37f.f9dd7d","type":"debug","z":"bffdc47c.00e2b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":120,"wires":[]},{"id":"6792e53f.592dbc","type":"trigger","z":"bffdc47c.00e2b8","name":"Watchdog2","op1":"","op2":"GoProOffline","op1type":"nul","op2type":"str","duration":"3.4","extend":true,"overrideDelay":false,"units":"s","reset":"GoProOnline","bytopic":"all","topic":"topic","outputs":1,"x":770,"y":180,"wires":[["1ea5f37f.f9dd7d","774008af.b12d28","361974a2.a6fe8c"]],"info":"setze \n\"dann\" \"warten auf\" auf 3 x var:delay des Heartbeats für beste Ergebnisse (nicht kürzer sonst beginnt er zu flappen!)\n\nDieses WakeUp Gopro bewirkt:\n1.) Overruled sozusagen die \"Automatische Kammeraabschaltung\" der GoPro - Settings und\n2.) dedektiert und behebt Abrisse in der UDP Kommunikation zwischen Node-red und GoProHero5Black"},{"id":"4c79bcae.17b294","type":"comment","z":"bffdc47c.00e2b8","name":"Checking UDP - GoPro Connection","info":"","x":160,"y":80,"wires":[]},{"id":"2cf3cb35.810924","type":"inject","z":"bffdc47c.00e2b8","name":"GoProCheck","repeat":"6.7","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"GoProCheck","payloadType":"str","x":460,"y":320,"wires":[["a7821d19.993b1"]]},{"id":"a7821d19.993b1","type":"trigger","z":"bffdc47c.00e2b8","name":"WatchDog1","op1":"","op2":"GoPro Dead","op1type":"nul","op2type":"str","duration":"6.5","extend":true,"units":"s","reset":"GoProOnline","bytopic":"all","outputs":1,"x":770,"y":280,"wires":[["6792e53f.592dbc","1b5f62b4.44c7ad"]]},{"id":"1b5f62b4.44c7ad","type":"debug","z":"bffdc47c.00e2b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":340,"wires":[]},{"id":"9bab2c6.e7fd8d","type":"debug","z":"bffdc47c.00e2b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":160,"wires":[]},{"id":"919dc491.0fd218","type":"change","z":"bffdc47c.00e2b8","name":"GoProOnline - Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"GoProOnline","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":220,"wires":[["a7821d19.993b1","9bab2c6.e7fd8d","6792e53f.592dbc","e674fa56.5827c8"]]},{"id":"e674fa56.5827c8","type":"link out","z":"bffdc47c.00e2b8","name":"WakeUp GoPro UDP_GoProOnline->DB_connectivity","links":["d810a272.2ce32"],"x":575,"y":260,"wires":[]},{"id":"361974a2.a6fe8c","type":"link out","z":"bffdc47c.00e2b8","name":"WakeUp GoPro UDP_GoProOffline->DB_connectivity","links":["d810a272.2ce32"],"x":875,"y":220,"wires":[]},{"id":"33979c2f.60bca4","type":"inject","z":"bffdc47c.00e2b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":940,"y":60,"wires":[["774008af.b12d28"]]},{"id":"e3dfbbe3.865c78","type":"tcp-ping","z":"bffdc47c.00e2b8","ip":"10.5.5.9","port":"80","count":"3","interval":"1000","timeout":"3000","topic":"check","name":"","x":420,"y":560,"wires":[["17f7f11d.79237f","ceec7588.fb0848"]]},{"id":"f88a0b5.04cbff8","type":"inject","z":"bffdc47c.00e2b8","name":"Check tcp","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"status.text","v":"","vt":"str"}],"repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"check","payload":"","payloadType":"date","x":250,"y":560,"wires":[["e3dfbbe3.865c78"]]},{"id":"17f7f11d.79237f","type":"debug","z":"bffdc47c.00e2b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":500,"wires":[]},{"id":"ceec7588.fb0848","type":"function","z":"bffdc47c.00e2b8","name":"GoProHttpConnected","func":"\n\nif (msg.payload.sent - msg.payload.success == 0) {\nmsg.status.text = \"common.status.connected\";\n}\nelse {\nmsg.status.text = \"common.status.disconnected\";\n}\n\nglobal.set('GoProHttpConnected',msg.status.text)\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":560,"wires":[["21b59e1.0a76362","8a81287b.a72b78"]]},{"id":"21b59e1.0a76362","type":"debug","z":"bffdc47c.00e2b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":600,"wires":[]},{"id":"8a81287b.a72b78","type":"link out","z":"bffdc47c.00e2b8","name":"WakeUp GoPro HTTP tcp Status->DB_Connectivity","links":["a4bef44c.c585c8"],"x":1075,"y":560,"wires":[]},{"id":"6cee525d.3254dc","type":"comment","z":"bffdc47c.00e2b8","name":"Checking tcp - GoPro AP","info":"","x":130,"y":440,"wires":[]},{"id":"8d3bb658.4ada48","type":"udp out","z":"89b9f172.e63fe","name":"GoProHero5black","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":630,"y":300,"wires":[]},{"id":"6fb463e9.40755c","type":"debug","z":"89b9f172.e63fe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":500,"y":180,"wires":[]},{"id":"368a4fa8.d54c4","type":"inject","z":"89b9f172.e63fe","d":true,"name":"","repeat":"1.55","crontab":"","once":false,"onceDelay":"0.5","topic":"","payload":"true","payloadType":"bool","x":140,"y":80,"wires":[["5e61020f.5fa4ac"]]},{"id":"5e61020f.5fa4ac","type":"function","z":"89b9f172.e63fe","name":"UDP_HeartBeat_batch","func":"\nvar highCounterStatusReport = flow.get(\"highCounterStatusReport\")||0;\nvar lowCounterStatusReport = flow.get(\"lowCounterStatusReport\")||0;\nvar highCounterLCDStatus = flow.get(\"highCounterLCDStatus\")||0;\nvar lowCounterLCDStatus = flow.get(\"lowCounterLCDStatus\")||0;\nvar Opener1 = {payload:new Buffer ([0x00])};\nvar Opener2 = {payload:new Buffer ([0x01])};\nvar LCDStatus = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C, 0x63]);\nvar StatusReport = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x74])\n\n//send Opener1\n//node.send(Opener1);\n//node.done();\n\n//send Opener2\n//node.send(Opener2);\n//node.done();\n\n\n//count up and send LCDStatus 5 times\nfor (var i = 0; i < 5; i++)\n\n{\nif (lowCounterLCDStatus >= 255)\n{highCounterLCDStatus++; lowCounterLCDStatus = 0;}\nif (highCounterLCDStatus >= 255) {highCounterLCDStatus = 0; lowCounterLCDStatus++;}\n\nlowCounterLCDStatus++;\n\nLCDStatus[9] = highCounterLCDStatus;\nLCDStatus[10] = lowCounterLCDStatus;\n\nvar NewLCDStatus = {payload:LCDStatus};\n\nnode.send(NewLCDStatus);\nnode.done();\n\nflow.set(\"highCounterLCDStatus\",highCounterLCDStatus);\nflow.set(\"lowCounterLCDStatus\",lowCounterLCDStatus);\n}\n\n\n//count up StatusReport\nif (lowCounterStatusReport >= 255)\n{highCounterStatusReport++; lowCounterStatusReport = 0;}\nif (highCounterStatusReport >= 255) {highCounterStatusReport = 0; lowCounterStatusReport++;}\n\nlowCounterStatusReport++;\n\nStatusReport[9] = highCounterStatusReport;\nStatusReport[10] = lowCounterStatusReport;\n\n\nflow.set(\"highCounterStatusReport\",highCounterStatusReport);\nflow.set(\"lowCounterStatusReport\",lowCounterStatusReport);\n\nreturn {payload:StatusReport};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":220,"wires":[["6fb463e9.40755c","8d3bb658.4ada48"]]},{"id":"f7dd97da.158c18","type":"function","z":"89b9f172.e63fe","name":"UDP_HeartBeat_singel","func":"\nvar highCounterStatusReport = flow.get(\"highCounterStatusReport\")||0;\nvar lowCounterStatusReport = flow.get(\"lowCounterStatusReport\")||0;\nvar highCounterLCDStatus = flow.get(\"highCounterLCDStatus\")||0;\nvar lowCounterLCDStatus = flow.get(\"lowCounterLCDStatus\")||0;\nvar Opener1 = {payload:new Buffer ([0x00])};\nvar Opener2 = {payload:new Buffer ([0x01])};\nvar LCDStatus = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C, 0x63]);\nvar StatusReport = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x74])\nvar delay = 800;\n\n\n//send Opener1\nsetTimeout(()=>{\nnode.send(Opener1);\nnode.done();\n}, delay);\n\n\n//send Opener2\nsetTimeout(()=>{\nnode.send(Opener2);\nnode.done();\n}, 2 * delay)\n\n//count up and send LCDStatus 5 times\n\n\nfor (var i = 0; i < 5; i++)\n{setTimeout(()=>\n{\nif (lowCounterLCDStatus >= 255)\n{highCounterLCDStatus++; lowCounterLCDStatus = 0;}\nif (highCounterLCDStatus >= 255) {highCounterLCDStatus = 0; lowCounterLCDStatus++;}\n\nlowCounterLCDStatus++;\n\nLCDStatus[9] = highCounterLCDStatus;\nLCDStatus[10] = lowCounterLCDStatus;\n\nvar NewLCDStatus = {payload:LCDStatus};\n\nnode.send(NewLCDStatus);\nnode.done();\n\nflow.set(\"highCounterLCDStatus\",highCounterLCDStatus);\nflow.set(\"lowCounterLCDStatus\",lowCounterLCDStatus);\n    \n}, 3 * delay + i * delay)}\n\n\n//count up StatusReport\nif (lowCounterStatusReport >= 255)\n{highCounterStatusReport++; lowCounterStatusReport = 0;}\nif (highCounterStatusReport >= 255) {highCounterStatusReport = 0; lowCounterStatusReport++;}\n\nlowCounterStatusReport++;\n\nStatusReport[9] = highCounterStatusReport;\nStatusReport[10] = lowCounterStatusReport;\n\n\nflow.set(\"highCounterStatusReport\",highCounterStatusReport);\nflow.set(\"lowCounterStatusReport\",lowCounterStatusReport);\n\nsetTimeout(()=>{\nnode.send({payload:StatusReport});\nnode.done();\n}, 8 * delay);","outputs":1,"noerr":0,"x":250,"y":420,"wires":[["5316125d.25b53c","212d622b.85f77e"]]},{"id":"6768f82f.e5de68","type":"inject","z":"89b9f172.e63fe","d":true,"name":"","repeat":"6.4","crontab":"","once":true,"onceDelay":"0","topic":"","payload":"true","payloadType":"bool","x":90,"y":340,"wires":[["f7dd97da.158c18"]]},{"id":"5316125d.25b53c","type":"debug","z":"89b9f172.e63fe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":380,"wires":[]},{"id":"212d622b.85f77e","type":"udp out","z":"89b9f172.e63fe","name":"GoProHero5black","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":630,"y":520,"wires":[]},{"id":"42bb9fad.e2d86","type":"function","z":"89b9f172.e63fe","name":"UDP_HeartBeat_sepp89117","func":"var LCDStatus = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6c, 0x63]);\nvar StatusReport = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x74]);\nvar Wait = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0x74]);\n\n//Intervall für Nachrichten senden\nvar delay = 800;\n\n// ein 2-Byte-Zähler für alle Nachrichten\nvar highCounter = 0;\nvar lowCounter = 0;\n\n// ein Indikator welche Nachricht diesesmal zu senden ist\nvar indicator = 0;\n\n//Setze Timer der gemäß Intervall ausführt\nsetInterval(()=>{\n    switch(indicator){\n        case 0:\n            Wait[9] = highCounter;\n            Wait[10] = lowCounter;\n            node.send({payload:Wait});\n            node.done();\n            indicator++; //Indikator hochzählen\n            break;\n        case 1:\n            StatusReport[9] = highCounter;\n            StatusReport[10] = lowCounter;\n            node.send({payload:StatusReport});\n            node.done();\n            indicator++; //Indikator hochzählen\n            break;\n        case 2:\n            LCDStatus[9] = highCounter;\n            LCDStatus[10] = lowCounter;            \n            node.send({payload:LCDStatus});\n            node.done();\n            indicator++; //Indikator hochzählen\n            break;\n        case 3:\n            StatusReport[9] = highCounter;\n            StatusReport[10] = lowCounter;\n            node.send({payload:StatusReport});\n            node.done();\n            indicator++; //Indikator zurücksetzen\n            break;\n    }\n\n    //Nachrichtenzähler hochzählen nachdem Nachricht gesendet wurde\n    lowCounter++;\n\n    //Sollte lowCounter > 255 sein (lowCounter > 0xFF), wird der highCounter erhöht und der lowCounter zurück auf 0 gesetzt\n    if (lowCounter > 255) {\n        highCounter++;\n        lowCounter = 0;\n    }\n    //Sollte highCounter > 255 sein (highCounter > 0xFF), wird auch der highCounter zurück auf 0 gesetzt\n    if (highCounter > 255) {\n        highCounter = 0;\n    }\n}, delay);","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":660,"wires":[["a4ce7172.89ca1","3ab68782.f99848","a861b82e.17c0b8"]]},{"id":"5f62ac67.66dd14","type":"inject","z":"89b9f172.e63fe","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3.2","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"true","payloadType":"bool","x":110,"y":580,"wires":[["42bb9fad.e2d86"]]},{"id":"a4ce7172.89ca1","type":"debug","z":"89b9f172.e63fe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":530,"y":620,"wires":[]},{"id":"3ab68782.f99848","type":"udp out","z":"89b9f172.e63fe","name":"GoProHero5black","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":650,"y":760,"wires":[]},{"id":"a358be1b.cf4f8","type":"function","z":"89b9f172.e63fe","name":"UDP_HeartBeat_sepp_merged_singel","func":"\nvar highCounterWait = flow.get(\"highCounterWait\")||0;\nvar lowCounterWait = flow.get(\"lowCounterWait\")||0;\nvar highCounterStatusReport = flow.get(\"highCounterStatusReport\")||0;\nvar lowCounterStatusReport = flow.get(\"lowCounterStatusReport\")||0;\nvar highCounterLCDStatus = flow.get(\"highCounterLCDStatus\")||0;\nvar lowCounterLCDStatus = flow.get(\"lowCounterLCDStatus\")||0;\nvar Wait = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x77, 0x74]);\nvar StatusReport = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x74])\nvar LCDStatus = new Buffer ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6C, 0x63, 0x05]);\nvar delay = 800;\n\n//count up Wait\n\nif (lowCounterWait >= 255)\n{highCounterWait++; lowCounterWait = 0;}\nif (highCounterWait >= 255) {highCounterWait = 0; lowCounterWait++;}\n\nlowCounterWait++;\n\nStatusReport[9] = highCounterWait;\nStatusReport[10] = lowCounterWait;\n\n\nflow.set(\"highCounterWait\",highCounterWait);\nflow.set(\"lowCounterWait\",lowCounterWait);\n\nsetTimeout(()=>{\nnode.send({payload:Wait});\nnode.done();\n}, delay);\n\n\n\n\n//count up StatusReport\n\nif (lowCounterStatusReport >= 255)\n{highCounterStatusReport++; lowCounterStatusReport = 0;}\nif (highCounterStatusReport >= 255) {highCounterStatusReport = 0; lowCounterStatusReport++;}\n\nlowCounterStatusReport++;\n\nStatusReport[9] = highCounterStatusReport;\nStatusReport[10] = lowCounterStatusReport;\n\n\nflow.set(\"highCounterStatusReport\",highCounterStatusReport);\nflow.set(\"lowCounterStatusReport\",lowCounterStatusReport);\n\nsetTimeout(()=>{\nnode.send({payload:StatusReport});\nnode.done();\n}, 2 * delay);\n\n\n\n//count up and send LCDStatus 2 times\n\nfor (var i = 0; i < 2; i++)\n{setTimeout(()=>\n{\nif (lowCounterLCDStatus >= 255)\n{highCounterLCDStatus++; lowCounterLCDStatus = 0;}\nif (highCounterLCDStatus >= 255) {highCounterLCDStatus = 0; lowCounterLCDStatus++;}\n\nlowCounterLCDStatus++;\n\nLCDStatus[9] = highCounterLCDStatus;\nLCDStatus[10] = lowCounterLCDStatus;\n\nvar NewLCDStatus = {payload:LCDStatus};\n\nnode.send(NewLCDStatus);\nnode.done();\n\nflow.set(\"highCounterLCDStatus\",highCounterLCDStatus);\nflow.set(\"lowCounterLCDStatus\",lowCounterLCDStatus);\n    \n}, 3 * delay + i * delay)};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":900,"wires":[["d50ac62c.d85e18","dbbce4dd.89ee78"]]},{"id":"6004adf1.594074","type":"inject","z":"89b9f172.e63fe","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3.2","crontab":"","once":true,"onceDelay":"0","topic":"","payload":"true","payloadType":"bool","x":90,"y":820,"wires":[["a358be1b.cf4f8"]]},{"id":"d50ac62c.d85e18","type":"debug","z":"89b9f172.e63fe","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":510,"y":860,"wires":[]},{"id":"dbbce4dd.89ee78","type":"udp out","z":"89b9f172.e63fe","name":"GoProHero5black","addr":"${GoPro_IP_from_Odroid_DHCP}","iface":"","port":"8484","ipv":"udp4","outport":"8383","base64":false,"multicast":"false","x":630,"y":1000,"wires":[]},{"id":"a861b82e.17c0b8","type":"link out","z":"89b9f172.e63fe","name":"UDP_Heartbeat->DB_connectivity","links":["1315e90e.09bc97","3c7feea1e849d162","55fa55a587dbe8f2"],"x":585,"y":700,"wires":[]},{"id":"565babb67fed3832","type":"inject","z":"fb013fe93cb41d30","name":"","props":[{"p":"payload"}],"repeat":"2","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":100,"wires":[["62746159d85e65b5"]]},{"id":"41649e89e9d80095","type":"comment","z":"fb013fe93cb41d30","name":"BLE_Heartbeat","info":"","x":140,"y":40,"wires":[]},{"id":"61752b4d9f525766","type":"mysql","z":"fb013fe93cb41d30","mydb":"230fd081.affe6","name":"","x":570,"y":160,"wires":[["58bd18d9694c7ded","322d8f0601f4dcde"]]},{"id":"58bd18d9694c7ded","type":"debug","z":"fb013fe93cb41d30","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":220,"wires":[]},{"id":"322d8f0601f4dcde","type":"function","z":"fb013fe93cb41d30","name":"","func":"\nvar HW1 = msg.payload[0].HW1;\nvar HW2 = msg.payload[0].HW2;\nvar HW3 = msg.payload[0].HW3;\nvar HW4 = msg.payload[0].HW4;\nvar HW5 = msg.payload[0].HW5;\nvar HW6 = msg.payload[0].HW6;\nvar Separator = \"-\";\nvar BLE = msg.payload[0].BLE_HEX;\nvar Info = msg.payload[0].Info;\n\nmsg.handle = HW1 + HW2 + Separator + HW3 + Separator + HW4 + Separator + HW5 + Separator + HW6;\nmsg.command = BLE;\nmsg.payload = \" \" + \"'\" + msg.handle + \"'\" + \" \" + '\"' + \"'\" + msg.command + \"'\" + '\"';\nmsg.topic = 'Keep Alive';\n\n//msg.handle = msg.payload[0].HW1.concat(msg.payload[0].HW2)'-'msg.payload[0].HW3'-'msg.payload[0].HW4'-'msg.payload[0].HW5'-'msg.payload[0].HW6;\nreturn msg;\n\n//payload[0].HW1","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":160,"wires":[["2cc2f615245302cd","d7acff986b8b5e8e"]]},{"id":"2cc2f615245302cd","type":"debug","z":"fb013fe93cb41d30","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":220,"wires":[]},{"id":"d7acff986b8b5e8e","type":"exec","z":"fb013fe93cb41d30","command":"/home/odroid/BLE_command.sh","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"BLE Command bluetoothctl","x":940,"y":160,"wires":[["fcbfff36abc6d52f"],["12cb176b2a84c499"],["899ed2cf1cee3462","6f499fb8d23beee5"]]},{"id":"fcbfff36abc6d52f","type":"debug","z":"fb013fe93cb41d30","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":120,"wires":[]},{"id":"12cb176b2a84c499","type":"debug","z":"fb013fe93cb41d30","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":160,"wires":[]},{"id":"899ed2cf1cee3462","type":"debug","z":"fb013fe93cb41d30","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":200,"wires":[]},{"id":"a63b9d66484a559b","type":"function","z":"fb013fe93cb41d30","name":"SELECT Keep Alive","func":"msg.topic = \"SELECT BLE_HEX, HW1, HW2, HW3, HW4, HW5, HW6, Info FROM BLE WHERE UniqueID = 29\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":160,"wires":[["61752b4d9f525766"]]},{"id":"6f499fb8d23beee5","type":"link out","z":"fb013fe93cb41d30","name":"BLE_Heartbeat->DB_connectivity","mode":"link","links":["3107c338.6444ac"],"x":1135,"y":260,"wires":[]},{"id":"761d2a57256a7fbb","type":"debug","z":"fb013fe93cb41d30","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1360,"y":380,"wires":[]},{"id":"62746159d85e65b5","type":"switch","z":"fb013fe93cb41d30","name":"BLE_DeviceConnected","property":"BLE_DeviceConnected","propertyType":"global","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":150,"y":160,"wires":[["a63b9d66484a559b"],[]]},{"id":"4672e707.47a5f8","type":"mysql","z":"a71d92ae.7639a","mydb":"4b0eb527.16d5ec","name":"","x":520,"y":220,"wires":[["f921478b.d22178"]]},{"id":"b92fed1a.7c89","type":"link in","z":"a71d92ae.7639a","name":"BlackBox_to_MySQL_insertCLUTCH","links":["844284c6.d8c958"],"x":75,"y":220,"wires":[["dea918b1.712018","668f3c9e.6affa4"]]},{"id":"dea918b1.712018","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":300,"wires":[]},{"id":"668f3c9e.6affa4","type":"function","z":"a71d92ae.7639a","name":"Insert CLUTCH","func":"var onoff1 = msg.Signal1.replace(\"1\", \"ON\").replace(\"0\", \"OFF\");\nvar onoff2 = msg.Signal2.replace(\"1\", \"ON\").replace(\"0\", \"OFF\");\nconst reg = /\\.\\d{3}Z/;\n\n\nmsg.timestamp = new Date(msg.Timestamp2).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = \"INSERT INTO clutch(Timestamp_at_end, Signal1, Signal2, Timespan) VALUES( '\"+msg.timestamp+\"', '\"+onoff1+\"', '\"+onoff2+\"', '\"+msg.Timespan+\"' );\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":220,"wires":[["4672e707.47a5f8","d37e318b.ea619"]]},{"id":"d37e318b.ea619","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":300,"wires":[]},{"id":"f921478b.d22178","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":220,"wires":[]},{"id":"31fa38e7.ec2ee8","type":"mysql","z":"a71d92ae.7639a","mydb":"395f2a47.6cfaf6","name":"","x":570,"y":1300,"wires":[["e28cd4de.a80628"]]},{"id":"b49543d5.2ef48","type":"comment","z":"a71d92ae.7639a","name":"INSERT","info":"","x":110,"y":100,"wires":[]},{"id":"7590ddb1.667e34","type":"comment","z":"a71d92ae.7639a","name":"SELECT","info":"","x":100,"y":1220,"wires":[]},{"id":"1dd1b78a.ae42f8","type":"function","z":"a71d92ae.7639a","name":"SELECT PW0","func":"//var onoff1 = msg.Signal1.replace(\"1\", \"OFF\").replace(\"0\", \"ON\");\n//var onoff2 = msg.Signal2.replace(\"1\", \"OFF\").replace(\"0\", \"ON\");\n//const reg = /\\.\\d{3}Z/;\n\n//msg.timestamp = new Date(msg.Timestamp2).toISOString().replace(\"T\", \" \").replace(reg, \"\");\n//msg.topic = \"INSERT INTO clutch(Timestamp_at_end, Signal1, Signal2, Timespan) VALUES( '\"+msg.timestamp+\"', '\"+onoff1+\"', '\"+onoff2+\"', '\"+msg.Timespan+\"' );\";\nmsg.topic = \"SELECT `0`, `1`, `2`, `3`, `4`, `5`, `6`, `7`, Flag, HC, LC, Param1, Param2, DC FROM sepp89117 WHERE UniqueID = 16\";\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":1300,"wires":[["31fa38e7.ec2ee8","b665934c.b6568"]]},{"id":"e619e57e.62e168","type":"inject","z":"a71d92ae.7639a","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":1320,"wires":[["1dd1b78a.ae42f8"]]},{"id":"b665934c.b6568","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":520,"y":1380,"wires":[]},{"id":"e28cd4de.a80628","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":1380,"wires":[]},{"id":"4d46fb18.4ae4f4","type":"mysql","z":"a71d92ae.7639a","mydb":"4b0eb527.16d5ec","name":"","x":520,"y":620,"wires":[["dae0a606.cbc898"]]},{"id":"3c199cc1.ecbb94","type":"link in","z":"a71d92ae.7639a","name":"BlackBox_to_MySQL_insert_BLE_reconnect","links":["33b67730.daa2a8","0e781052f3560396"],"x":75,"y":620,"wires":[["61d8ce28.057f","3e1723e1c9e5d02e"]]},{"id":"61d8ce28.057f","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":700,"wires":[]},{"id":"37f7d71.d29c428","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":700,"wires":[]},{"id":"dae0a606.cbc898","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":620,"wires":[]},{"id":"ee0d4e3c.6f4cb","type":"mysql","z":"a71d92ae.7639a","mydb":"4b0eb527.16d5ec","name":"","x":520,"y":420,"wires":[["baf27fa5.ec327"]]},{"id":"89ffb456.200978","type":"link in","z":"a71d92ae.7639a","name":"BlackBox_to_MySQL_insertBrake","links":["a1934b83.ac2d28"],"x":75,"y":420,"wires":[["6b66ba19.bd8094","99b59d6.fab236"]]},{"id":"6b66ba19.bd8094","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":500,"wires":[]},{"id":"99b59d6.fab236","type":"function","z":"a71d92ae.7639a","name":"Insert Brake","func":"var onoff1 = msg.Signal1.replace(\"1\", \"OFF\").replace(\"0\", \"ON\");\nvar onoff2 = msg.Signal2.replace(\"1\", \"OFF\").replace(\"0\", \"ON\");\nconst reg = /\\.\\d{3}Z/;\n\nmsg.timestamp = new Date(msg.Timestamp2).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = \"INSERT INTO brake(Timestamp_at_end, Signal1, Signal2, Timespan) VALUES( '\"+msg.timestamp+\"', '\"+onoff1+\"', '\"+onoff2+\"', '\"+msg.Timespan+\"' );\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":420,"wires":[["ee0d4e3c.6f4cb","61ba8007.2ceae"]]},{"id":"61ba8007.2ceae","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":500,"wires":[]},{"id":"baf27fa5.ec327","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":420,"wires":[]},{"id":"58d788840283593e","type":"mysql","z":"a71d92ae.7639a","mydb":"4b0eb527.16d5ec","name":"","x":520,"y":820,"wires":[["9225cdff36e6bd01"]]},{"id":"c9f216694f74788a","type":"link in","z":"a71d92ae.7639a","name":"BlackBox_to_MySQL_insert_GPS","links":["e1518f926f6f7eb2"],"x":75,"y":820,"wires":[["38c0b889ab64cd90","6c25cd23921b5784"]]},{"id":"38c0b889ab64cd90","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":900,"wires":[]},{"id":"6c25cd23921b5784","type":"function","z":"a71d92ae.7639a","name":"Insert GPS","func":"\n//const reg = /\\.\\d{3}Z/;\n\n//msg.timestamp = new Date(msg.payload).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = \"INSERT INTO GPS(Timestamp, Lat_DG, Long_DG) VALUES( '\"+msg.timestamp+\"', '\"+msg.Lat+\"', '\"+msg.Long+\"' );\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":820,"wires":[["58d788840283593e","738de03e7b3efb4a"]]},{"id":"738de03e7b3efb4a","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":900,"wires":[]},{"id":"9225cdff36e6bd01","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":820,"wires":[]},{"id":"3e1723e1c9e5d02e","type":"function","z":"a71d92ae.7639a","name":"Insert BLE_reconnect","func":"\nconst reg = /\\.\\d{3}Z/;\n\nmsg.timestamp = new Date(msg.payload).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = \"INSERT INTO ble_reconnect(Timestamp, Counter) VALUES( '\"+msg.timestamp+\"', '\"+msg.counter+\"' );\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":620,"wires":[["4d46fb18.4ae4f4","37f7d71.d29c428"]]},{"id":"6a6bf6f92d5ca03f","type":"mysql","z":"a71d92ae.7639a","mydb":"4b0eb527.16d5ec","name":"","x":520,"y":1000,"wires":[["a2c5863ea3b63a95"]]},{"id":"45257d0bc62128b9","type":"link in","z":"a71d92ae.7639a","name":"BlackBox_to_MySQL_insert_AHRS","links":["c2385e8766c88819"],"x":75,"y":1000,"wires":[["a2ea967cec42ec3a","328c161d388b5837"]]},{"id":"a2ea967cec42ec3a","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":190,"y":1080,"wires":[]},{"id":"328c161d388b5837","type":"function","z":"a71d92ae.7639a","name":"Insert AHRS","func":"\n//const reg = /\\.\\d{3}Z/;\n\n//msg.timestamp = new Date(msg.payload).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = \"INSERT INTO AHRS(Timestamp, roll, pitch, yaw, ax, ay, az, gx, gy, gz, mx, my, mz, temp) VALUES( '\"+msg.timestamp+\"', '\"+msg.roll+\"', '\"+msg.pitch+\"', '\"+msg.yaw+\"', '\"+msg.ax+\"', '\"+msg.ay+\"', '\"+msg.az+\"', '\"+msg.gx+\"', '\"+msg.gy+\"', '\"+msg.gz+\"', '\"+msg.mx+\"', '\"+msg.my+\"', '\"+msg.mz+\"', '\"+msg.temp+\"' );\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":1000,"wires":[["6a6bf6f92d5ca03f","bff6f1257ee57e4c"]]},{"id":"bff6f1257ee57e4c","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":450,"y":1080,"wires":[]},{"id":"a2c5863ea3b63a95","type":"debug","z":"a71d92ae.7639a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":1000,"wires":[]},{"id":"d810a272.2ce32","type":"link in","z":"d3786684.caf558","name":"UDP_GoProOnline->DB-Connectivity","links":["361974a2.a6fe8c","e674fa56.5827c8","252acee6f195baed","4448c0b18c09cd22"],"x":215,"y":480,"wires":[["852ba70.cfdc558","13ab4bfd.cb8724"]]},{"id":"852ba70.cfdc558","type":"ui_text","z":"d3786684.caf558","group":"fb75f346.d7f78","order":2,"width":0,"height":0,"name":"UDP connected","label":"UDP connected","format":"{{msg.payload}}","layout":"row-spread","x":900,"y":480,"wires":[]},{"id":"13ab4bfd.cb8724","type":"ui_led","z":"d3786684.caf558","order":2,"group":"ad805b2f.308398","width":"1","height":"1","label":"","labelPlacement":"left","labelAlignment":"right","colorForValue":[{"color":"#ff0000","value":"GoProOffline","valueType":"str"},{"color":"#008000","value":"GoProOnline","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_UDP connected","x":920,"y":540,"wires":[]},{"id":"8590d124.137bc","type":"ping","z":"d3786684.caf558","protocol":"Automatic","mode":null,"name":"HERO-RC-800001","host":"10.71.79.1","timer":"3","inputs":0,"x":290,"y":720,"wires":[["e0f86a4f.221668"]]},{"id":"a7a40755.cd14d8","type":"ui_led","z":"d3786684.caf558","order":3,"group":"ad805b2f.308398","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#ff0000","value":"down","valueType":"str"},{"color":"#008000","value":"online","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_OdroidAP","x":900,"y":740,"wires":[]},{"id":"e3e977a3.5288a8","type":"ui_text","z":"d3786684.caf558","group":"fb75f346.d7f78","order":3,"width":0,"height":0,"name":"","label":"Odroid AccessPoint (ping)","format":"{{msg.topic}}","layout":"row-spread","x":930,"y":680,"wires":[]},{"id":"e0f86a4f.221668","type":"function","z":"d3786684.caf558","name":"","func":"msg.topic = msg.payload +' ms';\n  if (msg.payload > 0) {\n    msg.payload = 'online';\n  } else {\n    msg.payload = 'down';\n    msg.topic = msg.payload;\n  }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":720,"wires":[["a7a40755.cd14d8","e3e977a3.5288a8"]]},{"id":"1315e90e.09bc97","type":"link in","z":"d3786684.caf558","name":"UDP_Heartbeat->DB_Connenctivity","links":["a861b82e.17c0b8"],"x":215,"y":200,"wires":[["bb4c6010.3831","5daf6247.21002c","49814b0c.ee06e4"]]},{"id":"ef3946ba.04ae18","type":"ui_led","z":"d3786684.caf558","order":1,"group":"ad805b2f.308398","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#ff0000","value":"down","valueType":"str"},{"color":"#fbf304","value":"on","valueType":"str"},{"color":"#9da49d","value":"0","valueType":"num"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_UDP Heartbeat","x":920,"y":340,"wires":[]},{"id":"4da0bc55.c49d24","type":"ui_text","z":"d3786684.caf558","group":"fb75f346.d7f78","order":1,"width":0,"height":0,"name":"UDP Heartbeat","label":"UDP Heartbeat","format":"{{msg.payload}}","layout":"row-spread","x":900,"y":200,"wires":[]},{"id":"5daf6247.21002c","type":"trigger","z":"d3786684.caf558","name":"Watchdog-Heartbeat","op1":"","op2":"down","op1type":"nul","op2type":"str","duration":"820","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":420,"y":340,"wires":[["ef3946ba.04ae18","4da0bc55.c49d24"]],"info":"setze \n\"dann\" \"warten auf\" auf 3 x var:delay des Heartbeats für beste Ergebnisse (nicht kürzer sonst beginnt er zu flappen!)\n\nDieses WakeUp Gopro bewirkt:\n1.) Overruled sozusagen die \"Automatische Kammeraabschaltung\" der GoPro - Settings und\n2.) dedektiert und behebt Abrisse in der UDP Kommunikation zwischen Node-red und GoProHero5Black"},{"id":"bb4c6010.3831","type":"function","z":"d3786684.caf558","name":"Led on","func":"\nmsg.payload = 'on'; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":200,"wires":[["ef3946ba.04ae18","4da0bc55.c49d24"]]},{"id":"73f5e24c.e1970c","type":"function","z":"d3786684.caf558","name":"Led off","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":260,"wires":[["ef3946ba.04ae18"]]},{"id":"49814b0c.ee06e4","type":"delay","z":"d3786684.caf558","name":"","pauseType":"delay","timeout":"1200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":420,"y":260,"wires":[["73f5e24c.e1970c"]]},{"id":"4d04c00.156254","type":"comment","z":"d3786684.caf558","name":"UDP (Smart Remote)","info":"","x":180,"y":120,"wires":[]},{"id":"f6e873b0.4694b","type":"comment","z":"d3786684.caf558","name":"HTTP (GoPro APP)","info":"","x":190,"y":840,"wires":[]},{"id":"1a5c1a7.1c9d9e6","type":"ui_led","z":"d3786684.caf558","order":3,"group":"22f841fd.fe797e","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#ff0000","value":"GoPro Down","valueType":"str"},{"color":"#008000","value":"GoPro Up","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoProAP","x":900,"y":1320,"wires":[]},{"id":"1e07a178.11b99f","type":"ui_text","z":"d3786684.caf558","group":"f5a966d8.d5c368","order":3,"width":0,"height":0,"name":"","label":"GoPro AccessPoint (tcp)","format":"{{msg.topic}}","layout":"row-spread","x":930,"y":1260,"wires":[]},{"id":"9491a9aa.74ba18","type":"ping","z":"d3786684.caf558","protocol":"IPv4","mode":"timed","name":"Odroid_HTTPClient","host":"${Odroid_IP_from_GoProAP_DHCP}","timer":"3","inputs":0,"x":290,"y":960,"wires":[["b929c0d5.c4c31","93c2fe7.c41d4"]]},{"id":"90e461ec.8db21","type":"ui_led","z":"d3786684.caf558","order":2,"group":"22f841fd.fe797e","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#ff0000","value":"down","valueType":"str"},{"color":"#008000","value":"online","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_Odroid HTTPClient","x":930,"y":980,"wires":[]},{"id":"43733e8e.ca766","type":"ui_text","z":"d3786684.caf558","group":"f5a966d8.d5c368","order":2,"width":0,"height":0,"name":"","label":"HTTP connected","format":"{{msg.topic}}","layout":"row-spread","x":910,"y":920,"wires":[]},{"id":"b929c0d5.c4c31","type":"function","z":"d3786684.caf558","name":"","func":"msg.topic = 'OdroidOnline';\n  if (msg.payload > 0) {\n    msg.payload = 'online';\n  } else {\n    msg.payload = 'down';\n    msg.topic = msg.payload;\n  }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":960,"wires":[["90e461ec.8db21","43733e8e.ca766"]]},{"id":"93c2fe7.c41d4","type":"debug","z":"d3786684.caf558","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":450,"y":1060,"wires":[]},{"id":"9fdf854a.bb7c98","type":"comment","z":"d3786684.caf558","name":"BLE (GoPro App)","info":"","x":180,"y":1480,"wires":[]},{"id":"ecb82265.b3833","type":"ui_text","z":"d3786684.caf558","d":true,"group":"7193ba64.490654","order":2,"width":0,"height":0,"name":"","label":"BLE connected","format":"{{msg.topic}}","layout":"row-spread","className":"","x":920,"y":2960,"wires":[]},{"id":"ef25c9cc.31f3b8","type":"function","z":"d3786684.caf558","d":true,"name":"","func":"\n  if (msg.status.text == \"generic-ble.status.disconnected\") {\n    msg.topic = 'GoPro disconnected';\n  } else \n  if (msg.status.text == \"generic-ble.status.connected\") {\n    msg.topic = 'GoPro connected';\n  } else \n  if (msg.status.text == 'generic-ble.status.connecting') {\n    msg.topic = 'GoPro connecting';\n  } else \n  if (msg.status.text == 'generic-ble.status.disconnecting') {\n    msg.topic = 'GoPro disconnecting';\n  } else \n  if (msg.status.text == 'generic-ble.status.missing') {\n    msg.topic = 'GoPro missing';\n  }\nmsg.payload = msg.topic\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":2960,"wires":[["9ee56321.dc991","ecb82265.b3833","66234f5b.e763c"]]},{"id":"9ee56321.dc991","type":"debug","z":"d3786684.caf558","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":770,"y":3040,"wires":[]},{"id":"ccc52554.62e3e8","type":"link in","z":"d3786684.caf558","name":"DB_Connectivity->WakeUp BLE_Status","links":["c748025e.3b26e","39b7041a02395c28"],"x":225,"y":2960,"wires":[["ef25c9cc.31f3b8"]]},{"id":"66234f5b.e763c","type":"ui_led","z":"d3786684.caf558","d":true,"order":2,"group":"3e4e30cc.ab175","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#ff0000","value":"GoPro missing","valueType":"str"},{"color":"#008000","value":"GoPro connected","valueType":"str"},{"color":"#000000","value":"GoPro disconnected","valueType":"str"},{"color":"#878787","value":"GoPro disconnecting","valueType":"str"},{"color":"#baf2ba","value":"GoPro connecting","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoPro BLE_connected","x":940,"y":2900,"wires":[]},{"id":"89e8a11c.5fd0c","type":"function","z":"d3786684.caf558","name":"","func":"\n  if (msg.status.text == \"common.status.disconnected\") {\n    msg.topic = 'GoPro Down';\n  } else \n  if (msg.status.text == \"common.status.connected\") {\n    msg.topic = 'GoPro Up';\n  } \n  \nmsg.payload = msg.topic\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":1300,"wires":[["1e07a178.11b99f","1a5c1a7.1c9d9e6","f3add184.9a58f","f9d44bec.94e2a8"]]},{"id":"f3add184.9a58f","type":"link out","z":"d3786684.caf558","name":"DB_Connectivity->WakeUp GoPro BLEsetWifion","links":[],"x":835,"y":1380,"wires":[]},{"id":"f9d44bec.94e2a8","type":"debug","z":"d3786684.caf558","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":740,"y":1440,"wires":[]},{"id":"a4bef44c.c585c8","type":"link in","z":"d3786684.caf558","name":"DB_Connectivity->WakeUp GoPro HTTP tcp Status","links":["10c80e5b.c623e2","266895e7.36ba8a","8a81287b.a72b78","2ee67e6b8c1e83cd"],"x":235,"y":1300,"wires":[["89e8a11c.5fd0c"]]},{"id":"c5038ab0.53a088","type":"ui_text","z":"d3786684.caf558","group":"7193ba64.490654","order":3,"width":0,"height":0,"name":"","label":"BLE active","format":"{{msg.topic}}","layout":"row-spread","className":"","x":850,"y":1600,"wires":[]},{"id":"3107c338.6444ac","type":"link in","z":"d3786684.caf558","name":"DB_Connectivity->BLE_Heartbeat","links":["6f499fb8d23beee5"],"x":155,"y":1600,"wires":[["e9cca6365c0e95af","d665d1683566905f","302dcd5221cb15ca"]]},{"id":"d8ba7acd.7321c8","type":"ui_led","z":"d3786684.caf558","order":3,"group":"3e4e30cc.ab175","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#9da49d","value":"off","valueType":"str"},{"color":"#fbf304","value":"on","valueType":"str"},{"color":"#ff0000","value":"down","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoPro BLE_active","x":890,"y":1680,"wires":[]},{"id":"e69dc1f7a5302b8a","type":"inject","z":"d3786684.caf558","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":1140,"wires":[["a1f421a45d41f2d7"]]},{"id":"a1f421a45d41f2d7","type":"function","z":"d3786684.caf558","name":"","func":"msg.payload = env.get ('Odroid_IP_from_GoProAP_DHCP')\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1160,"wires":[["ec5f990eab54dffb"]]},{"id":"ec5f990eab54dffb","type":"debug","z":"d3786684.caf558","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":720,"y":1160,"wires":[]},{"id":"15783b7eb05c86cc","type":"ui_text","z":"d3786684.caf558","group":"7193ba64.490654","order":4,"width":0,"height":0,"name":"","label":"BLE paired (since)","format":"{{msg.topic}}","layout":"row-spread","className":"","x":930,"y":2220,"wires":[]},{"id":"37bb43f946d904df","type":"debug","z":"d3786684.caf558","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2260,"wires":[]},{"id":"d501669af4e3bcc3","type":"link in","z":"d3786684.caf558","name":"DB_Connectivity->Global_Variable_Backup","links":["c048503838c1bb5a"],"x":155,"y":2240,"wires":[["99de8617eafcb6ae"]]},{"id":"19cdafc8af33e6fb","type":"ui_led","z":"d3786684.caf558","order":4,"group":"3e4e30cc.ab175","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#008000","value":"yes","valueType":"str"},{"color":"#ff0000","value":"no","valueType":"str"},{"color":"#808080","value":"null","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoPro BLE_paired","x":950,"y":2160,"wires":[]},{"id":"99de8617eafcb6ae","type":"function","z":"d3786684.caf558","name":"","func":"\nmsg.topic = global.get(\"BLE_PairingSuccessTimestamp\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":2240,"wires":[["15783b7eb05c86cc","37bb43f946d904df","19cdafc8af33e6fb"]]},{"id":"86663cc8173dba6f","type":"inject","z":"d3786684.caf558","name":"Inject BLE_DevicePaired","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_DevicePaired","payloadType":"global","x":250,"y":2160,"wires":[["99de8617eafcb6ae"]]},{"id":"f5bef7655846554f","type":"ui_text","z":"d3786684.caf558","group":"7193ba64.490654","order":6,"width":0,"height":0,"name":"","label":"BLE connected (since)","format":"{{msg.topic}}","layout":"row-spread","className":"","x":920,"y":2600,"wires":[]},{"id":"b36d89e5ebe689ab","type":"ui_led","z":"d3786684.caf558","order":6,"group":"3e4e30cc.ab175","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#008000","value":"successful","valueType":"str"},{"color":"#ff0000","value":"no","valueType":"str"},{"color":"#008000","value":"yes","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoPro BLE_connected","x":940,"y":2540,"wires":[]},{"id":"ab9433e781952b4c","type":"debug","z":"d3786684.caf558","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":2660,"wires":[]},{"id":"3601d5f6e90fd0eb","type":"function","z":"d3786684.caf558","name":"","func":"\nmsg.topic = global.get(\"BLE_DeviceConnectedTimestamp\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":2580,"wires":[["ab9433e781952b4c","b36d89e5ebe689ab","f5bef7655846554f"]]},{"id":"e6652fc1904a77b0","type":"inject","z":"d3786684.caf558","name":"Inject BLE_ConnectSuccess","props":[{"p":"payload"},{"p":"topic","v":"BLE_ConnectSuccessTimestamp","vt":"global"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_ConnectSuccess","payloadType":"global","x":270,"y":2560,"wires":[["3601d5f6e90fd0eb"]]},{"id":"eb858f2d01625607","type":"inject","z":"d3786684.caf558","name":"Inject BLE_DeviceConnected","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_DeviceConnected","payloadType":"global","x":270,"y":2600,"wires":[["3601d5f6e90fd0eb"]]},{"id":"724b8465a0d86e19","type":"ui_text","z":"d3786684.caf558","group":"7193ba64.490654","order":5,"width":0,"height":0,"name":"","label":"BLE trusted (since)","format":"{{msg.topic}}","layout":"row-spread","className":"","x":910,"y":2420,"wires":[]},{"id":"e0388d6ee482917e","type":"ui_led","z":"d3786684.caf558","order":5,"group":"3e4e30cc.ab175","width":0,"height":0,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"#008000","value":"succeeded","valueType":"str"},{"color":"#ff0000","value":"no","valueType":"str"},{"color":"#008000","value":"yes","valueType":"str"}],"allowColorForValueInMessage":false,"shape":"circle","showGlow":false,"name":"LED_GoPro BLE_trusted","x":930,"y":2360,"wires":[]},{"id":"d6f74ac8c717a8b2","type":"debug","z":"d3786684.caf558","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":2480,"wires":[]},{"id":"ac7a9f8e255e5244","type":"function","z":"d3786684.caf558","name":"","func":"\nmsg.topic = global.get(\"BLE_DeviceTrustedTimestamp\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":2420,"wires":[["d6f74ac8c717a8b2","e0388d6ee482917e","724b8465a0d86e19"]]},{"id":"c7b3a4c7b9feb0ea","type":"inject","z":"d3786684.caf558","name":"Inject BLE_BLE_TrustSuccess","props":[{"p":"payload"},{"p":"topic","v":"BLE_TrustSuccessTimestamp","vt":"global"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_TrustSuccess","payloadType":"global","x":270,"y":2380,"wires":[["ac7a9f8e255e5244"]]},{"id":"68df2325b7691ee0","type":"inject","z":"d3786684.caf558","name":"Inject BLE_DeviceTrusted","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_DeviceTrusted","payloadType":"global","x":260,"y":2420,"wires":[["ac7a9f8e255e5244"]]},{"id":"4632e9bd0154d804","type":"ui_button","z":"d3786684.caf558","name":"","group":"7193ba64.490654","order":8,"width":0,"height":0,"passthru":false,"label":"BLE Connect","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":190,"y":2760,"wires":[["7db3d15fd4afefb7"]]},{"id":"7db3d15fd4afefb7","type":"change","z":"d3786684.caf558","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":2760,"wires":[["c51b3d19f0477af1"]]},{"id":"c51b3d19f0477af1","type":"link out","z":"d3786684.caf558","name":"DB_Connectivity--> BLE_Connection_Bluetoothctl connect","mode":"link","links":["4ea62f1dea08b4bb","32c1500175f73a95"],"x":595,"y":2760,"wires":[]},{"id":"8e9620345cfbb7b1","type":"ui_button","z":"d3786684.caf558","name":"","group":"7193ba64.490654","order":9,"width":0,"height":0,"passthru":false,"label":"BLE Disconnect","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":200,"y":2820,"wires":[["e002644db88049f0"]]},{"id":"e002644db88049f0","type":"change","z":"d3786684.caf558","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":2820,"wires":[["9eb116a6b8b13106"]]},{"id":"9eb116a6b8b13106","type":"link out","z":"d3786684.caf558","name":"DB_Connectivity--> BLE_Connection_Bluetoothctl disconnect","mode":"link","links":["6e1aa8e336f7d0ea"],"x":595,"y":2820,"wires":[]},{"id":"fd5cfd3e12f465e0","type":"ui_button","z":"d3786684.caf558","name":"","group":"7193ba64.490654","order":7,"width":0,"height":0,"passthru":false,"label":"BLE Pair","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":180,"y":2700,"wires":[["d39c37b237427604"]]},{"id":"d39c37b237427604","type":"change","z":"d3786684.caf558","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":2700,"wires":[["1b70b9832d39b0e8"]]},{"id":"1b70b9832d39b0e8","type":"link out","z":"d3786684.caf558","name":"DB_Connectivity--> BLE_Connection_PairingProcess","mode":"link","links":["4ea62f1dea08b4bb","1ccab08185f3ad95","32c1500175f73a95"],"x":595,"y":2700,"wires":[]},{"id":"adfcbe81c482c35e","type":"ui_button","z":"d3786684.caf558","name":"","group":"7193ba64.490654","order":9,"width":0,"height":0,"passthru":false,"label":"BLE Wifi ON","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":190,"y":2880,"wires":[["e9d643b0afa6ce8e"]]},{"id":"e9d643b0afa6ce8e","type":"link out","z":"d3786684.caf558","name":"DB_Connectivity--> BLE_from_MySQL_WifiON","mode":"link","links":["4fc071f8f4099767"],"x":595,"y":2880,"wires":[]},{"id":"302dcd5221cb15ca","type":"trigger","z":"d3786684.caf558","name":"Watchdog-Heartbeat","op1":"","op2":"down","op1type":"nul","op2type":"str","duration":"2500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":380,"y":1740,"wires":[["d8ba7acd.7321c8","c5038ab0.53a088"]],"info":"setze \n\"dann\" \"warten auf\" auf 3 x var:delay des Heartbeats für beste Ergebnisse (nicht kürzer sonst beginnt er zu flappen!)\n\nDieses WakeUp Gopro bewirkt:\n1.) Overruled sozusagen die \"Automatische Kammeraabschaltung\" der GoPro - Settings und\n2.) dedektiert und behebt Abrisse in der UDP Kommunikation zwischen Node-red und GoProHero5Black"},{"id":"e9cca6365c0e95af","type":"function","z":"d3786684.caf558","name":"Led on","func":"\nmsg.payload = 'on'; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":1600,"wires":[["d8ba7acd.7321c8","c5038ab0.53a088"]]},{"id":"a2284f43c2db65b3","type":"function","z":"d3786684.caf558","name":"Led off","func":"msg.payload = 'off';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":1660,"wires":[["d8ba7acd.7321c8"]]},{"id":"d665d1683566905f","type":"delay","z":"d3786684.caf558","name":"","pauseType":"delay","timeout":"1000","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":380,"y":1660,"wires":[["a2284f43c2db65b3"]]},{"id":"59f04859.656478","type":"ui_text_input","z":"c31f75c1.823298","name":"Gerätenummer","label":"Gerätenummer","tooltip":"","group":"43eeb9362523944e","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"topic","topicType":"msg","x":300,"y":240,"wires":[["3e051b12.52fb24"]]},{"id":"3e051b12.52fb24","type":"function","z":"c31f75c1.823298","name":"DeviceName declaration","func":"global.set('DeviceName',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":240,"wires":[["95c9a2cb.8a9dd"]]},{"id":"95c9a2cb.8a9dd","type":"debug","z":"c31f75c1.823298","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1030,"y":240,"wires":[]},{"id":"1206971e.cd3a59","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DeviceName","links":["639a9d50.086244"],"x":95,"y":240,"wires":[["59f04859.656478"]]},{"id":"10dc739e7dce48d7","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DecDegMsg.Lat","links":["a7481f7.b0107e"],"x":115,"y":2240,"wires":[["311d06c405121f08"]]},{"id":"af8ed51a4a96b906","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DecDegMsg.Long","links":["6566100b.6370a"],"x":115,"y":2440,"wires":[["825371a71b604b92"]]},{"id":"5cc7f53f1d2a6f8b","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"Dezimalgrad_Lat","payloadType":"global","x":220,"y":2180,"wires":[["311d06c405121f08"]]},{"id":"5e97aa665631a21d","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"Dezimalgrad_Long","payloadType":"global","x":220,"y":2320,"wires":[["825371a71b604b92"]]},{"id":"6e06d07d5894ecce","type":"comment","z":"c31f75c1.823298","name":"GoPro - Connectivity","info":"","x":110,"y":160,"wires":[]},{"id":"b8d0df27086c3260","type":"comment","z":"c31f75c1.823298","name":"GPS","info":"","x":70,"y":620,"wires":[]},{"id":"311d06c405121f08","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":17,"width":"6","height":"1","name":"","label":"Latitude","format":"{{msg.payload}}°","layout":"row-spread","x":460,"y":2240,"wires":[]},{"id":"825371a71b604b92","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":19,"width":"6","height":"1","name":"","label":"Longitude","format":"{{msg.payload}}°","layout":"row-spread","x":460,"y":2440,"wires":[]},{"id":"aed41b2adcaf89e4","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":15,"width":0,"height":0,"name":"","label":"DezimalGrad","format":"{{msg.payload}}","layout":"row-spread","x":150,"y":2100,"wires":[]},{"id":"b47db269d09e4d0a","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Lat_Degree","links":["20bdd39245962387"],"x":115,"y":1200,"wires":[["eded59ba186e7c71"]]},{"id":"34a24617bd4916d2","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Lat_Minutes","links":["df5aefe955974d25"],"x":115,"y":1340,"wires":[["4a43817fdf8793a1"]]},{"id":"0fadb966144f4adf","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Lat_Degree","payloadType":"global","x":220,"y":1140,"wires":[["eded59ba186e7c71"]]},{"id":"12dc5773b7bdca16","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Lat_Minutes","payloadType":"global","x":220,"y":1280,"wires":[["4a43817fdf8793a1"]]},{"id":"eded59ba186e7c71","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":8,"width":"3","height":"1","name":"DegMinSec_Lat_Degree","label":"Latitude","format":"{{msg.payload}}°","layout":"row-spread","x":510,"y":1200,"wires":[]},{"id":"4a43817fdf8793a1","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":9,"width":"1","height":"1","name":"DegMinSec_Lat_Minutes","label":"","format":"{{msg.payload}}'","layout":"row-center","x":510,"y":1340,"wires":[]},{"id":"51915c872d738ef4","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":6,"width":0,"height":0,"name":"","label":"Grad Minuten Sekunden","format":"{{msg.payload}}","layout":"row-spread","x":190,"y":1060,"wires":[]},{"id":"bf1231f10af93d6b","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Lat_Seconds","links":["2a5b957da19aa5b3"],"x":115,"y":1480,"wires":[["405f513cafbdadb6"]]},{"id":"9b82ff8887be2571","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Lat_Seconds","payloadType":"global","x":220,"y":1420,"wires":[["405f513cafbdadb6"]]},{"id":"405f513cafbdadb6","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":10,"width":"2","height":"1","name":"DegMinSec_Lat_Seconds","label":"","format":"{{msg.payload}}''","layout":"row-left","x":510,"y":1480,"wires":[]},{"id":"8c8db49ba4f5522c","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Long_Degree","links":["b0beab3cd4dfa0dc"],"x":115,"y":1620,"wires":[["dec216ea949f7fad"]]},{"id":"92cfe3d62548e833","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Long_Degree","payloadType":"global","x":220,"y":1560,"wires":[["dec216ea949f7fad"]]},{"id":"dec216ea949f7fad","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":12,"width":"3","height":"1","name":"DegMinSec_Long_Degree","label":"Longitude","format":"{{msg.payload}}°","layout":"row-spread","x":520,"y":1620,"wires":[]},{"id":"be3b73a07dd8f388","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Long_Minutes","links":["e84cb9a144849b24"],"x":115,"y":1780,"wires":[["8e63754c7ae29526"]]},{"id":"303b8d55e5ac54df","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Long_Minutes","payloadType":"global","x":220,"y":1720,"wires":[["8e63754c7ae29526"]]},{"id":"8e63754c7ae29526","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":13,"width":"1","height":"1","name":"DegMinSec_Long_Minutes","label":"","format":"{{msg.payload}}'","layout":"row-center","x":520,"y":1780,"wires":[]},{"id":"e943c065fbcee004","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_DegMinSec_Long_Seconds","links":["a27059a91b257dc1"],"x":115,"y":1920,"wires":[["c9158c2c2ee00326"]]},{"id":"571b4b9f9d299913","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"DegMinSec_Long_Seconds","payloadType":"global","x":220,"y":1860,"wires":[["c9158c2c2ee00326"]]},{"id":"c9158c2c2ee00326","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":14,"width":"2","height":"1","name":"DegMinSec_Long_Seconds","label":"","format":"{{msg.payload}}''","layout":"row-left","x":520,"y":1920,"wires":[]},{"id":"2121fb6158213ea9","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_NMEA_Lat","links":["a65cb628105a1f6f"],"x":95,"y":820,"wires":[["c740f8e45a1d79f9"]]},{"id":"b6292ab0f85ca8b1","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Global_Variable_Backup_NMEA_Long","links":["e1eb6b5ebeaed27c"],"x":95,"y":960,"wires":[["b76736cbabd96789"]]},{"id":"d9ce8b48d6827e42","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"NMEA_Lat","payloadType":"global","x":200,"y":760,"wires":[["c740f8e45a1d79f9"]]},{"id":"6b70c09159ec884e","type":"inject","z":"c31f75c1.823298","name":"Update from global variable","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"NMEA_Long","payloadType":"global","x":200,"y":900,"wires":[["b76736cbabd96789"]]},{"id":"c740f8e45a1d79f9","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":3,"width":"6","height":"1","name":"","label":"Latitude","format":"{{msg.payload}}","layout":"row-spread","x":440,"y":820,"wires":[]},{"id":"b76736cbabd96789","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":5,"width":"6","height":"1","name":"","label":"Longitude","format":"{{msg.payload}}","layout":"row-spread","x":440,"y":960,"wires":[]},{"id":"bde6a9e732f0cdb3","type":"ui_text","z":"c31f75c1.823298","group":"2f80fea05ac68d06","order":1,"width":0,"height":0,"name":"","label":"NMEA (raw Data)","format":"{{msg.payload}}","layout":"row-spread","x":150,"y":680,"wires":[]},{"id":"6938ecbcda94e945","type":"comment","z":"c31f75c1.823298","name":"Odroid - Connectivitiy","info":"","x":120,"y":440,"wires":[]},{"id":"4b04b894b2660fc9","type":"ui_text_input","z":"c31f75c1.823298","name":"Odroid-IP_from_GoProAP-DHCP","label":"Odroid-IP(wlan1) by GoProAP-DHCP (HTTP)","tooltip":"GoProAP - IP: 10.5.5.9 ","group":"43eeb9362523944e","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"topic","sendOnBlur":true,"className":"","topicType":"msg","x":360,"y":280,"wires":[["5c6ec18f7b92273e"]]},{"id":"5c6ec18f7b92273e","type":"function","z":"c31f75c1.823298","name":"Odroid_IP_from_GoProAP_DHCP declaration","func":"global.set('Odroid_IP_from_GoProAP_DHCP',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":280,"wires":[["cf3b6849f2ab50d5"]]},{"id":"cf3b6849f2ab50d5","type":"debug","z":"c31f75c1.823298","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1030,"y":280,"wires":[]},{"id":"28bf2222176037e4","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->Odroid-IP_from_GoProAP-DHCP","links":["dd8532c3.a1061"],"x":95,"y":280,"wires":[["4b04b894b2660fc9"]]},{"id":"c8d44db9d4c3a90f","type":"ui_text_input","z":"c31f75c1.823298","name":"GoPro-IP_from_Odroid-DHCP","label":"GoPro-IP from Odroid-DHCP (wlan0) (UDP)","tooltip":"Odroid-DHCP-IP: 10.71.79.1 ","group":"c63c3171.75836","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"topic","sendOnBlur":true,"className":"","topicType":"msg","x":350,"y":520,"wires":[["3fe13c72b4028f78"]]},{"id":"3fe13c72b4028f78","type":"function","z":"c31f75c1.823298","name":"Gopro_IP_from_Odroid_DHCP declaration","func":"global.set('GoPro_IP_from_Odroid_DHCP',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":520,"wires":[["d33080901106f9b7"]]},{"id":"d33080901106f9b7","type":"debug","z":"c31f75c1.823298","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1030,"y":520,"wires":[]},{"id":"8f9e4080f30fe240","type":"link in","z":"c31f75c1.823298","name":"DB_Settings_Parameter->GoPro-IP_from_Odroid-DHCP","links":["2dd73717.36ac78"],"x":95,"y":520,"wires":[["c8d44db9d4c3a90f"]]},{"id":"0f7dc6b38c053be7","type":"ui_text","z":"c31f75c1.823298","group":"43eeb9362523944e","order":3,"width":0,"height":0,"name":"BLE_DeviceName","label":"BLE_DeviceName","format":"{{msg.payload}}","layout":"row-spread","className":"","x":310,"y":320,"wires":[]},{"id":"0773b01366e539c3","type":"link in","z":"c31f75c1.823298","name":"Global_Variable_Backup --> DB_Parameter_BLE_DeviceName","links":["95c19abc.16a1f8"],"x":95,"y":320,"wires":[["0f7dc6b38c053be7"]]},{"id":"efef0a99014d28ce","type":"ui_text","z":"c31f75c1.823298","group":"43eeb9362523944e","order":4,"width":0,"height":0,"name":"BLE_DeviceMAC","label":"BLE_DeviceMAC","format":"{{msg.payload}}","layout":"row-spread","className":"","x":310,"y":360,"wires":[]},{"id":"9de3b3cce5b4aa0f","type":"link in","z":"c31f75c1.823298","name":"Global_Variable_Backup --> DB_Parameter_BLE_DeviceMAC","links":["01118aa8440c158d"],"x":95,"y":360,"wires":[["efef0a99014d28ce"]]},{"id":"b54ddabf.fec0f8","type":"ui_numeric","z":"9004c20f.8cb68","name":"OnClutchLimit","label":"OnClutchLimit (sec)","tooltip":"max. On Clutch Time (sec) before Tag","group":"a3598685.c656f8","order":1,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"OnClutchLimit","topicType":"str","format":"{{value}}","min":0,"max":"20","step":"0.1","className":"","x":300,"y":240,"wires":[["9888120e.2d7ec"]]},{"id":"9888120e.2d7ec","type":"function","z":"9004c20f.8cb68","name":"OnClutchLimit declaration","func":"global.set('OnClutchLimit',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":240,"wires":[["26323a1e.29f506"]]},{"id":"26323a1e.29f506","type":"debug","z":"9004c20f.8cb68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":790,"y":240,"wires":[]},{"id":"90235181.1bd48","type":"link in","z":"9004c20f.8cb68","name":"DB_TagSettings .- OnClutchLimit","links":["fa6f14b5.9e8898"],"x":55,"y":240,"wires":[["b54ddabf.fec0f8"]]},{"id":"6663fd6c.8d5544","type":"ui_numeric","z":"9004c20f.8cb68","name":"OnBrakeLimit","label":"OnBrakeLimit (sec)","tooltip":"max. On Brake Time (sec) before Tag","group":"a3598685.c656f8","order":1,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"OnBrakeLimit","topicType":"str","format":"{{value}}","min":0,"max":"20","step":"0.1","x":300,"y":300,"wires":[["e7d5bd52.ee961"]]},{"id":"e7d5bd52.ee961","type":"function","z":"9004c20f.8cb68","name":"OnBrakeLimit declaration","func":"global.set('OnBrakeLimit',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":300,"wires":[["e4dd68ca.f1f2b8"]]},{"id":"e4dd68ca.f1f2b8","type":"debug","z":"9004c20f.8cb68","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":790,"y":300,"wires":[]},{"id":"cabbed93.9bb77","type":"link in","z":"9004c20f.8cb68","name":"DB_TagSettings - OnBrakeLimit","links":["441c4e8e.0d9c9"],"x":55,"y":300,"wires":[["6663fd6c.8d5544"]]},{"id":"43f75a01.74e884","type":"inject","z":"b99a57ec.925fb8","name":"Periodically Backup","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":"","topic":"","payloadType":"date","x":260,"y":140,"wires":[["d547483e.775438"]]},{"id":"d547483e.775438","type":"function","z":"b99a57ec.925fb8","name":"Prep data","func":"// global variables separated by semicolon to be saved\nvar globallist = \"DeviceName;OnClutchLimit;OnBrakeLimit;DecDegMsg.Lat;DecDegMsg.Long;DegMinSec_Lat_Degree;DegMinSec_Lat_Minutes;DegMinSec_Lat_Seconds;DegMinSec_Long_Degree;DegMinSec_Long_Minutes;DegMinSec_Long_Seconds;NMEA_Lat;NMEA_Long;Odroid_IP_from_GoProAP_DHCP;GoPro_IP_from_Odroid_DHCP;BLE_DeviceName;BLE_DeviceMAC;BLE_PairingSuccess;BLE_PairingSuccessTimestamp;BLE_DevicePaired;BLE_ConnectSuccess;BLE_ConnectSuccessTimestamp;BLE_DeviceConnectedTimestamp;BLE_TrustSuccess;BLE_TrustSuccessTimestamp;BLE_DeviceTrusted;BLE_DeviceTrustedTimestamp;BLE_DisconnectSuccess;BLE_DisconnectSuccessTimestamp;GoProHttpConnected\";\nvar mylist = globallist.split(\";\");\n\nvar outputs = [];\n\nfor (i=0; i<mylist.length; i++) {\n    outputs.push({ key : mylist[i], type: typeof global.get(mylist[i]), value: global.get(mylist[i])});\n}\n      \n      \nmsg.payload = outputs;\nreturn msg;\n\n//msg.payload=typeof global.get(\"torrent_keywords\");\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":140,"wires":[["4cb14d0.afc25b4","41dcb6bada046cf9"]]},{"id":"9cec5c0d.e6de","type":"comment","z":"b99a57ec.925fb8","name":"Save global variables","info":"","x":260,"y":40,"wires":[]},{"id":"666ca426.5be96c","type":"comment","z":"b99a57ec.925fb8","name":"Restore global variables","info":"","x":260,"y":200,"wires":[]},{"id":"4cb14d0.afc25b4","type":"file","z":"b99a57ec.925fb8","name":"","filename":"/home/odroid/nodered-globalvariables.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":870,"y":140,"wires":[[]]},{"id":"d8fa7064.9f60a","type":"file in","z":"b99a57ec.925fb8","name":"","filename":"/home/odroid/nodered-globalvariables.json","format":"utf8","allProps":false,"x":550,"y":240,"wires":[["3cdb4133.0d461e"]]},{"id":"14b4208c.99aaaf","type":"function","z":"b99a57ec.925fb8","name":"Restore","func":"var output = [];\n\nfor (var i=0; i<msg.payload.length; i++) {\n    switch (msg.payload[i].type) {\n        case 'undefined': \n            // the global variable probably had no value, nothing needs to be restored\n            output.push(msg.payload[i].key + \" is undefined.\");\n            break;\n        case 'number':\n            if (msg.payload[i].value===\"NaN\") {\n                // there is no valid value to be restored, skip this variable\n                output.push(msg.payload[i].key + \" is NaN.\");\n            } else {\n                if (msg.payload[i].value.toString().indexOf(\".\")>-1) {\n                    // the value appears to be a float\n                    global.set(msg.payload[i].key,parseFloat(msg.payload[i].value));\n                    output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n                } else {\n                    global.set(msg.payload[i].key,parseInt(msg.payload[i].value));\n                    output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n                }\n            }\n            break;\n        case 'string':\n            global.set(msg.payload[i].key,msg.payload[i].value);\n            output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n            break;\n        case 'boolean':\n            global.set(msg.payload[i].key,msg.payload[i].value===\"true\");\n            output.push(msg.payload[i].key + \" is restored to \" + msg.payload[i].value);\n            break;\n    }\n}\n\nmsg.payload = output;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":320,"wires":[["13dbc787.3648b8","700f64c7.16704c","3c1c5d80.84cb92","4b5389e8.7ec3f8","eabd9285.07a73","d0d41491.fa7428","b7839544.79e088","ddef5cc2.2a6c4","1f6be674ca1e7107","95593ff10b547bcc","63666ab5b775ed31","07c87704937636e1","4af02c23b6ab2b6f","719aa9fcb3337fe5","5f6c9578d0371687","edfc1da4ea5c7aa2","e5731aeb3b24ef9c","a79cd937e134867e","16863535bee7695c","8fe73a573e12ad4d","02aa0e05fe16222a","41e92b9685b73bb1","db975ce2fe718abc","b37884f413252909","5436f5e79363f788","ce62d9d0a99d3ce5","ec3818282d194096","a090926901651c2a","cc5b9eaccbcaaaf8","3c11580134f5af93"]]},{"id":"3cdb4133.0d461e","type":"json","z":"b99a57ec.925fb8","name":"","property":"payload","action":"","pretty":false,"x":790,"y":240,"wires":[["14b4208c.99aaaf"]]},{"id":"13dbc787.3648b8","type":"function","z":"b99a57ec.925fb8","name":"OnClutchLimit restore","func":"msg.topic = \"OnClutchLimit\";\nmsg.payload = global.get(\"OnClutchLimit\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":380,"wires":[["fa6f14b5.9e8898"]]},{"id":"700f64c7.16704c","type":"function","z":"b99a57ec.925fb8","name":"OnBrakeLimit restore","func":"\nmsg.topic = \"OnBrakeLimit\";\nmsg.payload = global.get(\"OnBrakeLimit\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":440,"wires":[["441c4e8e.0d9c9"]]},{"id":"fa6f14b5.9e8898","type":"link out","z":"b99a57ec.925fb8","name":"Global_variable_Backup_OnCltchLimit->DB_TagSettings - OnClutchLimit","mode":"link","links":["90235181.1bd48"],"x":795,"y":380,"wires":[]},{"id":"441c4e8e.0d9c9","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_OnBrakeLimit->DB_TagSettings - OnBrakeLimit","mode":"link","links":["cabbed93.9bb77"],"x":795,"y":440,"wires":[]},{"id":"3c1c5d80.84cb92","type":"function","z":"b99a57ec.925fb8","name":"Dezimalgrad_Lat restore","func":"msg.topic = \"Dezimalgrad_Lat\";\nmsg.payload = global.get(\"Dezimalgrad_Lat\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":500,"wires":[["a7481f7.b0107e"]]},{"id":"a7481f7.b0107e","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_Dezimalgrad_Lat","mode":"link","links":["10dc739e7dce48d7"],"x":795,"y":500,"wires":[]},{"id":"4b5389e8.7ec3f8","type":"function","z":"b99a57ec.925fb8","name":"Dezimalgrad_Long restore","func":"msg.topic = \"Dezimalgrad_Long\";\nmsg.payload = global.get(\"Dezimalgrad_Long\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":560,"wires":[["6566100b.6370a"]]},{"id":"6566100b.6370a","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_Dezimalgrad_Long","mode":"link","links":["af8ed51a4a96b906"],"x":795,"y":560,"wires":[]},{"id":"eabd9285.07a73","type":"function","z":"b99a57ec.925fb8","name":"Odroid_IP_from_GoProAP_DHCP","func":"msg.topic = \"Odroid_IP_from_GoProAP_DHCP\";\nmsg.payload = global.get(\"Odroid_IP_from_GoProAP_DHCP\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":1100,"wires":[["dd8532c3.a1061"]]},{"id":"dd8532c3.a1061","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Odroid_IP_from_GoProAP_DHCP","mode":"link","links":["28bf2222176037e4"],"x":835,"y":1100,"wires":[]},{"id":"d0d41491.fa7428","type":"function","z":"b99a57ec.925fb8","name":"GoPro-IP_from_Odroid-DHCP","func":"msg.topic = \"GoPro_IP_from_Odroid_DHCP\";\nmsg.payload = global.get(\"GoPro_IP_from_Odroid_DHCP\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":1160,"wires":[["2dd73717.36ac78"]]},{"id":"2dd73717.36ac78","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_GoPro-IP_from_Odroid-DHCP","mode":"link","links":["8f9e4080f30fe240"],"x":835,"y":1160,"wires":[]},{"id":"b7839544.79e088","type":"function","z":"b99a57ec.925fb8","name":"BLE_DeviceName","func":"msg.topic = \"BLE_DeviceName\";\nmsg.payload = global.get(\"BLE_DeviceName\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1220,"wires":[["95c19abc.16a1f8","294d349a6644a157"]]},{"id":"95c19abc.16a1f8","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_BLE_DeviceName","mode":"link","links":["0773b01366e539c3"],"x":835,"y":1220,"wires":[]},{"id":"ddef5cc2.2a6c4","type":"function","z":"b99a57ec.925fb8","name":"DeviceName restore","func":"msg.topic = \"DeviceName\";\nmsg.payload = global.get(\"DeviceName\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":320,"wires":[["639a9d50.086244"]]},{"id":"639a9d50.086244","type":"link out","z":"b99a57ec.925fb8","name":"Global_variable_Backup_DeviceName->DB_Parameter","links":["1206971e.cd3a59"],"x":795,"y":320,"wires":[]},{"id":"8e7e958d.ce6698","type":"inject","z":"b99a57ec.925fb8","name":"Startup","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payloadType":"date","x":220,"y":240,"wires":[["d8fa7064.9f60a"]]},{"id":"df220a5a.3ea118","type":"comment","z":"b99a57ec.925fb8","name":"Platzhalter - ready to use","info":"","x":630,"y":2220,"wires":[]},{"id":"1f6be674ca1e7107","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Lat_Degree restore","func":"msg.topic = \"DegMinSec_Lat_Degree\";\nmsg.payload = global.get(\"DegMinSec_Lat_Degree\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":620,"wires":[["20bdd39245962387"]]},{"id":"20bdd39245962387","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Lat_Degree","mode":"link","links":["b47db269d09e4d0a"],"x":835,"y":620,"wires":[]},{"id":"95593ff10b547bcc","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Lat_Minutes restore","func":"msg.topic = \"DegMinSec_Lat_Minutes\";\nmsg.payload = global.get(\"DegMinSec_Lat_Minutes\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":680,"wires":[["df5aefe955974d25"]]},{"id":"df5aefe955974d25","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Lat_Minutes","mode":"link","links":["34a24617bd4916d2"],"x":835,"y":680,"wires":[]},{"id":"63666ab5b775ed31","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Lat_Seconds restore","func":"msg.topic = \"DegMinSec_Lat_Seconds\";\nmsg.payload = global.get(\"DegMinSec_Lat_Seconds\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":740,"wires":[["2a5b957da19aa5b3"]]},{"id":"2a5b957da19aa5b3","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Lat_Seconds","mode":"link","links":["bf1231f10af93d6b"],"x":835,"y":740,"wires":[]},{"id":"07c87704937636e1","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Long_Degree restore","func":"msg.topic = \"DegMinSec_Long_Degree\";\nmsg.payload = global.get(\"DegMinSec_Long_Degree\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":800,"wires":[["b0beab3cd4dfa0dc"]]},{"id":"b0beab3cd4dfa0dc","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Long_Degree","mode":"link","links":["8c8db49ba4f5522c"],"x":835,"y":800,"wires":[]},{"id":"4af02c23b6ab2b6f","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Long_Minutes restore","func":"msg.topic = \"DegMinSec_Long_Minutes\";\nmsg.payload = global.get(\"DegMinSec_Long_Minutes\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":860,"wires":[["e84cb9a144849b24"]]},{"id":"e84cb9a144849b24","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Long_Minutes","mode":"link","links":["be3b73a07dd8f388"],"x":835,"y":860,"wires":[]},{"id":"719aa9fcb3337fe5","type":"function","z":"b99a57ec.925fb8","name":"DegMinSec_Long_Seconds restore","func":"msg.topic = \"DegMinSec_Long_Seconds\";\nmsg.payload = global.get(\"DegMinSec_Long_Seconds\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":920,"wires":[["a27059a91b257dc1"]]},{"id":"a27059a91b257dc1","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_DegMinSec_Long_Seconds","mode":"link","links":["e943c065fbcee004"],"x":835,"y":920,"wires":[]},{"id":"5f6c9578d0371687","type":"function","z":"b99a57ec.925fb8","name":"NMEA_Lat restore","func":"msg.topic = \"NMEA_Lat\";\nmsg.payload = global.get(\"NMEA_Lat\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":980,"wires":[["a65cb628105a1f6f"]]},{"id":"edfc1da4ea5c7aa2","type":"function","z":"b99a57ec.925fb8","name":"NMEA_Long restore","func":"msg.topic = \"NMEA_Long\";\nmsg.payload = global.get(\"NMEA_Long\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1040,"wires":[["e1eb6b5ebeaed27c"]]},{"id":"a65cb628105a1f6f","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_NMEA_Lat","mode":"link","links":["2121fb6158213ea9"],"x":835,"y":980,"wires":[]},{"id":"e1eb6b5ebeaed27c","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_Backup_NMEA_Long","mode":"link","links":["b6292ab0f85ca8b1"],"x":835,"y":1040,"wires":[]},{"id":"41dcb6bada046cf9","type":"debug","z":"b99a57ec.925fb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":80,"wires":[]},{"id":"e5731aeb3b24ef9c","type":"function","z":"b99a57ec.925fb8","name":"BLE_DeviceMAC","func":"msg.topic = \"BLE_DeviceMAC\";\nmsg.payload = global.get(\"BLE_DeviceMAC\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1260,"wires":[["01118aa8440c158d"]]},{"id":"01118aa8440c158d","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_BLE_DeviceMAC","mode":"link","links":["9de3b3cce5b4aa0f"],"x":835,"y":1260,"wires":[]},{"id":"a79cd937e134867e","type":"function","z":"b99a57ec.925fb8","name":"BLE_PairingSuccess","func":"msg.topic = \"BLE_PairingSuccess\";\nmsg.payload = global.get(\"BLE_PairingSuccess\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1320,"wires":[["c048503838c1bb5a"]]},{"id":"c048503838c1bb5a","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_BLE_PairingSuccess","mode":"link","links":["d501669af4e3bcc3","3c1247d2b7cf6a6e"],"x":835,"y":1320,"wires":[]},{"id":"16863535bee7695c","type":"function","z":"b99a57ec.925fb8","name":"BLE_PairingSuccessTimestamp","func":"msg.topic = \"BLE_PairingSuccessTimestamp\";\nmsg.payload = global.get(\"BLE_PairingSuccessTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":1380,"wires":[[]]},{"id":"4ad0f58640984fde","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_BLE_PairingSuccessTimestamp","mode":"link","links":[],"x":835,"y":1380,"wires":[]},{"id":"8fe73a573e12ad4d","type":"function","z":"b99a57ec.925fb8","name":"BLE_DevicePaired","func":"msg.topic = \"BLE_DevicePaired\";\nmsg.payload = global.get(\"BLE_DevicePaired\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1440,"wires":[[]]},{"id":"fe84585880dba3cf","type":"link out","z":"b99a57ec.925fb8","name":"Global_Variable_BLE_DevicePaired","mode":"link","links":[],"x":835,"y":1440,"wires":[]},{"id":"02aa0e05fe16222a","type":"function","z":"b99a57ec.925fb8","name":"BLE_ConnectSuccess","func":"msg.topic = \"BLE_ConnectSuccess\";\nmsg.payload = global.get(\"BLE_ConnectSuccess\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1500,"wires":[[]]},{"id":"1e316c82ec3cbd8b","type":"link out","z":"b99a57ec.925fb8","name":"","mode":"link","links":[],"x":835,"y":1500,"wires":[]},{"id":"41e92b9685b73bb1","type":"function","z":"b99a57ec.925fb8","name":"BLE_ConnectSuccessTimestamp","func":"msg.topic = \"BLE_ConnectSuccessTimestamp\";\nmsg.payload = global.get(\"BLE_ConnectSuccessTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":1560,"wires":[[]]},{"id":"48eb0e76ab31d622","type":"link out","z":"b99a57ec.925fb8","name":"","mode":"link","links":[],"x":835,"y":1560,"wires":[]},{"id":"294d349a6644a157","type":"debug","z":"b99a57ec.925fb8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":250,"y":1160,"wires":[]},{"id":"db975ce2fe718abc","type":"function","z":"b99a57ec.925fb8","name":"BLE_DeviceConnectedTimestamp","func":"msg.topic = \"BLE_DeviceConnectedTimestamp\";\nmsg.payload = global.get(\"BLE_DeviceConnectedTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":1620,"wires":[[]]},{"id":"b37884f413252909","type":"function","z":"b99a57ec.925fb8","name":"BLE_TrustSuccess","func":"msg.topic = \"BLE_TrustSuccess\";\nmsg.payload = global.get(\"BLE_TrustSuccess\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1680,"wires":[[]]},{"id":"5436f5e79363f788","type":"function","z":"b99a57ec.925fb8","name":"BLE_TrustSuccessTimestamp","func":"msg.topic = \"BLE_TrustSuccessTimestamp\";\nmsg.payload = global.get(\"BLE_TrustSuccessTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":1740,"wires":[[]]},{"id":"ce62d9d0a99d3ce5","type":"function","z":"b99a57ec.925fb8","name":"BLE_DeviceTrusted","func":"msg.topic = \"BLE_DeviceTrusted\";\nmsg.payload = global.get(\"BLE_DeviceTrusted\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1800,"wires":[[]]},{"id":"ec3818282d194096","type":"function","z":"b99a57ec.925fb8","name":"BLE_DeviceTrustedTimestamp","func":"msg.topic = \"BLE_DeviceTrustedTimestamp\";\nmsg.payload = global.get(\"BLE_DeviceTrustedTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":1860,"wires":[[]]},{"id":"a090926901651c2a","type":"function","z":"b99a57ec.925fb8","name":"BLE_DisconnectSuccess","func":"msg.topic = \"BLE_DisconnectSuccess\";\nmsg.payload = global.get(\"BLE_DisconnectSuccess\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1920,"wires":[[]]},{"id":"cc5b9eaccbcaaaf8","type":"function","z":"b99a57ec.925fb8","name":"BLE_DisconnectSuccessTimestamp","func":"msg.topic = \"BLE_DisconnectSuccessTimestamp\";\nmsg.payload = global.get(\"BLE_DisconnectSuccessTimestamp\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":1980,"wires":[[]]},{"id":"0443d619bce12405","type":"link in","z":"b99a57ec.925fb8","name":"Global Variable_Backup -->BLE_Connection","links":["8b1a05bbd28e15a2"],"x":175,"y":80,"wires":[["cd837853fabe9720"]]},{"id":"cd837853fabe9720","type":"change","z":"b99a57ec.925fb8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":80,"wires":[["d547483e.775438"]]},{"id":"3c11580134f5af93","type":"function","z":"b99a57ec.925fb8","name":"GoProHttpConnected","func":"msg.topic = \"GoProHttpConnected\";\nmsg.payload = global.get(\"GoProHttpConnected\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":2040,"wires":[[]]},{"id":"5480ab27ebc4e107","type":"file in","z":"90509ca450600ee8","name":"","filename":"/home/odroid/.node-red/settings.js","format":"utf8","allProps":false,"x":440,"y":120,"wires":[["06b46f14d210640f","f545de99371b7ac8"]]},{"id":"d5ce9bc47ebd28ef","type":"inject","z":"90509ca450600ee8","name":"Periodically Backup","props":[{"p":"payload"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":160,"y":120,"wires":[["5480ab27ebc4e107"]]},{"id":"06b46f14d210640f","type":"debug","z":"90509ca450600ee8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":60,"wires":[]},{"id":"f545de99371b7ac8","type":"function","z":"90509ca450600ee8","name":"BackUp Environmental Variables","func":"\n\n//get the global variables\n\nvar value1 = global.get('Odroid_IP_from_GoProAP_DHCP');\nvar value2 = global.get('GoPro_IP_from_Odroid_DHCP'); \n//var value3 = global.get('BLE_DeviceName');\n//var value4 = global.get('BLE_DeviceMAC'); \n\n//var value3 = global.get('');; \n\n\n//grep the entries of the Env_Var from settings.js\n\nvar regex1 = /process.env.Odroid_IP_from_GoProAP_DHCP=.*;/;\nvar regex2 = /process.env.GoPro_IP_from_Odroid_DHCP=.*;/;\n//var regex3 = /process.env.BLE_DeviceName=.*;/;\n//var regex4 = /process.env.BLE_DeviceMAC=.*;/;\n\n//var regex3 = /process.env.{{your variable}}=.*;/;\n\n//replace old value of Env_Var by acutal value of Global Variable\n\nmsg.payload = msg.payload.replace(regex1, \"process.env.Odroid_IP_from_GoProAP_DHCP='\"+value1+\"';\");\nmsg.payload = msg.payload.replace(regex2, \"process.env.GoPro_IP_from_Odroid_DHCP='\"+value2+\"';\");\n//msg.payload = msg.payload.replace(regex3, \"process.env.BLE_DeviceName='\"+value3+\"';\");\n//msg.payload = msg.payload.replace(regex4, \"process.env.BLE_DeviceMAC='\"+value4+\"';\");\n\n//msg.payload = msg.payload.replace(regex3, \"process.env.{{your variable}}='\"+value3+\"';\");\n\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":120,"wires":[["194a6a294bd966a5","822594d82940f1e7"]],"info":"\n\nGlobale Variablen werden im Dashboard declared und der Value dort gesetzt ODER unter BLE_Connection declared und dort gesetzt.\n\nHier, in diesem Node, werden die Values der globalen Variablen, wenn gewünscht, auf Environmentalvariablen übertragen, damit diese Values für Node Properties dynamisch genutzt werden können\n\nDie Environmental Variables müssen händisch in der Settings.js declared werden.\n(ein 2. Satz ist schon vorbereitet)\n\nDas Restore aus der settings.js erfolgt bei jedem restart von Nodered automatisch."},{"id":"194a6a294bd966a5","type":"debug","z":"90509ca450600ee8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":990,"y":60,"wires":[]},{"id":"822594d82940f1e7","type":"file","z":"90509ca450600ee8","name":"","filename":"/home/odroid/.node-red/settings.js","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":440,"y":200,"wires":[[]]},{"id":"56fa40d09e67637c","type":"comment","z":"90509ca450600ee8","name":"Global_Variabel --> Environmental_Variable_Backup","info":"","x":250,"y":60,"wires":[]},{"id":"e169cfc5e475473a","type":"comment","z":"90509ca450600ee8","name":"beachte Comment zu node: BackUp Environmental Variables","info":"","x":840,"y":200,"wires":[]},{"id":"37cf70db749f5281","type":"link in","z":"90509ca450600ee8","name":"Global_Variabel - Environmental_Variable_Backup --> BLE_Connection","links":["bc92a374f77dd847"],"x":175,"y":180,"wires":[["5480ab27ebc4e107"]]},{"id":"c0a9fedc.8f367","type":"exec","z":"247347a2.a3c6b8","command":"ps aux | grep node-red | grep -v grep","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"node red grep node","x":310,"y":200,"wires":[["a5b9ede3.09cd8","ff2b139d.ab0de"],[],[]]},{"id":"9447fad1.70ee18","type":"inject","z":"247347a2.a3c6b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":120,"y":220,"wires":[["c0a9fedc.8f367"]]},{"id":"a5b9ede3.09cd8","type":"debug","z":"247347a2.a3c6b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":510,"y":160,"wires":[]},{"id":"ff2b139d.ab0de","type":"function","z":"247347a2.a3c6b8","name":"find PID","func":"\nvar pid = msg.payload.match(/\\s{3,}\\d{2,}\\s{1,}/);\nmsg.payload = pid.toString().trim();\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":240,"wires":[["ce9e2eeb.3e186","e8769b26.e6a028"]]},{"id":"ce9e2eeb.3e186","type":"debug","z":"247347a2.a3c6b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":160,"wires":[]},{"id":"e8769b26.e6a028","type":"exec","z":"247347a2.a3c6b8","command":"kill PID","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":680,"y":240,"wires":[[],[],[]]},{"id":"dc879c9e6332c04d","type":"link in","z":"247347a2.a3c6b8","name":"Restart Nodered","links":["06ef18289835543a"],"x":85,"y":140,"wires":[["c0a9fedc.8f367"]]},{"id":"ac4bb41e.953978","type":"subflow:ff56ed00.f5dfb","z":"55f61d10.869814","name":"","x":560,"y":200,"wires":[]},{"id":"a0bf07a4.3d9e18","type":"inject","z":"55f61d10.869814","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":200,"wires":[["ac4bb41e.953978"]]},{"id":"ea0e929f.597","type":"inject","z":"2eac6958.c8b676","name":"Show youtube video","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"http://192.168.6.4:10000","payloadType":"str","x":250,"y":220,"wires":[["576275e3.77cc1c"]]},{"id":"576275e3.77cc1c","type":"ui_template","z":"2eac6958.c8b676","d":true,"group":"e9a45c1a.a0da","name":"Youtube_screen","order":1,"width":26,"height":26,"format":"\n\n\n\n    \n// div style=\"width: 100%; height: 100%;\"\n\n<div class=\"ignore-css\"; style=\"width: 1000px !important;\">\n    <iframe id=\"iframe\" src=\"\" ></iframe>\n</div>\n\n<script> \n    (function(scope) {\n        // Watch for messages being send to this template node\n        scope.$watch('msg', function (msg) {      \n            if (msg) {\n\n                var iframe = document.getElementById('iframe');\n                iframe.src = msg.payload; // + \"?autoplay=1;start=2\";\n            }       \n         }); \n    })(scope); \n</script>\n\n\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":440,"y":220,"wires":[["d7be396da08a9d04"]]},{"id":"d7be396da08a9d04","type":"debug","z":"2eac6958.c8b676","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":620,"y":260,"wires":[]},{"id":"3d69148cb2eca6fc","type":"ui_template","z":"2eac6958.c8b676","group":"e9a45c1a.a0da","name":"Youtube_screen","order":2,"width":"0","height":"0","format":"\n\n\n\n<!-- \n<div style=\"overflow: hidden; width: 1330px; height: 540px;\">-->\n<div style=\"overflow: hidden; width: 100%; height: 100%;\">\n    <iframe src=\"http://192.168.6.4:10000\" style=\"overflow: hidden; width: 1024px; height: 560px;\"></iframe>\n</div>    \n    <!-- <iframe src=\"http://192.168.6.4:10000\" frameborder=\"0\" style=\"overflow:hidden;height:200%;width:100%\" height=\"200%\" width=\"100%\"></iframe>\n\n\n<!-- </div>-->\n\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":440,"y":320,"wires":[[]]},{"id":"223ec2f0.12030e","type":"rpi-gpio in","z":"cbd4e407.b4f008","name":"","pin":"17","intype":"tri","debounce":"25","read":false,"bcm":true,"x":150,"y":320,"wires":[["2a2239d.9026ec6"]]},{"id":"2a2239d.9026ec6","type":"function","z":"cbd4e407.b4f008","name":"setTimeStamp_State","func":"var ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nmsg.payload = (new Date(Date.now() - offset)).toISOString()+ \"_\" + msg.payload;\n\nreturn msg;\n\n\n//orig\n\n//var ts = new Date();\n//msg.payload = ts.toISOString() + \"_\" + msg.payload;\n////msg.payload = ts.toUTCString() + \"_\" + msg.payload;\n//return msg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":200,"wires":[["205f2f8a.5761c"]]},{"id":"180ebe72.0c8fd2","type":"buffer-array","z":"cbd4e407.b4f008","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":710,"y":200,"wires":[["fcea03cc.903ce"]]},{"id":"fcea03cc.903ce","type":"function","z":"cbd4e407.b4f008","name":"Timespan_Calculation","func":"//var NewMsg = {Timestamp1:0, Timestamp2:0, Timestamp3:0, Timestamp4:0, Signal1:\"0\", Signal2:\"0\", Signal3:\"0\", Signal4:\"0\", Timespan1:0, Timespan2:0, Timespan3:0}\nvar NewMsg = {Topic: \"ACTUALVALUE\", Timestamp1:0, Timestamp2:0, Signal1:\"0\", Signal2:\"0\", Timespan:0}\n\nvar d1 = Date.parse(msg.payload[0][0]);\nvar d2 = Date.parse(msg.payload[1][0]);\n//var d3 = Date.parse(msg.payload[2][0]);\n//var d4 = Date.parse(msg.payload[3][0]);\n  \nNewMsg.Timestamp1= d1;\nNewMsg.Timestamp2= d2;\n//NewMsg.Timestamp3= d3;\n//NewMsg.Timestamp4= d4;\n\nNewMsg.Signal1 = msg.payload[0][1];\nNewMsg.Signal2 = msg.payload[1][1];\n//NewMsg.Signal3 = msg.payload[2][1];\n//NewMsg.Signal4 = msg.payload[3][1];\n\nNewMsg.Timespan = (d2 - d1) / 1000;\n//NewMsg.Timespan2 = (d3 - d2) / 1000;\n//NewMsg.Timespan3 = (d4 - d3) / 1000;\n\nreturn NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":920,"y":200,"wires":[["ed30331e.3f492","4b12c337.aee19c","aed9b2de.bbcde"]]},{"id":"205f2f8a.5761c","type":"function","z":"cbd4e407.b4f008","name":"SPLIT","func":"msg.payload = msg.payload.split(\"_\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":200,"wires":[["180ebe72.0c8fd2"]]},{"id":"4279113e.562d4","type":"http request","z":"cbd4e407.b4f008","name":"","method":"PUT","ret":"txt","paytoqs":false,"url":"http://10.5.5.9/gp/gpControl/command/storage/tag_moment","tls":"","persist":false,"proxy":"","authType":"","x":910,"y":260,"wires":[[]]},{"id":"ed30331e.3f492","type":"switch","z":"cbd4e407.b4f008","name":"IGNITION_on","property":"Signal1","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":360,"y":260,"wires":[["90c334d.8181ac8"]]},{"id":"90c334d.8181ac8","type":"function","z":"cbd4e407.b4f008","name":"PassLimit","func":"var NewMsg = {payload: 0, OnBrakeTimespan: 0, OnBrakeLimit: 0};\nvar Settings = global.get('OnBrakeLimit');\n\n//NewMsg.OnClutchLimit = Settings.OnClutchLimit;\nNewMsg.OnBrakeLimit = Settings;\nNewMsg.OnBrakeTimespan = msg.Timespan;\n    \nvar PassActualValue  = 1;\nvar BlockActualValue = 0;\n\n    if( msg.Timespan >= Settings)\n     {\n       NewMsg.payload = PassActualValue;\n     }\n    else\n     {\n       NewMsg.payload = BlockActualValue;\n     }\n\nreturn NewMsg;\n\n//var NewMsg = {payload: 0, OnBrakeTimespan: 0, OnBrakeLimit: 0};\n//var Settings = global.get(\"SpaceStarSettings\");\n\n//NewMsg.OnBrakeLimit = Settings.OnBrakeLimit;\n//NewMsg.OnBrakeTimespan = msg.Timespan;\n    \n//var PassActualValue  = 1;\n//var BlockActualValue = 0;\n\n  //  if( msg.Timespan >= Settings.OnBrakeLimit)\n  //   {\n   //    NewMsg.payload = PassActualValue;\n   //  }\n  //  else\n  //   {\n  //     NewMsg.payload = BlockActualValue;\n  //   }\n\n//return NewMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":260,"wires":[["c85dca.e796a238","b1a8d171.27cd5"]]},{"id":"c85dca.e796a238","type":"switch","z":"cbd4e407.b4f008","name":"GreaterThanZero","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":260,"wires":[["4279113e.562d4"]]},{"id":"b1a8d171.27cd5","type":"debug","z":"cbd4e407.b4f008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":570,"y":320,"wires":[]},{"id":"5a9013d8.86ffcc","type":"inject","z":"cbd4e407.b4f008","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":170,"y":180,"wires":[["2a2239d.9026ec6"]]},{"id":"8afe42c4.02ed9","type":"inject","z":"cbd4e407.b4f008","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":180,"y":240,"wires":[["2a2239d.9026ec6"]]},{"id":"4b12c337.aee19c","type":"link out","z":"cbd4e407.b4f008","name":"BRAKE","mode":"link","links":[],"x":945,"y":340,"wires":[]},{"id":"aed9b2de.bbcde","type":"debug","z":"cbd4e407.b4f008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":300,"wires":[]},{"id":"48b1a0d8b9e93113","type":"exec","z":"d995685759e9a253","command":"timeout 2 cat < /dev/ttyACM0","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Read Raw GPS Data","x":460,"y":160,"wires":[["f7486f94b9ec09ba","c989e9b315967020"],[],[]]},{"id":"0f7d058477a0e9f5","type":"inject","z":"d995685759e9a253","name":"","props":[{"p":"timestamp","v":"","vt":"date"},{"p":"latitude","v":"","vt":"str"},{"p":"longitude","v":"","vt":"str"},{"p":"payload"}],"repeat":"3","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"str","x":210,"y":160,"wires":[["48b1a0d8b9e93113"]]},{"id":"f7486f94b9ec09ba","type":"debug","z":"d995685759e9a253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":770,"y":100,"wires":[]},{"id":"c989e9b315967020","type":"function","z":"d995685759e9a253","name":"parse GPS coordinates","func":"\nglobal.set('Dezimalgrad_Lat',msg.payload);\n\n// const reg_GPGGA = /GPGGA\\X.\\n$/; //unused\nconst reg_before_GPGGA = /[\\s\\S]*GPGGA/;\nconst reg_after_GPGGA = /GPGSA[\\s\\S]*/;\nconst reg_before_latitude = /\\w,\\d,/;\nconst reg_timestamp = /\\.\\d{3}Z/;\n\nvar NMEAMsg = {Topic: \"NMEA\", timestamp: 0, Lat:0, Long:0}\nvar DegMinSecMsg = {Topic: \"DMS\", timestamp: 0, Lat_Degree:0, Lat_Minutes:0, Lat_Seconds:0, Long_Degree:0, Long_Minutes:0, Long_Seconds:0}\nvar DecDegMsg = {Topic: \"DG\", timestamp: 0, Lat:0, Long:0}\n\nvar degree_lat = 0;\nvar minutes_lat = 0;\nvar seconds_lat = 0;\nvar degree_long = 0;\nvar minutes_long = 0;\nvar seconds_long = 0;\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\nvar GPGGA_output = \"1\";\n\n\n\n//parsing friendly timestamp\nNMEAMsg.timestamp = ((new Date(Date.now() - offset)).toISOString()).replace(\"T\", \" \").replace(reg_timestamp,\"\");\nDegMinSecMsg.timestamp = NMEAMsg.timestamp;\nDecDegMsg.timestamp = NMEAMsg.timestamp;\n\n\n\n\n//Parsing NMEA-Format in ddmm,mmmm out of raw-data\nGPGGA_output = msg.payload.replace(reg_before_GPGGA, \"GPGGA\").replace(reg_after_GPGGA, \"\");\nNMEAMsg.Lat = GPGGA_output.substr(16,10);\nNMEAMsg.Long = GPGGA_output.substr(30,10);\n \n //setting Global Variables\n    global.set('NMEA_Lat', NMEAMsg.Lat);\n    global.set('NMEA_Long', NMEAMsg.Long);\n\n\n//Parsing DegMinSec - Format in gg mm ss,sss out of NMEA-Format\nDegMinSecMsg.Lat_Degree = NMEAMsg.Lat.substr(0,2);\nDegMinSecMsg.Lat_Minutes = NMEAMsg.Lat.substr(2,2);\nDegMinSecMsg.Lat_Seconds = ((NMEAMsg.Lat.substr(4,5))*60).toFixed(3);\nDegMinSecMsg.Long_Degree = NMEAMsg.Long.substr(0,2);\nDegMinSecMsg.Long_Minutes = NMEAMsg.Long.substr(2,2);\nDegMinSecMsg.Long_Seconds = ((NMEAMsg.Long.substr(4,5))*60).toFixed(3);\n \n    //setting Global Variables\n    global.set('DegMinSec_Lat_Degree', DegMinSecMsg.Lat_Degree);\n    global.set('DegMinSec_Lat_Minutes', DegMinSecMsg.Lat_Minutes);\n    global.set('DegMinSec_Lat_Seconds', DegMinSecMsg.Lat_Seconds);\n    global.set('DegMinSec_Long_Degree', DegMinSecMsg.Long_Degree);\n    global.set('DegMinSec_Long_Minutes', DegMinSecMsg.Long_Minutes);\n    global.set('DegMinSec_Long_Seconds', DegMinSecMsg.Long_Seconds);\n\n\n//Parsing DG - Format in dd,dddddd out of DegMinSec-Format\ndegree_lat = Number(DegMinSecMsg.Lat_Degree);\nminutes_lat = Number(DegMinSecMsg.Lat_Minutes);\nseconds_lat = Number(DegMinSecMsg.Lat_Seconds);\ndegree_long = Number(DegMinSecMsg.Long_Degree);\nminutes_long = Number(DegMinSecMsg.Long_Minutes);\nseconds_long = Number(DegMinSecMsg.Long_Seconds);\n\nDecDegMsg.Lat = (degree_lat + minutes_lat/60 + seconds_lat/3600).toFixed(6);\nDecDegMsg.Long = (degree_long + minutes_long/60 + seconds_long/3600).toFixed(6);\n    \n    //setting Global Variables\n    global.set('Dezimalgrad_Lat', DecDegMsg.Lat);\n    global.set('Dezimalgrad_Long', DecDegMsg.Long);\n\nreturn [NMEAMsg,DegMinSecMsg,DecDegMsg];\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":160,"wires":[[],[],["e1518f926f6f7eb2","19d44031b9ac3461"]]},{"id":"19d44031b9ac3461","type":"debug","z":"d995685759e9a253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1010,"y":100,"wires":[]},{"id":"e1518f926f6f7eb2","type":"link out","z":"d995685759e9a253","name":"GPS_DecDeg","mode":"link","links":["c9f216694f74788a"],"x":985,"y":220,"wires":[]},{"id":"d02a57fbbb85f7af","type":"status","z":"d995685759e9a253","name":"","scope":["48b1a0d8b9e93113"],"x":420,"y":240,"wires":[["4f3370645b9a4010"]]},{"id":"4f3370645b9a4010","type":"debug","z":"d995685759e9a253","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":700,"y":320,"wires":[]},{"id":"688cf92c.1f9a48","type":"trigger","z":"dec8dfb9.8b01d8","name":"for puls","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"200","extend":false,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":480,"y":80,"wires":[["feabb847.8fa378"]]},{"id":"feabb847.8fa378","type":"function","z":"dec8dfb9.8b01d8","name":"main func","func":"if(msg.topic === \"setStatus\") return [null,null];\n\nvar Door = 0;\nvar pin = global.get(\"manual\"); // number\n\nif (msg.flow[pin].t !== \"switch\") {\n    Door = msg.payload;\n    if(msg.payload === true || msg.payload === false) {\n       node.warn(\"Doors need to be opend and closed!!!\");\n       return null;\n    }\n}\n\nif( Door === \"OPEN\" || Door === \"CLOSED\" ) { \n    return {manually:true,i:pin,state:Door === \"OPEN\"?false:true}; // doors\n} \nif(msg.payload === \"OPEN\" || msg.payload === \"CLOSED\") {\n   msg.payload = msg.payload === \"CLOSED\"? false:true;\n}           \nreturn{  i       :pin,\n         state   :msg.payload,\n         manually:true};\n\n\n","outputs":1,"noerr":0,"x":648,"y":116,"wires":[[]],"outputLabels":["Doors"]},{"id":"2901597f.23a516","type":"switch","z":"dec8dfb9.8b01d8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"pushed","vt":"str"},{"t":"eq","v":"pushed-released","vt":"str"},{"t":"eq","v":"CLOSED","vt":"str"},{"t":"eq","v":"OPEN","vt":"str"},{"t":"eq","v":"setStatus","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":302,"y":128,"wires":[["688cf92c.1f9a48"],["b999acdc.acb2c"],["3d798d5c.84e7a2"],["3d798d5c.84e7a2"],["e4f73ac0.49bb38"]]},{"id":"b999acdc.acb2c","type":"trigger","z":"dec8dfb9.8b01d8","name":"hold 1 sec","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"1000","extend":false,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":480,"y":116,"wires":[["feabb847.8fa378"]]},{"id":"3d798d5c.84e7a2","type":"trigger","z":"dec8dfb9.8b01d8","name":"dummy","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":480,"y":152,"wires":[["feabb847.8fa378"]]},{"id":"e4f73ac0.49bb38","type":"http request","z":"dec8dfb9.8b01d8","name":"get number from comment field","method":"GET","ret":"obj","paytoqs":false,"url":"http://openhab:1880/flows","tls":"","persist":false,"proxy":"","authType":"","x":262,"y":212,"wires":[["a15d0cf2.06521"]]},{"id":"a15d0cf2.06521","type":"change","z":"dec8dfb9.8b01d8","name":"set global to number","rules":[{"t":"set","p":"input","pt":"msg","to":"payload.(\t$number($[id=\"f987b28a.65576\"].name\t))","tot":"jsonata"},{"t":"set","p":"manual","pt":"global","to":"input","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":212,"wires":[["8a1db4ab.f16868"]]},{"id":"8a1db4ab.f16868","type":"function","z":"dec8dfb9.8b01d8","name":"Info on manual","func":"var Door = false;\nvar comment = [], p;\n\n\nif (msg.flow[msg.input].t === \"switch\") {\n    p = msg.flow[msg.input].puls;\n} else {\n    p =msg.flow[msg.input].OPEN;\n    Door = true;\n}\nfor (var name in p){\n    comment.push(name + \" - \");\n}\n\nmsg = {};\nreturn {payload:Door? \"Type: Door - Output \" + comment : \"Type: Switch - Outpu \" + comment};\n\n\n","outputs":1,"noerr":0,"x":728,"y":212,"wires":[[]]},{"id":"83bcaacafe176083","type":"exec","z":"5aa5a8f03826d123","command":"python test.py /dev/ttyACM1","addpay":"","append":"","useSpawn":"false","timer":"0.5","winHide":false,"oldrc":false,"name":"Read Raw myAHRS Data","x":310,"y":120,"wires":[["46a6cd1d1df953d1"],[],[]]},{"id":"9daeae541d2f1513","type":"inject","z":"5aa5a8f03826d123","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"2","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":110,"y":120,"wires":[["83bcaacafe176083"]]},{"id":"46a6cd1d1df953d1","type":"function","z":"5aa5a8f03826d123","name":"parse myAHRS data","func":"\nconst reg_before_dataset = /START[\\s\\S]*72\\n##\\s/;\nconst reg_after_dataset = /\\n##[\\s\\S]*/;\nconst roll_before = /[\\S]*\\s/;\nconst pitch_before = /[\\s\\S]*pitch\\s/;\nconst yaw_before = /[\\s\\S]*yaw\\s/;\nconst ax_before = /[\\s\\S]*ax\\s/;\nconst ay_before = /[\\s\\S]*ay\\s/;\nconst az_before = /[\\s\\S]*az\\s/;\nconst gx_before = /[\\s\\S]*gx\\s/;\nconst gy_before = /[\\s\\S]*gy\\s/;\nconst gz_before = /[\\s\\S]*gz\\s/;\nconst mx_before = /[\\s\\S]*mx\\s/;\nconst my_before = /[\\s\\S]*my\\s/;\nconst mz_before = /[\\s\\S]*mz\\s/;\nconst temp_before = /[\\s\\S]*temp\\s/;\nconst after = /,\\s[\\s\\S]*/;\nconst reg_timestamp = /\\.\\d{3}Z/;\n\nvar myAHRSMsg = {dataset: 0, Topic: \"myAHRS\", timestamp: 0, roll:0, pitch:0, yaw:0, ax:0, ay:0, az:0, gx:0, gy:0, gz:0, mx:0, my:0, mz:0, temp:0}\n\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\n\n//parsing friendly timestamp\nmyAHRSMsg.timestamp = ((new Date(Date.now() - offset)).toISOString()).replace(\"T\", \" \").replace(reg_timestamp,\"\");\n\n\n//Parsing 1 dataset out of raw-data\nmyAHRSMsg.dataset = msg.payload.replace(reg_before_dataset, \"\").replace(reg_after_dataset, \"\");\n\n//Parsing parameters out of dataset\nmyAHRSMsg.roll = myAHRSMsg.dataset.replace(roll_before, \"\").replace(after, \"\");\nmyAHRSMsg.pitch = myAHRSMsg.dataset.replace(pitch_before, \"\").replace(after, \"\");\nmyAHRSMsg.yaw = myAHRSMsg.dataset.replace(pitch_before, \"\").replace(after, \"\");\nmyAHRSMsg.ax = myAHRSMsg.dataset.replace(ax_before, \"\").replace(after, \"\");\nmyAHRSMsg.ay = myAHRSMsg.dataset.replace(ay_before, \"\").replace(after, \"\");\nmyAHRSMsg.az = myAHRSMsg.dataset.replace(az_before, \"\").replace(after, \"\");\nmyAHRSMsg.gx = myAHRSMsg.dataset.replace(gx_before, \"\").replace(after, \"\");\nmyAHRSMsg.gy = myAHRSMsg.dataset.replace(gy_before, \"\").replace(after, \"\");\nmyAHRSMsg.gz = myAHRSMsg.dataset.replace(gz_before, \"\").replace(after, \"\");\nmyAHRSMsg.mx = myAHRSMsg.dataset.replace(mx_before, \"\").replace(after, \"\");\nmyAHRSMsg.my = myAHRSMsg.dataset.replace(my_before, \"\").replace(after, \"\");\nmyAHRSMsg.mz = myAHRSMsg.dataset.replace(mz_before, \"\").replace(after, \"\");\n    // adapt incorrect temperature value (self found function: tacc = Tahrs*0,75 - 6)\nmyAHRSMsg.temp = (((myAHRSMsg.dataset.replace(temp_before, \"\").replace(after, \"\"))*0.75)-6).toFixed(1);\n\nreturn myAHRSMsg;\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":120,"wires":[["375def6260756d8a","c2385e8766c88819"],[],[]]},{"id":"375def6260756d8a","type":"debug","z":"5aa5a8f03826d123","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":120,"wires":[]},{"id":"c2385e8766c88819","type":"link out","z":"5aa5a8f03826d123","name":"AHRS","mode":"link","links":["45257d0bc62128b9"],"x":715,"y":200,"wires":[]},{"id":"b0abf3b37be19c88","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl power on","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl ON","x":400,"y":300,"wires":[["060e085fbcc0f603"],[],["9b95bdddfa1f8976","1459a40b135bab37"]]},{"id":"060e085fbcc0f603","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":300,"wires":[]},{"id":"9e8226a38cbeec68","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":100,"y":300,"wires":[["b0abf3b37be19c88"]]},{"id":"7d9648ea5def65ac","type":"exec","z":"dbfdd28e.d60f","d":true,"command":"bluetoothctl power off","addpay":"","append":"","useSpawn":"false","timer":"20","winHide":false,"oldrc":false,"name":"Bluetoothctl OFF","x":390,"y":3980,"wires":[["2544d996a6e0f9cd"],[],[]]},{"id":"2544d996a6e0f9cd","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":3980,"wires":[]},{"id":"ba75e6514d951229","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":160,"y":3980,"wires":[["7d9648ea5def65ac"]]},{"id":"39b9a9958d52b9c4","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl --timeout 3 scan on | grep NEW | grep GoPro | awk '{print \"NEW\", $2, $4, $5, \":\", $3}'","addpay":"","append":"","useSpawn":"false","timer":"0","winHide":false,"oldrc":false,"name":"Find New Gopro","x":400,"y":960,"wires":[["0195d3e9c79192d5","81cc8dcf40a95761"],["bac6b870d59916c5"],["77af31ccc077f582"]]},{"id":"0195d3e9c79192d5","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":920,"wires":[]},{"id":"e1ac804ee6dfb56f","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":100,"y":960,"wires":[["39b9a9958d52b9c4"]]},{"id":"03d51a855c69f103","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl scan off","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl Discovery OFF","x":420,"y":4420,"wires":[["0489f9149f39c5b3"],[],[]]},{"id":"0489f9149f39c5b3","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":4420,"wires":[]},{"id":"9b3abc5e912cda22","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":150,"y":4420,"wires":[["03d51a855c69f103"]]},{"id":"5b99c2a38427ff16","type":"exec","z":"dbfdd28e.d60f","command":"sudo service bluetooth restart","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetooth.service restart","x":430,"y":200,"wires":[[],[],["265066646aa0d3a3","b0abf3b37be19c88"]]},{"id":"e4357c7353e5b4d7","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":100,"y":200,"wires":[["5b99c2a38427ff16"]]},{"id":"265066646aa0d3a3","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":180,"wires":[]},{"id":"c87eba8d88eed687","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl paired-devices","addpay":"","append":"","useSpawn":"false","timer":"2","winHide":false,"oldrc":false,"name":"Bluetoothctl Paired-Devices","x":440,"y":4640,"wires":[["a9888028a83ce38a"],[],[]]},{"id":"a9888028a83ce38a","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":710,"y":4640,"wires":[]},{"id":"9d97c99403edb9e4","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":170,"y":4640,"wires":[["c87eba8d88eed687"]]},{"id":"c1e987d04acc226a","type":"exec","z":"dbfdd28e.d60f","command":"kill `ps aux | grep bluetoothctl | grep -v grep | awk '{print $2}'`","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"bluetoothctl scan off","x":400,"y":4260,"wires":[["f2908d4ce1f59cc4"],[],[]]},{"id":"351f0e91ddc118fd","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":4260,"wires":[["c1e987d04acc226a"]]},{"id":"f2908d4ce1f59cc4","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":4260,"wires":[]},{"id":"bac6b870d59916c5","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":960,"wires":[]},{"id":"77af31ccc077f582","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1000,"wires":[]},{"id":"dc3cda8043f95ae9","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl paired-devices","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl paired-devices","x":440,"y":2500,"wires":[["e68c7b80be5d2c21","1b93b0417c25d221"],[],["1712e315ed049a07"]]},{"id":"f1cd36493f8d6f69","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl scan on","addpay":"","append":"","useSpawn":"true","timer":"0","winHide":false,"oldrc":false,"name":"Bluetoothctl Discovery ON","x":430,"y":4100,"wires":[["19640a848c06f709"],["2a9d6a8c622585a2"],["48a24760a1db4709"]]},{"id":"19640a848c06f709","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":4040,"wires":[]},{"id":"372eecd27be83f6d","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":180,"y":4100,"wires":[["f1cd36493f8d6f69"]]},{"id":"2a9d6a8c622585a2","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":4080,"wires":[]},{"id":"48a24760a1db4709","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":4120,"wires":[]},{"id":"f664e078bd8491b2","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"kill","v":"","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":4160,"wires":[["f1cd36493f8d6f69"]]},{"id":"fce729d290727240","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"20","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":110,"y":2500,"wires":[["dc3cda8043f95ae9"]]},{"id":"e68c7b80be5d2c21","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2480,"wires":[]},{"id":"1712e315ed049a07","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2520,"wires":[]},{"id":"60e3a6dec38d35b4","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceName und BLE_DeviceMAC declaration from paired-devices","func":"\n\n\nconst before_DeviceName = /[\\s\\S]{25}/;\nconst before_DeviceMac = /[\\s\\S]{7}/;\nconst after_DeviceMac = / GoPro[\\s\\S]*\\n/;\nconst after_DeviceName = /\\n/;\n\nBLE_DeviceName = msg.payload.replace(before_DeviceName, \"\").replace(after_DeviceName, \"\");\nBLE_DeviceMAC = msg.payload.replace(before_DeviceMac, \"\").replace(after_DeviceMac, \"\");\n\nmsg.payload = BLE_DeviceName\nglobal.set('BLE_DeviceName',BLE_DeviceName);\nmsg.topic = BLE_DeviceMAC\nglobal.set('BLE_DeviceMAC',BLE_DeviceMAC);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":2620,"wires":[["db7089999af7e01f"]]},{"id":"db7089999af7e01f","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2620,"wires":[]},{"id":"81cc8dcf40a95761","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceName und BLE_DeviceMAC declaration from new devices","func":"\n\n\nconst before_DeviceName = /[\\s\\S]{11}/;\nconst before_DeviceMAC = /[\\s\\S]{24}/;\nconst after_DeviceName = /\\s:[\\s\\S]*/;\nconst after_DeviceMAC = /\\n/;\n\nBLE_DeviceName = msg.payload.replace(before_DeviceName, \"\").replace(after_DeviceName, \"\");\nBLE_DeviceMAC = msg.payload.replace(before_DeviceMAC, \"\").replace(after_DeviceMAC, \"\");\n\nmsg.payload = BLE_DeviceName;\nglobal.set('BLE_DeviceName',BLE_DeviceName);\nmsg.topic = BLE_DeviceMAC;\nglobal.set('BLE_DeviceMAC',BLE_DeviceMAC);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1040,"wires":[["022d9d2be1638d83","429855333cb2e5ea"]]},{"id":"022d9d2be1638d83","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1080,"wires":[]},{"id":"44a65827159274ec","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl scan on","addpay":"","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl Discovery ON","x":410,"y":4340,"wires":[["7a10fa2e762df601"],[],[]]},{"id":"7a10fa2e762df601","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":690,"y":4340,"wires":[]},{"id":"79a1d3c6f5f46e62","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":150,"y":4340,"wires":[["44a65827159274ec"]]},{"id":"832f98bf6aba316a","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl remove ${BLE_DeviceMAC}","addpay":"","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl Remove","x":440,"y":4840,"wires":[["ebfc2c4124436764"],["7e82ed127a2a93dd"],["685b3178cefe9974"]]},{"id":"ebfc2c4124436764","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4800,"wires":[]},{"id":"f4cde9c46172e31f","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":140,"y":4840,"wires":[["832f98bf6aba316a"]]},{"id":"685b3178cefe9974","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4880,"wires":[]},{"id":"7e82ed127a2a93dd","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4840,"wires":[]},{"id":"1002f0eee33e4a88","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl info ${BLE_DeviceMAC}","addpay":"","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl info","x":420,"y":4720,"wires":[["fea046d11b70fd8f"],["89039baa9acaa42f"],["bbcb1396a6260fc7"]]},{"id":"fea046d11b70fd8f","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4680,"wires":[]},{"id":"532d0bc9194ee52f","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":140,"y":4720,"wires":[["1002f0eee33e4a88"]]},{"id":"bbcb1396a6260fc7","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4760,"wires":[]},{"id":"89039baa9acaa42f","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4720,"wires":[]},{"id":"e2775642bcdaa43e","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl trust ${BLE_DeviceMAC}","addpay":"","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl Trust","x":430,"y":4560,"wires":[["3a9842334501f4a3"],["7cbe312b2123dc0a"],["df9519ec6b8ccbd6"]]},{"id":"3a9842334501f4a3","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":4520,"wires":[]},{"id":"aa8792689236beb8","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":140,"y":4580,"wires":[["e2775642bcdaa43e"]]},{"id":"df9519ec6b8ccbd6","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4620,"wires":[]},{"id":"7cbe312b2123dc0a","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":4580,"wires":[]},{"id":"b156afbaaa18c0d1","type":"function","z":"dbfdd28e.d60f","name":"BLE_PairingSuccess and BLE_PairingSuccessTimestamp declaration","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_PairingSuccess = /[\\s\\S]*Paired: /;\nconst after_PairingSuccess = /\\n/;\n\nBLE_PairingSuccess = msg.payload.toString().replace(before_PairingSuccess, \"\").replace(after_PairingSuccess, \"\");\n\nmsg.payload = BLE_PairingSuccess;\nglobal.set('BLE_PairingSuccess',BLE_PairingSuccess);\n\n\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\n\nBLE_PairingSuccessTimestamp = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = BLE_PairingSuccessTimestamp;\n\nglobal.set('BLE_PairingSuccessTimestamp',BLE_PairingSuccessTimestamp);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1280,"wires":[["00b8d0d921353f94","30fe85515f19f975"]]},{"id":"00b8d0d921353f94","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1400,"wires":[]},{"id":"e76bebafc7223605","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl info","addpay":"payload","append":"| grep Paired:","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl Info Paired Device","x":450,"y":2740,"wires":[["c8d556dcb866e309","bf58dda1b9f75f30"],[],["66cd4a7708a62c49"]]},{"id":"2b464af7ae54d501","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"Paired","payload":"BLE_DeviceMAC","payloadType":"global","x":150,"y":2740,"wires":[["e76bebafc7223605"]]},{"id":"c8d556dcb866e309","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2720,"wires":[]},{"id":"66cd4a7708a62c49","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2760,"wires":[]},{"id":"bf58dda1b9f75f30","type":"function","z":"dbfdd28e.d60f","name":"BLE_DevicePaired from Info paired-device","func":"\n\n\nconst before_DevicePaired = /[\\s\\S]{9}/;\nconst after_DevicePaired  = /\\n/;\n\nBLE_DevicePaired = msg.payload.replace(before_DevicePaired, \"\").replace(after_DevicePaired, \"\");\n\nmsg.payload = BLE_DevicePaired\nglobal.set('BLE_DevicePaired',BLE_DevicePaired);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":2820,"wires":[["8361cd6641bc8d5f"]]},{"id":"8361cd6641bc8d5f","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2820,"wires":[]},{"id":"589414f7eb8a5c3f","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl trust","addpay":"payload","append":"| grep trust","useSpawn":"false","timer":"0","winHide":false,"oldrc":false,"name":"Bluetoothctl trust","x":410,"y":1440,"wires":[["451232986ad88b0b","bc82fb56ce6d622e"],["7c9de926bf36eb07"],["58189fe6996c8a9a"]]},{"id":"451232986ad88b0b","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1460,"wires":[]},{"id":"180884bc6b8dd5f2","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":1440,"wires":[["589414f7eb8a5c3f"]]},{"id":"7c9de926bf36eb07","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1500,"wires":[]},{"id":"58189fe6996c8a9a","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1540,"wires":[]},{"id":"bc82fb56ce6d622e","type":"function","z":"dbfdd28e.d60f","name":"BLE_TrustSuccess and BLE_ TrustSuccessTimestamp","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_TrustSuccess = /[\\s\\S]{27}trust /;\n//const before_DeviceMac = /[\\s\\S]{24}/;\n//const after_DeviceConnected = /\\n/;\nconst after_TrustSuccess = /\\n/;\n\nBLE_TrustSuccess = msg.payload.replace(before_TrustSuccess, \"\").replace(after_TrustSuccess, \"\");\nmsg.payload = BLE_TrustSuccess;\nglobal.set('BLE_TrustSuccess',BLE_TrustSuccess);\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nBLE_TrustSuccessTimestamp = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = BLE_TrustSuccessTimestamp;\nglobal.set('BLE_TrustSuccessTimestamp',BLE_TrustSuccessTimestamp);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":1520,"wires":[["d107c2caddce7eed","932df7fb5078567b"]]},{"id":"d107c2caddce7eed","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1580,"wires":[]},{"id":"27863fe6a44e0ced","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl info","addpay":"payload","append":"| grep Connected:","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl Info Paired Device","x":450,"y":3360,"wires":[["a10dfd268a708d96","c1665837a8f3bb0b"],[],["f0ef918db6ea68da"]]},{"id":"46a850c8f13f7c17","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"timestamp","v":"","vt":"date"}],"repeat":"2","crontab":"","once":false,"onceDelay":0.1,"topic":"Connected","payload":"BLE_DeviceMAC","payloadType":"global","x":150,"y":3360,"wires":[["27863fe6a44e0ced"]]},{"id":"a10dfd268a708d96","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":3340,"wires":[]},{"id":"f0ef918db6ea68da","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":3380,"wires":[]},{"id":"c1665837a8f3bb0b","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceConnected from Info paired-device","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_DeviceConnected = /[\\s\\S]{12}/;\nconst after_DeviceConnected  = /\\n/;\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nBLE_DeviceConnected = msg.payload.replace(before_DeviceConnected, \"\").replace(after_DeviceConnected, \"\");\n\nmsg.payload = BLE_DeviceConnected\nglobal.set('BLE_DeviceConnected',BLE_DeviceConnected);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":3440,"wires":[["5f4a2125cff06216"]]},{"id":"5f4a2125cff06216","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":3440,"wires":[]},{"id":"36950a8c4c3a676c","type":"switch","z":"dbfdd28e.d60f","name":"","property":"BLE_DeviceConnected","propertyType":"global","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":3540,"wires":[["bfb4cbfb0a6fc404"],["a9747aec13342980"]]},{"id":"c1583ffe0183edef","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"2","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":3520,"wires":[["36950a8c4c3a676c"]]},{"id":"bfb4cbfb0a6fc404","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":3520,"wires":[["cda34c45e76eb59f"]]},{"id":"a9747aec13342980","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":3560,"wires":[["cda34c45e76eb59f"]]},{"id":"cda34c45e76eb59f","type":"buffer-array","z":"dbfdd28e.d60f","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":410,"y":3620,"wires":[["64161d6b46ef5f0d","9cf735ed17b7156f"]]},{"id":"9cf735ed17b7156f","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceConnectedTimestamp","func":"\n\nconst reg = /\\.\\d{3}Z/;\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\n\nmsg.topic = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\n\n\nif (msg.payload[0] + msg.payload[1] == 3) {\nglobal.set('BLE_DeviceConnectedTimestamp',msg.topic);\nmsg.payload = global.get('BLE_DeviceConnectedTimestamp');\n}else {\n  msg.payload = global.get('BLE_DeviceConnectedTimestamp');\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":3680,"wires":[["096f7d1209f438e2"]]},{"id":"64161d6b46ef5f0d","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":3620,"wires":[]},{"id":"096f7d1209f438e2","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":810,"y":3680,"wires":[]},{"id":"aec71ea8db4599a5","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl connect","addpay":"payload","append":"| grep Connection","useSpawn":"false","timer":"0","winHide":false,"oldrc":false,"name":"Bluetoothctl connect","x":420,"y":1920,"wires":[["d6e06dd79f0eb0b5","bfc49a6f0225fdb6"],["e35581dbdffbbfba"],["55ef53b3b1280a07"]]},{"id":"d6e06dd79f0eb0b5","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1840,"wires":[]},{"id":"2fdfc7f5656b05cc","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_DeviceMAC","payloadType":"global","x":140,"y":1920,"wires":[["aec71ea8db4599a5"]]},{"id":"e35581dbdffbbfba","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1880,"wires":[]},{"id":"55ef53b3b1280a07","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1920,"wires":[]},{"id":"bfc49a6f0225fdb6","type":"function","z":"dbfdd28e.d60f","name":"BLE_ConnectSuccess and BLE_ ConnectSuccessTimestamp","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_ConnectSuccess = /Connection /;\n//const before_DeviceMac = /[\\s\\S]{24}/;\n//const after_DeviceConnected = /\\n/;\nconst after_ConnectSuccess = /\\n/;\n\nBLE_ConnectSuccess = msg.payload.replace(before_ConnectSuccess, \"\").replace(after_ConnectSuccess, \"\");\nmsg.payload = BLE_ConnectSuccess;\nglobal.set('BLE_ConnectSuccess',BLE_ConnectSuccess);\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nBLE_ConnectSuccessTimestamp = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = BLE_ConnectSuccessTimestamp;\nglobal.set('BLE_ConnectSuccessTimestamp',BLE_ConnectSuccessTimestamp);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":2000,"wires":[["21bc1f7f2c424caa"]]},{"id":"21bc1f7f2c424caa","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1980,"wires":[]},{"id":"5c7240eb96c196da","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl info","addpay":"payload","append":"| grep Trusted:","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetoothctl Info Paired Device","x":450,"y":2920,"wires":[["c9ee21f5da459eaa","9f32eb44bb048333"],[],["b577938d19731fd3"]]},{"id":"0a3ebbd0e8f836f6","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"timestamp","v":"","vt":"date"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"Trusted","payload":"BLE_DeviceMAC","payloadType":"global","x":150,"y":2920,"wires":[["5c7240eb96c196da"]]},{"id":"c9ee21f5da459eaa","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2900,"wires":[]},{"id":"b577938d19731fd3","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":2940,"wires":[]},{"id":"9f32eb44bb048333","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceTrusted from Info paired-device","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_DeviceTrusted = /[\\s\\S]{10}/;\nconst after_DeviceTrusted  = /\\n/;\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nBLE_DeviceTrusted = msg.payload.replace(before_DeviceTrusted, \"\").replace(after_DeviceTrusted, \"\");\n\nmsg.payload = BLE_DeviceTrusted\nglobal.set('BLE_DeviceTrusted',BLE_DeviceTrusted);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":3000,"wires":[["c1a91b2de078cf42"]]},{"id":"c1a91b2de078cf42","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":3000,"wires":[]},{"id":"067da54616163685","type":"switch","z":"dbfdd28e.d60f","name":"","property":"BLE_DeviceTrusted","propertyType":"global","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":3100,"wires":[["bc5e496cc068a2f9"],["219d035d9db3e717"]]},{"id":"93e7d93d9f7af5c2","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":90,"y":3100,"wires":[["067da54616163685"]]},{"id":"bc5e496cc068a2f9","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":3080,"wires":[["a506802543e32ef8"]]},{"id":"219d035d9db3e717","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":3120,"wires":[["a506802543e32ef8"]]},{"id":"a506802543e32ef8","type":"buffer-array","z":"dbfdd28e.d60f","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":410,"y":3180,"wires":[["48154e943cb7832f","ff160365382636a0"]]},{"id":"ff160365382636a0","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceTrustedTimestamp","func":"\n\nconst reg = /\\.\\d{3}Z/;\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\n\nmsg.topic = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\n\n\nif (msg.payload[0] + msg.payload[1] == 3) {\nglobal.set('BLE_DeviceTrustedTimestamp',msg.topic);\nmsg.payload = global.get('BLE_DeviceTrustedTimestamp');\n}else {\n  msg.payload = global.get('BLE_DeviceTrustedTimestamp');\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":3240,"wires":[["9657eae3aacd79aa"]]},{"id":"48154e943cb7832f","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":3180,"wires":[]},{"id":"9657eae3aacd79aa","type":"debug","z":"dbfdd28e.d60f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":3240,"wires":[]},{"id":"4ea62f1dea08b4bb","type":"link in","z":"dbfdd28e.d60f","name":"BLE_Connection_Bluetoothctl connect","links":["c51b3d19f0477af1","1b70b9832d39b0e8","f3d94cd7a2ba6db6"],"x":55,"y":1860,"wires":[["c0dae1f18e52bef6"]]},{"id":"4dc7ba57f5086c13","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl disconnect","addpay":"payload","append":"| grep disconnected","useSpawn":"false","timer":"0","winHide":false,"oldrc":false,"name":"Bluetoothctl disconnect","x":430,"y":2240,"wires":[["0806ca58ba6ecafa","d9e09202cf3d7819"],["1ab5ec49f545abe3"],["679138c87c2d24af"]]},{"id":"0806ca58ba6ecafa","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2180,"wires":[]},{"id":"1ab5ec49f545abe3","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2220,"wires":[]},{"id":"679138c87c2d24af","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2260,"wires":[]},{"id":"d9e09202cf3d7819","type":"function","z":"dbfdd28e.d60f","name":"BLE_DisconnectSuccess and BLE_ DisconnectSuccessTimestamp","func":"\n\nconst reg = /\\.\\d{3}Z/;\nconst before_DisconnectSuccess = /Successful /;\n//const before_DeviceMac = /[\\s\\S]{24}/;\n//const after_DeviceConnected = /\\n/;\nconst after_DisconnectSuccess = /\\n/;\n\nBLE_DisconnectSuccess = msg.payload.replace(before_DisconnectSuccess, \"\").replace(after_DisconnectSuccess, \"\");\nmsg.payload = BLE_DisconnectSuccess;\nglobal.set('BLE_DisconnectSuccess',BLE_DisconnectSuccess);\n\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\n\nBLE_DisconnectSuccessTimestamp = new Date(msg.topic - offset).toISOString().replace(\"T\", \" \").replace(reg, \"\");\nmsg.topic = BLE_DisconnectSuccessTimestamp;\nglobal.set('BLE_DisconnectSuccessTimestamp',BLE_DisconnectSuccessTimestamp);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":2320,"wires":[["c22564933dc3258c"]]},{"id":"c22564933dc3258c","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":2320,"wires":[]},{"id":"6e1aa8e336f7d0ea","type":"link in","z":"dbfdd28e.d60f","name":"BLE_Connection_Bluetoothctl disconnect","links":["9eb116a6b8b13106"],"x":55,"y":2180,"wires":[["e635c14b188b0033"]]},{"id":"9fece97fc2c11f04","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl remove","addpay":"payload","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl Remove","x":420,"y":560,"wires":[["45c7f7108a622efa"],["3729a020b17fb01c"],["178ab86c2ab75759","35207e5854f09737"]]},{"id":"45c7f7108a622efa","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":520,"wires":[]},{"id":"308843987c6e4066","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"BLE_DeviceMAC","payloadType":"global","x":140,"y":560,"wires":[["9fece97fc2c11f04"]]},{"id":"178ab86c2ab75759","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":600,"wires":[]},{"id":"3729a020b17fb01c","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":560,"wires":[]},{"id":"484915addc2c1133","type":"comment","z":"dbfdd28e.d60f","name":"Pairing Process","info":"","x":140,"y":20,"wires":[]},{"id":"be19f30f4b237139","type":"comment","z":"dbfdd28e.d60f","name":"GoPro - Verbindungen Zurücksetzen und GoPro in Pairing Modus versetzten: Neues Gerät --> GoPro App vern","info":"","x":430,"y":60,"wires":[]},{"id":"1b93b0417c25d221","type":"switch","z":"dbfdd28e.d60f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":2560,"wires":[[],["60e3a6dec38d35b4"]]},{"id":"dab99e334f918aef","type":"comment","z":"dbfdd28e.d60f","name":"2mal ausführen","info":"","x":120,"y":600,"wires":[]},{"id":"8ce9c8e7bb67d23a","type":"link out","z":"dbfdd28e.d60f","name":"BLE_Connection --> HTTP_from_MySQL_FinalizePairing","mode":"link","links":["4396ec6d35e914eb"],"x":775,"y":1660,"wires":[]},{"id":"932df7fb5078567b","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1600,"wires":[["8ce9c8e7bb67d23a"]]},{"id":"60d550081aad2696","type":"comment","z":"dbfdd28e.d60f","name":"GoPro - GoPro erneut in Pairing Modus versetzten: Neues Gerät verbinden -> SmartRemote","info":"","x":380,"y":1700,"wires":[]},{"id":"1ccab08185f3ad95","type":"link in","z":"dbfdd28e.d60f","name":"BLE_Connection_ParingProcess --> DB_Connectivity_BLE Pair","links":["1b70b9832d39b0e8"],"x":55,"y":120,"wires":[["5b99c2a38427ff16"]]},{"id":"0af131849c73d93c","type":"change","z":"dbfdd28e.d60f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":880,"wires":[["39b9a9958d52b9c4"]]},{"id":"1bd3bc49820aa874","type":"comment","z":"dbfdd28e.d60f","name":"BLE_Surveillance","info":"","x":150,"y":2420,"wires":[]},{"id":"31b398b1f410f429","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl pair","addpay":"payload","append":"| grep CHG | grep Paired","useSpawn":"false","timer":"0","winHide":false,"oldrc":false,"name":"Bluetoothctl Pair","x":400,"y":1200,"wires":[["5b50931f393311a0","b156afbaaa18c0d1"],["628b59b56472f35a"],["af5c0bcbbd7e6145"]]},{"id":"5b50931f393311a0","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1160,"wires":[]},{"id":"af5c0bcbbd7e6145","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1240,"wires":[]},{"id":"628b59b56472f35a","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":1200,"wires":[]},{"id":"cea4955a45befa4d","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"BLE_DeviceMAC","payloadType":"global","x":140,"y":1200,"wires":[["31b398b1f410f429"]]},{"id":"429855333cb2e5ea","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1120,"wires":[["31b398b1f410f429"]]},{"id":"8d83c3aa7d8b40bd","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":480,"wires":[["9fece97fc2c11f04"]]},{"id":"35207e5854f09737","type":"delay","z":"dbfdd28e.d60f","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":400,"y":640,"wires":[["6baa780c71cc309f"]]},{"id":"6baa780c71cc309f","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":720,"wires":[["338d6c572b99d76a"]]},{"id":"338d6c572b99d76a","type":"exec","z":"dbfdd28e.d60f","command":"bluetoothctl remove","addpay":"payload","append":"","useSpawn":"false","timer":"5","winHide":false,"oldrc":false,"name":"Bluetoothctl Remove","x":420,"y":800,"wires":[[],[],["0af131849c73d93c"]]},{"id":"5ee737825307dbce","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":1360,"wires":[["589414f7eb8a5c3f"]]},{"id":"30fe85515f19f975","type":"switch","z":"dbfdd28e.d60f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":1360,"wires":[["5ee737825307dbce"],[]]},{"id":"4c189d7d5ddd31cb","type":"comment","z":"dbfdd28e.d60f","name":"BLE Connect","info":"","x":130,"y":1780,"wires":[]},{"id":"032cb99ca60981fe","type":"comment","z":"dbfdd28e.d60f","name":"BLE Disconnect","info":"","x":140,"y":2100,"wires":[]},{"id":"c0dae1f18e52bef6","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":1860,"wires":[["aec71ea8db4599a5"]]},{"id":"e635c14b188b0033","type":"change","z":"dbfdd28e.d60f","name":"setze BLE_DeviceMAC","rules":[{"t":"set","p":"payload","pt":"msg","to":"BLE_DeviceMAC","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":2180,"wires":[["4dc7ba57f5086c13"]]},{"id":"719ca9b40365348f","type":"inject","z":"dbfdd28e.d60f","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"BLE_DeviceMAC","payloadType":"global","x":140,"y":2240,"wires":[["4dc7ba57f5086c13"]]},{"id":"9b95bdddfa1f8976","type":"function","z":"dbfdd28e.d60f","name":"BLE_DeviceName und BLE_DeviceMAC declaration from new devices","func":"\n\n\nconst before_DeviceName = /[\\s\\S]{11}/;\nconst before_DeviceMAC = /[\\s\\S]{24}/;\nconst after_DeviceName = /\\s:[\\s\\S]*/;\nconst after_DeviceMAC = /\\n/;\n\nBLE_DeviceName = msg.payload.replace(before_DeviceName, \"\").replace(after_DeviceName, \"\");\nBLE_DeviceMAC = msg.payload.replace(before_DeviceMAC, \"\").replace(after_DeviceMAC, \"\");\n\nmsg.payload = BLE_DeviceName;\nglobal.set('BLE_DeviceName',BLE_DeviceName);\nmsg.topic = BLE_DeviceMAC;\nglobal.set('BLE_DeviceMAC',BLE_DeviceMAC);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":380,"wires":[[]]},{"id":"1459a40b135bab37","type":"debug","z":"dbfdd28e.d60f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":840,"y":360,"wires":[]},{"id":"9b4c07b9b415d620","type":"comment","z":"8b3378e67f4ebeb9","name":"BLE_Reconnect","info":"","x":140,"y":60,"wires":[]},{"id":"8f7912e0614cdc19","type":"switch","z":"8b3378e67f4ebeb9","name":"BLE_DeviceConnected - no","property":"BLE_DeviceConnected","propertyType":"global","rules":[{"t":"eq","v":"yes","vt":"str"},{"t":"eq","v":"no","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":140,"wires":[[],["f3d94cd7a2ba6db6","4bae27a13b302a27"]]},{"id":"01eae56a19bf9836","type":"inject","z":"8b3378e67f4ebeb9","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":170,"y":140,"wires":[["8f7912e0614cdc19"]]},{"id":"f3d94cd7a2ba6db6","type":"link out","z":"8b3378e67f4ebeb9","name":"BLE_WIFI_Stability_Reconnect -->BLE_Connection","mode":"link","links":["4ea62f1dea08b4bb"],"x":675,"y":140,"wires":[]},{"id":"4bae27a13b302a27","type":"switch","z":"8b3378e67f4ebeb9","name":"GoProHttpConnected - disconnected","property":"GoProHttpConnected","propertyType":"global","rules":[{"t":"eq","v":"common.status.connected","vt":"str"},{"t":"eq","v":"common.status.disconnected","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":440,"wires":[[],["b49b16636bd5a31d"]]},{"id":"c757f244785ee2c2","type":"comment","z":"8b3378e67f4ebeb9","name":"Wifi Reconnect","info":"","x":120,"y":340,"wires":[]},{"id":"376c4e8818311ff1","type":"inject","z":"8b3378e67f4ebeb9","name":"","props":[{"p":"payload"},{"p":"topic","v":"","vt":"date"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":170,"y":440,"wires":[["4bae27a13b302a27"]]},{"id":"b49b16636bd5a31d","type":"link out","z":"8b3378e67f4ebeb9","name":"BLE_WIFI_Stability_Reconnect -->BLE_from_MySQL_WifiON","mode":"link","links":["4fc071f8f4099767"],"x":675,"y":440,"wires":[]},{"id":"0f2244ac57644232","type":"exec","z":"990bb909f6d677c8","command":"sudo service hostapd stop && sudo service hostapd start","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"AP stop/start","x":1230,"y":260,"wires":[[],[],[]]},{"id":"8a256da369faa6d3","type":"udp in","z":"990bb909f6d677c8","name":"GoProHero5black receive","iface":"","port":"8383","ipv":"udp4","multicast":"false","group":"10.71.79.101","datatype":"buffer","x":370,"y":300,"wires":[["323765e7fdd1db2c","f54a594057f56594"]]},{"id":"323765e7fdd1db2c","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":410,"y":240,"wires":[]},{"id":"af0f2d8275a0817f","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":200,"wires":[]},{"id":"5bc0d64b59fc7558","type":"trigger","z":"990bb909f6d677c8","name":"Watchdog2","op1":"","op2":"GoProOffline","op1type":"nul","op2type":"str","duration":"3.4","extend":true,"overrideDelay":false,"units":"s","reset":"GoProOnline","bytopic":"all","topic":"topic","outputs":1,"x":970,"y":260,"wires":[["af0f2d8275a0817f","0f2244ac57644232","4448c0b18c09cd22"]],"info":"setze \n\"dann\" \"warten auf\" auf 3 x var:delay des Heartbeats für beste Ergebnisse (nicht kürzer sonst beginnt er zu flappen!)\n\nDieses WakeUp Gopro bewirkt:\n1.) Overruled sozusagen die \"Automatische Kammeraabschaltung\" der GoPro - Settings und\n2.) dedektiert und behebt Abrisse in der UDP Kommunikation zwischen Node-red und GoProHero5Black"},{"id":"7155b1f3ba666cf0","type":"comment","z":"990bb909f6d677c8","name":"building UDP Connection","info":"","x":330,"y":160,"wires":[]},{"id":"273fad5ef12db2a6","type":"inject","z":"990bb909f6d677c8","name":"GoProCheck","repeat":"6.7","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"GoProCheck","payloadType":"str","x":660,"y":400,"wires":[["aaad3a07e5fba938"]]},{"id":"aaad3a07e5fba938","type":"trigger","z":"990bb909f6d677c8","name":"WatchDog1","op1":"","op2":"GoPro Dead","op1type":"nul","op2type":"str","duration":"6.5","extend":true,"units":"s","reset":"GoProOnline","bytopic":"all","outputs":1,"x":970,"y":360,"wires":[["5bc0d64b59fc7558","7c28eedf7e86e2f7"]]},{"id":"7c28eedf7e86e2f7","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":420,"wires":[]},{"id":"2e6705ec5220e309","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":240,"wires":[]},{"id":"f54a594057f56594","type":"change","z":"990bb909f6d677c8","name":"GoProOnline - Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"GoProOnline","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":300,"wires":[["aaad3a07e5fba938","2e6705ec5220e309","5bc0d64b59fc7558","252acee6f195baed"]]},{"id":"252acee6f195baed","type":"link out","z":"990bb909f6d677c8","name":"WakeUp GoPro UDP_GoProOnline->DB_connectivity","links":["d810a272.2ce32"],"x":775,"y":340,"wires":[]},{"id":"4448c0b18c09cd22","type":"link out","z":"990bb909f6d677c8","name":"WakeUp GoPro UDP_GoProOffline->DB_connectivity","links":["d810a272.2ce32"],"x":1075,"y":300,"wires":[]},{"id":"57fb6752b355d8b8","type":"inject","z":"990bb909f6d677c8","name":"ShutterStart","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90072aa8d11e390460002a5d5c51b\":\"03010101\"}","payloadType":"json","x":1730,"y":2840,"wires":[[]]},{"id":"34a949068e09a171","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1140,"y":140,"wires":[["0f2244ac57644232"]]},{"id":"75ddeba428c893a0","type":"inject","z":"990bb909f6d677c8","name":"ShutterStop","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90072aa8d11e390460002a5d5c51b\":\"03010100\"}","payloadType":"json","x":1730,"y":2880,"wires":[[]]},{"id":"6ca783202446e7cf","type":"inject","z":"990bb909f6d677c8","name":"WifiOn","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90072aa8d11e390460002a5d5c51b\":\"03170101\"}","payloadType":"json","x":1750,"y":2760,"wires":[[]]},{"id":"5faa15bb45dc5998","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1470,"y":2680,"wires":[]},{"id":"bec5d4c6c40b41e3","type":"switch","z":"990bb909f6d677c8","name":"GoPro APP (HTTP) down?","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"common.status.disconnected","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":780,"y":2440,"wires":[["a456fa9da84f6846"]]},{"id":"bf96d3a3e0013a3c","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1530,"y":1980,"wires":[]},{"id":"05888960316b7914","type":"comment","z":"990bb909f6d677c8","name":"building HTTP Connection","info":"","x":330,"y":1940,"wires":[]},{"id":"01dad2efaf06c9ff","type":"subflow:ec2aab9f.334378","z":"990bb909f6d677c8","d":true,"name":"","env":[],"x":1610,"y":1800,"wires":[]},{"id":"c02c52b52acb997d","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":1860,"wires":[]},{"id":"19915304161e82d8","type":"inject","z":"990bb909f6d677c8","name":"Keep Alive","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90074aa8d11e390460002a5d5c51b\":\"035B0142\"}","payloadType":"json","x":1740,"y":2920,"wires":[[]]},{"id":"15c5ccf1069b873f","type":"inject","z":"990bb909f6d677c8","name":"WifiOFF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90072aa8d11e390460002a5d5c51b\":\"03170100\"}","payloadType":"json","x":1740,"y":2800,"wires":[[]]},{"id":"5d7d3e92bef664dd","type":"link in","z":"990bb909f6d677c8","name":"WakeUp GoPro BLE_Status->WakeUp GoPro BLE_Status","links":["39b7041a02395c28"],"x":415,"y":2600,"wires":[["24f973d8a429be8b"]]},{"id":"0f319b714472c33c","type":"change","z":"990bb909f6d677c8","name":"open gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":2580,"wires":[["6d1edbc0b283c22a"]]},{"id":"24f973d8a429be8b","type":"switch","z":"990bb909f6d677c8","name":"GoPro BLE connected?","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"generic-ble.status.connected","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":2600,"wires":[["0f319b714472c33c"],["ab825424d54545be"]]},{"id":"ab825424d54545be","type":"change","z":"990bb909f6d677c8","name":"queue gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"queue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":2620,"wires":[["b8079991dc713794","4eb1a5c86776bfa8"]]},{"id":"b8079991dc713794","type":"q-gate","z":"990bb909f6d677c8","name":"BLE Gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","maxQueueLength":"1","keepNewest":true,"qToggle":false,"persist":false,"x":1260,"y":2560,"wires":[["95d3ad1cb4d0c1b5","562d1231801efab4"]]},{"id":"6844437fe58b7093","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1280,"y":2740,"wires":[["bf35bcbf9fe0bdd0"]]},{"id":"95d3ad1cb4d0c1b5","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1470,"y":2560,"wires":[]},{"id":"bf35bcbf9fe0bdd0","type":"subflow:699c80d1.c0993","z":"990bb909f6d677c8","d":true,"name":"","env":[],"x":1270,"y":2680,"wires":[["5faa15bb45dc5998","9dc59f71f7be1bc5","4eb1a5c86776bfa8"]]},{"id":"6d1edbc0b283c22a","type":"delay","z":"990bb909f6d677c8","name":"delay","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1070,"y":2560,"wires":[["b8079991dc713794","4eb1a5c86776bfa8"]]},{"id":"6fd2a93fba243355","type":"subflow:a6748f13.b6d87","z":"990bb909f6d677c8","d":true,"name":"","env":[],"x":1530,"y":2040,"wires":[["bf96d3a3e0013a3c"]]},{"id":"bfedd30820811390","type":"change","z":"990bb909f6d677c8","name":"open gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":2060,"wires":[["fc6a91185ddc9fd8"]]},{"id":"0d0c37ef71200876","type":"switch","z":"990bb909f6d677c8","name":"GoPro APP (HTTP) up?","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"common.status.connected","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":2080,"wires":[["bfedd30820811390"],["d905b2d1d2aa1ff8"]]},{"id":"d905b2d1d2aa1ff8","type":"change","z":"990bb909f6d677c8","name":"queue gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"queue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":2100,"wires":[["9dc59f71f7be1bc5"]]},{"id":"9dc59f71f7be1bc5","type":"q-gate","z":"990bb909f6d677c8","name":"tcp Gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","maxQueueLength":"1","keepNewest":true,"qToggle":false,"persist":false,"x":1320,"y":2080,"wires":[["6fd2a93fba243355","06096eb07ef6550a"]]},{"id":"06096eb07ef6550a","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1510,"y":2140,"wires":[]},{"id":"fc6a91185ddc9fd8","type":"delay","z":"990bb909f6d677c8","name":"delay","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1090,"y":2040,"wires":[["9dc59f71f7be1bc5"]]},{"id":"723194056578cb0f","type":"tcp-ping","z":"990bb909f6d677c8","ip":"10.5.5.9","port":"80","count":"3","interval":"1000","timeout":"3000","topic":"check","name":"","x":660,"y":2260,"wires":[["e82b43e8ea4edbd1","89dd059e3bdeddb4"]]},{"id":"43875d88ca566946","type":"inject","z":"990bb909f6d677c8","name":"Check tcp","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"status.text","v":"","vt":"str"}],"repeat":"4","crontab":"","once":false,"onceDelay":0.1,"topic":"check","payload":"","payloadType":"date","x":490,"y":2260,"wires":[["723194056578cb0f"]]},{"id":"e82b43e8ea4edbd1","type":"debug","z":"990bb909f6d677c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":2200,"wires":[]},{"id":"89dd059e3bdeddb4","type":"function","z":"990bb909f6d677c8","name":"GoProHttpConnected","func":"\n\nif (msg.payload.sent - msg.payload.success == 0) {\nmsg.status.text = \"common.status.connected\";\n}\nelse {\nmsg.status.text = \"common.status.disconnected\";\n}\n\nglobal.set('GoProHttpConnected',msg.status.text)\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":2260,"wires":[["a53071774decba67","2ee67e6b8c1e83cd","0d0c37ef71200876","995055bbf0b92500"]]},{"id":"a53071774decba67","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":2300,"wires":[]},{"id":"2ee67e6b8c1e83cd","type":"link out","z":"990bb909f6d677c8","name":"WakeUp GoPro HTTP tcp Status->DB_Connectivity","links":["a4bef44c.c585c8"],"x":1115,"y":2260,"wires":[]},{"id":"a456fa9da84f6846","type":"subflow:e29abac8.fc1078","z":"990bb909f6d677c8","d":true,"name":"","env":[],"x":1030,"y":2440,"wires":[["b8079991dc713794","574278627cb27e9b"]]},{"id":"574278627cb27e9b","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":2360,"wires":[]},{"id":"4eb1a5c86776bfa8","type":"q-gate","z":"990bb909f6d677c8","name":"BLE Gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","maxQueueLength":"1","keepNewest":true,"qToggle":false,"persist":false,"x":1260,"y":2800,"wires":[[]]},{"id":"562d1231801efab4","type":"delay","z":"990bb909f6d677c8","name":"delay","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1250,"y":2620,"wires":[["bf35bcbf9fe0bdd0"]]},{"id":"cf5e2baaaaefc958","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"50","crontab":"","once":true,"onceDelay":"0.1","topic":"control","payload":"open","payloadType":"str","x":620,"y":2320,"wires":[["995055bbf0b92500"]]},{"id":"65064c588aa4ffc8","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"50","crontab":"","once":true,"onceDelay":"1.5","topic":"control","payload":"queue","payloadType":"str","x":620,"y":2360,"wires":[["995055bbf0b92500"]]},{"id":"995055bbf0b92500","type":"q-gate","z":"990bb909f6d677c8","name":"tcp Gate","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","maxQueueLength":"1","keepNewest":true,"qToggle":false,"persist":false,"x":840,"y":2340,"wires":[["bec5d4c6c40b41e3"]]},{"id":"0a239c848665980c","type":"comment","z":"990bb909f6d677c8","name":"checking GoPro AP (tcp)","info":"","x":430,"y":2200,"wires":[]},{"id":"7cd705ad4ff34603","type":"comment","z":"990bb909f6d677c8","name":"resetting GoPro AP (tcp)","info":"","x":430,"y":2460,"wires":[]},{"id":"f6061baf0e024387","type":"function","z":"990bb909f6d677c8","name":"","func":"//var NewMsg = {payload: 0};\nif (msg.payload[0] + msg.payload[1] == 3) {\nmsg.payload = 1;\n}\nelse {\nmsg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1860,"y":1320,"wires":[["70f42badac7fe0c9","0238488c85636e1b"]]},{"id":"70f42badac7fe0c9","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1930,"y":1380,"wires":[]},{"id":"47971f45218c490e","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1630,"y":1300,"wires":[]},{"id":"82067f787e357703","type":"buffer-array","z":"990bb909f6d677c8","name":"Buffer_Value_Pair","bufferLen":"2","startWhenFilled":true,"x":1670,"y":1360,"wires":[["f6061baf0e024387","da4e800d459e9346"]]},{"id":"da4e800d459e9346","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1650,"y":1420,"wires":[]},{"id":"0238488c85636e1b","type":"link out","z":"990bb909f6d677c8","name":"WakeUp_GoPro_Keep_Alive","links":[],"x":1975,"y":1000,"wires":[]},{"id":"8bdb2b69c2cc903a","type":"comment","z":"990bb909f6d677c8","name":"building BLE Connection","info":"","x":330,"y":720,"wires":[]},{"id":"02696f96f879a9f8","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"connect","payload":"","payloadType":"date","x":1250,"y":700,"wires":[[]]},{"id":"0477d075146a9435","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"disconnect","payload":"","payloadType":"date","x":1240,"y":780,"wires":[[]]},{"id":"65912e06ac0fd625","type":"debug","z":"990bb909f6d677c8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1450,"y":860,"wires":[]},{"id":"21b505678fe7e274","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"scanStart","payloadType":"date","x":1250,"y":660,"wires":[[]]},{"id":"16831c3c66043cd1","type":"exec","z":"990bb909f6d677c8","d":true,"command":"sudo service bluetooth restart","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"Bluetooth.service restart","x":930,"y":1560,"wires":[["67507bac1f44caac","28ea711c9818a2f4"],[],[]]},{"id":"fe7510f1695bc256","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":880,"y":1620,"wires":[["16831c3c66043cd1"]]},{"id":"6f6361687ce4ad3f","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"read","payload":"","payloadType":"date","x":1260,"y":740,"wires":[[]]},{"id":"790bf51e69c21a97","type":"status","z":"990bb909f6d677c8","name":"Status BLE out GoPro 8539","scope":["d0934d9f.1df27"],"x":340,"y":860,"wires":[["39b7041a02395c28","9469988fc9c0fb42","5f80cb93d46848e1","a773ce34a83b9a08"]]},{"id":"39b7041a02395c28","type":"link out","z":"990bb909f6d677c8","name":"WakeUp GoPro BLE_Status->DB_connectivity","links":["5d7d3e92bef664dd","ccc52554.62e3e8","edb80261dfd8d37f"],"x":555,"y":780,"wires":[]},{"id":"9469988fc9c0fb42","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":390,"y":780,"wires":[]},{"id":"5f80cb93d46848e1","type":"switch","z":"990bb909f6d677c8","name":"GoPro BLE reconnect","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"generic-ble.status.disconnected","vt":"str"},{"t":"eq","v":"generic-ble.status.missing","vt":"str"},{"t":"eq","v":"generic-ble.status.connected","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":640,"y":860,"wires":[["660e8fcce632ae2d","3e7d6d358bb29bd0","9093a4ab0824f9be"],["16831c3c66043cd1","660e8fcce632ae2d"],["d3db9d3654d7395b","db2ba3f850973ed2"]]},{"id":"9093a4ab0824f9be","type":"change","z":"990bb909f6d677c8","name":"Connect","rules":[{"t":"set","p":"topic","pt":"msg","to":"connect","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":860,"wires":[[]]},{"id":"d5d2fba66e733651","type":"inject","z":"990bb909f6d677c8","name":"Get Camera Info","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90074aa8d11e390460002a5d5c51b\":\"3C\"}","payloadType":"json","x":620,"y":1180,"wires":[[]]},{"id":"a8dbda86f963a606","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":960,"y":1060,"wires":[]},{"id":"67507bac1f44caac","type":"function","z":"990bb909f6d677c8","name":"BLE_reconnect_counter","func":"\nvar ts = new Date();\nvar offset = ts.getTimezoneOffset()*60000;\nvar counter = context.get('counter') || 0;\nvar NewMsg = {payload : 0, counter : counter};\n\nNewMsg.payload = (new Date(Date.now() - offset)).toISOString();\n\nif( msg.rc.code == \"0\" )\n{\n    counter++;\n}\ncontext.set('counter', counter);\n\nreturn NewMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1190,"y":1560,"wires":[["b77f548344bd88f2","0e781052f3560396"]]},{"id":"b77f548344bd88f2","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":1520,"wires":[]},{"id":"0e781052f3560396","type":"link out","z":"990bb909f6d677c8","name":"WakeUpGopro_BLE_reconnect-->BlackBox_to_MySQL_insert_BLE_reconnect","links":["3c199cc1.ecbb94"],"x":1355,"y":1600,"wires":[]},{"id":"28ea711c9818a2f4","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":1520,"wires":[]},{"id":"8eb906d1ab8b0a1b","type":"exec","z":"990bb909f6d677c8","d":true,"command":"bluetoothctl power off && bluetoothctl power on && bluetoothctl scan on","addpay":false,"append":"","useSpawn":"false","timer":"20","winHide":false,"oldrc":false,"name":"Bluetoothctl ON/OFF","x":1400,"y":1800,"wires":[["b11763922e9123ba"],[],["c02c52b52acb997d","01dad2efaf06c9ff"]]},{"id":"fcbef81225776f42","type":"inject","z":"990bb909f6d677c8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1160,"y":1680,"wires":[["8eb906d1ab8b0a1b"]]},{"id":"b11763922e9123ba","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1350,"y":1740,"wires":[]},{"id":"660e8fcce632ae2d","type":"trigger","z":"990bb909f6d677c8","name":"BLE Error Reset","op1":"","op2":"BLE Error","op1type":"nul","op2type":"str","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"generic-ble.status.connected","bytopic":"all","topic":"topic","outputs":1,"x":1140,"y":1800,"wires":[["8eb906d1ab8b0a1b","74dcfb759a5c06b6"]],"info":"setze \n\"dann\" \"warten auf\" auf 3 x var:delay des Heartbeats für beste Ergebnisse (nicht kürzer sonst beginnt er zu flappen!)\n\nDieses WakeUp Gopro bewirkt:\n1.) Overruled sozusagen die \"Automatische Kammeraabschaltung\" der GoPro - Settings und\n2.) dedektiert und behebt Abrisse in der UDP Kommunikation zwischen Node-red und GoProHero5Black"},{"id":"3e7d6d358bb29bd0","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":780,"wires":[]},{"id":"d3db9d3654d7395b","type":"change","z":"990bb909f6d677c8","name":"Connect","rules":[{"t":"set","p":"payload","pt":"msg","to":"generic-ble.status.connected","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1800,"wires":[["660e8fcce632ae2d","82b651ab134c6274"]]},{"id":"82b651ab134c6274","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":890,"y":1740,"wires":[]},{"id":"74dcfb759a5c06b6","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":1740,"wires":[]},{"id":"50ec39b94b1aa7ab","type":"inject","z":"990bb909f6d677c8","name":"Keep Alive","props":[{"p":"payload"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"b5f90074aa8d11e390460002a5d5c51b\":\"035B0142\"}","payloadType":"json","x":970,"y":1420,"wires":[["bcfcf3fd5c96a5d9"]]},{"id":"9543b6040ecd05f2","type":"comment","z":"990bb909f6d677c8","name":"stabilzing BLE Connection","info":"","x":390,"y":1240,"wires":[]},{"id":"71dcb5c96dbc9c95","type":"comment","z":"990bb909f6d677c8","d":true,"name":"restarting BLE Service","info":"","x":420,"y":1560,"wires":[]},{"id":"1a64f9999f624a5b","type":"comment","z":"990bb909f6d677c8","name":"restarting NodeRed","info":"","x":410,"y":1800,"wires":[]},{"id":"0a2c1722c25fee8c","type":"change","z":"990bb909f6d677c8","d":true,"name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":1300,"wires":[["47971f45218c490e","82067f787e357703"]]},{"id":"9eef6270b2875751","type":"change","z":"990bb909f6d677c8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":1360,"wires":[["7ab1643bac81b2e1","82067f787e357703"]]},{"id":"7ab1643bac81b2e1","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":1420,"wires":[]},{"id":"ba98c2f08e9e4b1c","type":"comment","z":"990bb909f6d677c8","name":"checking BLE alive","info":"","x":410,"y":1340,"wires":[]},{"id":"fe4efc7f406ce896","type":"link in","z":"990bb909f6d677c8","name":"WakeUP GoPro Bluetoothctl restart","links":["db8c298d.f62138"],"x":935,"y":1860,"wires":[["a1242b50a2bff8b6","a0dc54e90e5c5ea9"]]},{"id":"ae2cbfb45439b221","type":"comment","z":"990bb909f6d677c8","name":"stuck @ connected","info":"","x":490,"y":1380,"wires":[]},{"id":"0313a38be10d3d09","type":"comment","z":"990bb909f6d677c8","name":"stuck @ missing or disconnected","info":"","x":530,"y":1840,"wires":[]},{"id":"a1242b50a2bff8b6","type":"switch","z":"990bb909f6d677c8","name":"GoPro BLE dead","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":" GoPro BLE active","vt":"str"},{"t":"eq","v":" GoPro BLE dead","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1860,"wires":[[],["8eb906d1ab8b0a1b","a581dd3b36c27117"]]},{"id":"a0dc54e90e5c5ea9","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1040,"y":1920,"wires":[]},{"id":"bcfcf3fd5c96a5d9","type":"gate","z":"990bb909f6d677c8","d":true,"name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","persist":false,"x":1150,"y":1300,"wires":[["9eef6270b2875751"]]},{"id":"9397290dc6fd02a7","type":"change","z":"990bb909f6d677c8","name":"open gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1280,"wires":[["f2a1cc7f05defc66"]]},{"id":"a773ce34a83b9a08","type":"switch","z":"990bb909f6d677c8","name":"GPro BLE connected ?","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"generic-ble.status.connected","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":640,"y":1300,"wires":[["9397290dc6fd02a7"],["b76be7a34ba33209"]]},{"id":"b76be7a34ba33209","type":"change","z":"990bb909f6d677c8","name":"close gate","rules":[{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":1340,"wires":[["bcfcf3fd5c96a5d9"]]},{"id":"f2a1cc7f05defc66","type":"delay","z":"990bb909f6d677c8","name":"delay","pauseType":"delay","timeout":"1500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1010,"y":1280,"wires":[["bcfcf3fd5c96a5d9"]]},{"id":"a581dd3b36c27117","type":"debug","z":"990bb909f6d677c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1320,"y":1920,"wires":[]},{"id":"0a7350a48f5a8d01","type":"change","z":"990bb909f6d677c8","name":"Get Camera Info","rules":[{"t":"set","p":"payload","pt":"msg","to":"{     \"b5f90074aa8d11e390460002a5d5c51b\": \"3C\" }","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1040,"wires":[[]]},{"id":"db2ba3f850973ed2","type":"delay","z":"990bb909f6d677c8","name":"delay","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":630,"y":960,"wires":[["0a7350a48f5a8d01"]]}]